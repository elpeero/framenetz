(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();var Be=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var je={exports:{}},Bt;function bi(){if(Bt)return je.exports;Bt=1;var n=typeof Reflect=="object"?Reflect:null,t=n&&typeof n.apply=="function"?n.apply:function(v,b,T){return Function.prototype.apply.call(v,b,T)},r;n&&typeof n.ownKeys=="function"?r=n.ownKeys:Object.getOwnPropertySymbols?r=function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:r=function(v){return Object.getOwnPropertyNames(v)};function e(g){console&&console.warn&&console.warn(g)}var i=Number.isNaN||function(v){return v!==v};function o(){o.init.call(this)}je.exports=o,je.exports.once=k,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(g){if(typeof g!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof g)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(g){if(typeof g!="number"||g<0||i(g))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+g+".");a=g}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||i(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this};function u(g){return g._maxListeners===void 0?o.defaultMaxListeners:g._maxListeners}o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(v){for(var b=[],T=1;T<arguments.length;T++)b.push(arguments[T]);var N=v==="error",F=this._events;if(F!==void 0)N=N&&F.error===void 0;else if(!N)return!1;if(N){var D;if(b.length>0&&(D=b[0]),D instanceof Error)throw D;var M=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw M.context=D,M}var j=F[v];if(j===void 0)return!1;if(typeof j=="function")t(j,this,b);else for(var X=j.length,W=m(j,X),T=0;T<X;++T)t(W[T],this,b);return!0};function d(g,v,b,T){var N,F,D;if(s(b),F=g._events,F===void 0?(F=g._events=Object.create(null),g._eventsCount=0):(F.newListener!==void 0&&(g.emit("newListener",v,b.listener?b.listener:b),F=g._events),D=F[v]),D===void 0)D=F[v]=b,++g._eventsCount;else if(typeof D=="function"?D=F[v]=T?[b,D]:[D,b]:T?D.unshift(b):D.push(b),N=u(g),N>0&&D.length>N&&!D.warned){D.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.emitter=g,M.type=v,M.count=D.length,e(M)}return g}o.prototype.addListener=function(v,b){return d(this,v,b,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(v,b){return d(this,v,b,!0)};function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(g,v,b){var T={fired:!1,wrapFn:void 0,target:g,type:v,listener:b},N=c.bind(T);return N.listener=b,T.wrapFn=N,N}o.prototype.once=function(v,b){return s(b),this.on(v,h(this,v,b)),this},o.prototype.prependOnceListener=function(v,b){return s(b),this.prependListener(v,h(this,v,b)),this},o.prototype.removeListener=function(v,b){var T,N,F,D,M;if(s(b),N=this._events,N===void 0)return this;if(T=N[v],T===void 0)return this;if(T===b||T.listener===b)--this._eventsCount===0?this._events=Object.create(null):(delete N[v],N.removeListener&&this.emit("removeListener",v,T.listener||b));else if(typeof T!="function"){for(F=-1,D=T.length-1;D>=0;D--)if(T[D]===b||T[D].listener===b){M=T[D].listener,F=D;break}if(F<0)return this;F===0?T.shift():p(T,F),T.length===1&&(N[v]=T[0]),N.removeListener!==void 0&&this.emit("removeListener",v,M||b)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(v){var b,T,N;if(T=this._events,T===void 0)return this;if(T.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):T[v]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete T[v]),this;if(arguments.length===0){var F=Object.keys(T),D;for(N=0;N<F.length;++N)D=F[N],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(b=T[v],typeof b=="function")this.removeListener(v,b);else if(b!==void 0)for(N=b.length-1;N>=0;N--)this.removeListener(v,b[N]);return this};function l(g,v,b){var T=g._events;if(T===void 0)return[];var N=T[v];return N===void 0?[]:typeof N=="function"?b?[N.listener||N]:[N]:b?y(N):m(N,N.length)}o.prototype.listeners=function(v){return l(this,v,!0)},o.prototype.rawListeners=function(v){return l(this,v,!1)},o.listenerCount=function(g,v){return typeof g.listenerCount=="function"?g.listenerCount(v):f.call(g,v)},o.prototype.listenerCount=f;function f(g){var v=this._events;if(v!==void 0){var b=v[g];if(typeof b=="function")return 1;if(b!==void 0)return b.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function m(g,v){for(var b=new Array(v),T=0;T<v;++T)b[T]=g[T];return b}function p(g,v){for(;v+1<g.length;v++)g[v]=g[v+1];g.pop()}function y(g){for(var v=new Array(g.length),b=0;b<v.length;++b)v[b]=g[b].listener||g[b];return v}function k(g,v){return new Promise(function(b,T){function N(D){g.removeListener(v,F),T(D)}function F(){typeof g.removeListener=="function"&&g.removeListener("error",N),b([].slice.call(arguments))}S(g,v,F,{once:!0}),v!=="error"&&w(g,N,{once:!0})})}function w(g,v,b){typeof g.on=="function"&&S(g,"error",v,b)}function S(g,v,b,T){if(typeof g.on=="function")T.once?g.once(v,b):g.on(v,b);else if(typeof g.addEventListener=="function")g.addEventListener(v,function N(F){T.once&&g.removeEventListener(v,N),b(F)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof g)}return je.exports}var Sr=bi();function wi(){const n=arguments[0];for(let t=1,r=arguments.length;t<r;t++)if(arguments[t])for(const e in arguments[t])n[e]=arguments[t][e];return n}let Y=wi;typeof Object.assign=="function"&&(Y=Object.assign);function oe(n,t,r,e){const i=n._nodes.get(t);let o=null;return i&&(e==="mixed"?o=i.out&&i.out[r]||i.undirected&&i.undirected[r]:e==="directed"?o=i.out&&i.out[r]:o=i.undirected&&i.undirected[r]),o}function Z(n){return typeof n=="object"&&n!==null}function Cr(n){let t;for(t in n)return!1;return!0}function ne(n,t,r){Object.defineProperty(n,t,{enumerable:!1,configurable:!1,writable:!0,value:r})}function ue(n,t,r){const e={enumerable:!0,configurable:!0};typeof r=="function"?e.get=r:(e.value=r,e.writable=!1),Object.defineProperty(n,t,e)}function jt(n){return!(!Z(n)||n.attributes&&!Array.isArray(n.attributes))}function Ei(){let n=Math.floor(Math.random()*256)&255;return()=>n++}function pe(){const n=arguments;let t=null,r=-1;return{[Symbol.iterator](){return this},next(){let e=null;do{if(t===null){if(r++,r>=n.length)return{done:!0};t=n[r][Symbol.iterator]()}if(e=t.next(),e.done){t=null;continue}break}while(!0);return e}}}function Ne(){return{[Symbol.iterator](){return this},next(){return{done:!0}}}}class Lt extends Error{constructor(t){super(),this.name="GraphError",this.message=t}}class R extends Lt{constructor(t){super(t),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,R.prototype.constructor)}}class A extends Lt{constructor(t){super(t),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,A.prototype.constructor)}}class z extends Lt{constructor(t){super(t),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,z.prototype.constructor)}}function Ar(n,t){this.key=n,this.attributes=t,this.clear()}Ar.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function kr(n,t){this.key=n,this.attributes=t,this.clear()}kr.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function Rr(n,t){this.key=n,this.attributes=t,this.clear()}Rr.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function De(n,t,r,e,i){this.key=t,this.attributes=i,this.undirected=n,this.source=r,this.target=e}De.prototype.attach=function(){let n="out",t="in";this.undirected&&(n=t="undirected");const r=this.source.key,e=this.target.key;this.source[n][e]=this,!(this.undirected&&r===e)&&(this.target[t][r]=this)};De.prototype.attachMulti=function(){let n="out",t="in";const r=this.source.key,e=this.target.key;this.undirected&&(n=t="undirected");const i=this.source[n],o=i[e];if(typeof o>"u"){i[e]=this,this.undirected&&r===e||(this.target[t][r]=this);return}o.previous=this,this.next=o,i[e]=this,this.target[t][r]=this};De.prototype.detach=function(){const n=this.source.key,t=this.target.key;let r="out",e="in";this.undirected&&(r=e="undirected"),delete this.source[r][t],delete this.target[e][n]};De.prototype.detachMulti=function(){const n=this.source.key,t=this.target.key;let r="out",e="in";this.undirected&&(r=e="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[r][t],delete this.target[e][n]):(this.next.previous=void 0,this.source[r][t]=this.next,this.target[e][n]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const Lr=0,Nr=1,_i=2,Dr=3;function ve(n,t,r,e,i,o,a){let s,u,d,c;if(e=""+e,r===Lr){if(s=n._nodes.get(e),!s)throw new A(`Graph.${t}: could not find the "${e}" node in the graph.`);d=i,c=o}else if(r===Dr){if(i=""+i,u=n._edges.get(i),!u)throw new A(`Graph.${t}: could not find the "${i}" edge in the graph.`);const h=u.source.key,l=u.target.key;if(e===h)s=u.target;else if(e===l)s=u.source;else throw new A(`Graph.${t}: the "${e}" node is not attached to the "${i}" edge (${h}, ${l}).`);d=o,c=a}else{if(u=n._edges.get(e),!u)throw new A(`Graph.${t}: could not find the "${e}" edge in the graph.`);r===Nr?s=u.source:s=u.target,d=i,c=o}return[s,d,c]}function Ti(n,t,r){n.prototype[t]=function(e,i,o){const[a,s]=ve(this,t,r,e,i,o);return a.attributes[s]}}function xi(n,t,r){n.prototype[t]=function(e,i){const[o]=ve(this,t,r,e,i);return o.attributes}}function Si(n,t,r){n.prototype[t]=function(e,i,o){const[a,s]=ve(this,t,r,e,i,o);return a.attributes.hasOwnProperty(s)}}function Ci(n,t,r){n.prototype[t]=function(e,i,o,a){const[s,u,d]=ve(this,t,r,e,i,o,a);return s.attributes[u]=d,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:u}),this}}function Ai(n,t,r){n.prototype[t]=function(e,i,o,a){const[s,u,d]=ve(this,t,r,e,i,o,a);if(typeof d!="function")throw new R(`Graph.${t}: updater should be a function.`);const c=s.attributes,h=d(c[u]);return c[u]=h,this.emit("nodeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:u}),this}}function ki(n,t,r){n.prototype[t]=function(e,i,o){const[a,s]=ve(this,t,r,e,i,o);return delete a.attributes[s],this.emit("nodeAttributesUpdated",{key:a.key,type:"remove",attributes:a.attributes,name:s}),this}}function Ri(n,t,r){n.prototype[t]=function(e,i,o){const[a,s]=ve(this,t,r,e,i,o);if(!Z(s))throw new R(`Graph.${t}: provided attributes are not a plain object.`);return a.attributes=s,this.emit("nodeAttributesUpdated",{key:a.key,type:"replace",attributes:a.attributes}),this}}function Li(n,t,r){n.prototype[t]=function(e,i,o){const[a,s]=ve(this,t,r,e,i,o);if(!Z(s))throw new R(`Graph.${t}: provided attributes are not a plain object.`);return Y(a.attributes,s),this.emit("nodeAttributesUpdated",{key:a.key,type:"merge",attributes:a.attributes,data:s}),this}}function Ni(n,t,r){n.prototype[t]=function(e,i,o){const[a,s]=ve(this,t,r,e,i,o);if(typeof s!="function")throw new R(`Graph.${t}: provided updater is not a function.`);return a.attributes=s(a.attributes),this.emit("nodeAttributesUpdated",{key:a.key,type:"update",attributes:a.attributes}),this}}const Di=[{name:n=>`get${n}Attribute`,attacher:Ti},{name:n=>`get${n}Attributes`,attacher:xi},{name:n=>`has${n}Attribute`,attacher:Si},{name:n=>`set${n}Attribute`,attacher:Ci},{name:n=>`update${n}Attribute`,attacher:Ai},{name:n=>`remove${n}Attribute`,attacher:ki},{name:n=>`replace${n}Attributes`,attacher:Ri},{name:n=>`merge${n}Attributes`,attacher:Li},{name:n=>`update${n}Attributes`,attacher:Ni}];function Gi(n){Di.forEach(function({name:t,attacher:r}){r(n,t("Node"),Lr),r(n,t("Source"),Nr),r(n,t("Target"),_i),r(n,t("Opposite"),Dr)})}function Fi(n,t,r){n.prototype[t]=function(e,i){let o;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new z(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new z(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+e,s=""+i;if(i=arguments[2],o=oe(this,a,s,r),!o)throw new A(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(r!=="mixed")throw new z(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new A(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return o.attributes[i]}}function Pi(n,t,r){n.prototype[t]=function(e){let i;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new z(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new z(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+e,a=""+arguments[1];if(i=oe(this,o,a,r),!i)throw new A(`Graph.${t}: could not find an edge for the given path ("${o}" - "${a}").`)}else{if(r!=="mixed")throw new z(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,i=this._edges.get(e),!i)throw new A(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return i.attributes}}function zi(n,t,r){n.prototype[t]=function(e,i){let o;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new z(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new z(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+e,s=""+i;if(i=arguments[2],o=oe(this,a,s,r),!o)throw new A(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(r!=="mixed")throw new z(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new A(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return o.attributes.hasOwnProperty(i)}}function Oi(n,t,r){n.prototype[t]=function(e,i,o){let a;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new z(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new z(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,u=""+i;if(i=arguments[2],o=arguments[3],a=oe(this,s,u,r),!a)throw new A(`Graph.${t}: could not find an edge for the given path ("${s}" - "${u}").`)}else{if(r!=="mixed")throw new z(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,a=this._edges.get(e),!a)throw new A(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return a.attributes[i]=o,this.emit("edgeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:i}),this}}function Ii(n,t,r){n.prototype[t]=function(e,i,o){let a;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new z(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new z(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,u=""+i;if(i=arguments[2],o=arguments[3],a=oe(this,s,u,r),!a)throw new A(`Graph.${t}: could not find an edge for the given path ("${s}" - "${u}").`)}else{if(r!=="mixed")throw new z(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,a=this._edges.get(e),!a)throw new A(`Graph.${t}: could not find the "${e}" edge in the graph.`)}if(typeof o!="function")throw new R(`Graph.${t}: updater should be a function.`);return a.attributes[i]=o(a.attributes[i]),this.emit("edgeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:i}),this}}function Mi(n,t,r){n.prototype[t]=function(e,i){let o;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new z(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new z(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+e,s=""+i;if(i=arguments[2],o=oe(this,a,s,r),!o)throw new A(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(r!=="mixed")throw new z(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new A(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return delete o.attributes[i],this.emit("edgeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:i}),this}}function $i(n,t,r){n.prototype[t]=function(e,i){let o;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new z(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new z(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+e,s=""+i;if(i=arguments[2],o=oe(this,a,s,r),!o)throw new A(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(r!=="mixed")throw new z(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new A(`Graph.${t}: could not find the "${e}" edge in the graph.`)}if(!Z(i))throw new R(`Graph.${t}: provided attributes are not a plain object.`);return o.attributes=i,this.emit("edgeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function Ui(n,t,r){n.prototype[t]=function(e,i){let o;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new z(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new z(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+e,s=""+i;if(i=arguments[2],o=oe(this,a,s,r),!o)throw new A(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(r!=="mixed")throw new z(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new A(`Graph.${t}: could not find the "${e}" edge in the graph.`)}if(!Z(i))throw new R(`Graph.${t}: provided attributes are not a plain object.`);return Y(o.attributes,i),this.emit("edgeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:i}),this}}function Bi(n,t,r){n.prototype[t]=function(e,i){let o;if(this.type!=="mixed"&&r!=="mixed"&&r!==this.type)throw new z(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new z(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+e,s=""+i;if(i=arguments[2],o=oe(this,a,s,r),!o)throw new A(`Graph.${t}: could not find an edge for the given path ("${a}" - "${s}").`)}else{if(r!=="mixed")throw new z(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new A(`Graph.${t}: could not find the "${e}" edge in the graph.`)}if(typeof i!="function")throw new R(`Graph.${t}: provided updater is not a function.`);return o.attributes=i(o.attributes),this.emit("edgeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const ji=[{name:n=>`get${n}Attribute`,attacher:Fi},{name:n=>`get${n}Attributes`,attacher:Pi},{name:n=>`has${n}Attribute`,attacher:zi},{name:n=>`set${n}Attribute`,attacher:Oi},{name:n=>`update${n}Attribute`,attacher:Ii},{name:n=>`remove${n}Attribute`,attacher:Mi},{name:n=>`replace${n}Attributes`,attacher:$i},{name:n=>`merge${n}Attributes`,attacher:Ui},{name:n=>`update${n}Attributes`,attacher:Bi}];function Hi(n){ji.forEach(function({name:t,attacher:r}){r(n,t("Edge"),"mixed"),r(n,t("DirectedEdge"),"directed"),r(n,t("UndirectedEdge"),"undirected")})}const Wi=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function Vi(n,t,r,e){let i=!1;for(const o in t){if(o===e)continue;const a=t[o];if(i=r(a.key,a.attributes,a.source.key,a.target.key,a.source.attributes,a.target.attributes,a.undirected),n&&i)return a.key}}function qi(n,t,r,e){let i,o,a,s=!1;for(const u in t)if(u!==e){i=t[u];do{if(o=i.source,a=i.target,s=r(i.key,i.attributes,o.key,a.key,o.attributes,a.attributes,i.undirected),n&&s)return i.key;i=i.next}while(i!==void 0)}}function ot(n,t){const r=Object.keys(n),e=r.length;let i,o=0;return{[Symbol.iterator](){return this},next(){do if(i)i=i.next;else{if(o>=e)return{done:!0};const a=r[o++];if(a===t){i=void 0;continue}i=n[a]}while(!i);return{done:!1,value:{edge:i.key,attributes:i.attributes,source:i.source.key,target:i.target.key,sourceAttributes:i.source.attributes,targetAttributes:i.target.attributes,undirected:i.undirected}}}}}function Yi(n,t,r,e){const i=t[r];if(!i)return;const o=i.source,a=i.target;if(e(i.key,i.attributes,o.key,a.key,o.attributes,a.attributes,i.undirected)&&n)return i.key}function Ki(n,t,r,e){let i=t[r];if(!i)return;let o=!1;do{if(o=e(i.key,i.attributes,i.source.key,i.target.key,i.source.attributes,i.target.attributes,i.undirected),n&&o)return i.key;i=i.next}while(i!==void 0)}function at(n,t){let r=n[t];if(r.next!==void 0)return{[Symbol.iterator](){return this},next(){if(!r)return{done:!0};const i={edge:r.key,attributes:r.attributes,source:r.source.key,target:r.target.key,sourceAttributes:r.source.attributes,targetAttributes:r.target.attributes,undirected:r.undirected};return r=r.next,{done:!1,value:i}}};let e=!1;return{[Symbol.iterator](){return this},next(){return e===!0?{done:!0}:(e=!0,{done:!1,value:{edge:r.key,attributes:r.attributes,source:r.source.key,target:r.target.key,sourceAttributes:r.source.attributes,targetAttributes:r.target.attributes,undirected:r.undirected}})}}}function Xi(n,t){if(n.size===0)return[];if(t==="mixed"||t===n.type)return Array.from(n._edges.keys());const r=t==="undirected"?n.undirectedSize:n.directedSize,e=new Array(r),i=t==="undirected",o=n._edges.values();let a=0,s,u;for(;s=o.next(),s.done!==!0;)u=s.value,u.undirected===i&&(e[a++]=u.key);return e}function Gr(n,t,r,e){if(t.size===0)return;const i=r!=="mixed"&&r!==t.type,o=r==="undirected";let a,s,u=!1;const d=t._edges.values();for(;a=d.next(),a.done!==!0;){if(s=a.value,i&&s.undirected!==o)continue;const{key:c,attributes:h,source:l,target:f}=s;if(u=e(c,h,l.key,f.key,l.attributes,f.attributes,s.undirected),n&&u)return c}}function Zi(n,t){if(n.size===0)return Ne();const r=t!=="mixed"&&t!==n.type,e=t==="undirected",i=n._edges.values();return{[Symbol.iterator](){return this},next(){let o,a;for(;;){if(o=i.next(),o.done)return o;if(a=o.value,!(r&&a.undirected!==e))break}return{value:{edge:a.key,attributes:a.attributes,source:a.source.key,target:a.target.key,sourceAttributes:a.source.attributes,targetAttributes:a.target.attributes,undirected:a.undirected},done:!1}}}}function Nt(n,t,r,e,i,o){const a=t?qi:Vi;let s;if(r!=="undirected"&&(e!=="out"&&(s=a(n,i.in,o),n&&s)||e!=="in"&&(s=a(n,i.out,o,e?void 0:i.key),n&&s))||r!=="directed"&&(s=a(n,i.undirected,o),n&&s))return s}function Qi(n,t,r,e){const i=[];return Nt(!1,n,t,r,e,function(o){i.push(o)}),i}function Ji(n,t,r){let e=Ne();return n!=="undirected"&&(t!=="out"&&typeof r.in<"u"&&(e=pe(e,ot(r.in))),t!=="in"&&typeof r.out<"u"&&(e=pe(e,ot(r.out,t?void 0:r.key)))),n!=="directed"&&typeof r.undirected<"u"&&(e=pe(e,ot(r.undirected))),e}function Dt(n,t,r,e,i,o,a){const s=r?Ki:Yi;let u;if(t!=="undirected"&&(typeof i.in<"u"&&e!=="out"&&(u=s(n,i.in,o,a),n&&u)||typeof i.out<"u"&&e!=="in"&&(e||i.key!==o)&&(u=s(n,i.out,o,a),n&&u))||t!=="directed"&&typeof i.undirected<"u"&&(u=s(n,i.undirected,o,a),n&&u))return u}function en(n,t,r,e,i){const o=[];return Dt(!1,n,t,r,e,i,function(a){o.push(a)}),o}function tn(n,t,r,e){let i=Ne();return n!=="undirected"&&(typeof r.in<"u"&&t!=="out"&&e in r.in&&(i=pe(i,at(r.in,e))),typeof r.out<"u"&&t!=="in"&&e in r.out&&(t||r.key!==e)&&(i=pe(i,at(r.out,e)))),n!=="directed"&&typeof r.undirected<"u"&&e in r.undirected&&(i=pe(i,at(r.undirected,e))),i}function rn(n,t){const{name:r,type:e,direction:i}=t;n.prototype[r]=function(o,a){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return[];if(!arguments.length)return Xi(this,e);if(arguments.length===1){o=""+o;const s=this._nodes.get(o);if(typeof s>"u")throw new A(`Graph.${r}: could not find the "${o}" node in the graph.`);return Qi(this.multi,e==="mixed"?this.type:e,i,s)}if(arguments.length===2){o=""+o,a=""+a;const s=this._nodes.get(o);if(!s)throw new A(`Graph.${r}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(a))throw new A(`Graph.${r}:  could not find the "${a}" target node in the graph.`);return en(e,this.multi,i,s,a)}throw new R(`Graph.${r}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function nn(n,t){const{name:r,type:e,direction:i}=t,o="forEach"+r[0].toUpperCase()+r.slice(1,-1);n.prototype[o]=function(d,c,h){if(!(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)){if(arguments.length===1)return h=d,Gr(!1,this,e,h);if(arguments.length===2){d=""+d,h=c;const l=this._nodes.get(d);if(typeof l>"u")throw new A(`Graph.${o}: could not find the "${d}" node in the graph.`);return Nt(!1,this.multi,e==="mixed"?this.type:e,i,l,h)}if(arguments.length===3){d=""+d,c=""+c;const l=this._nodes.get(d);if(!l)throw new A(`Graph.${o}:  could not find the "${d}" source node in the graph.`);if(!this._nodes.has(c))throw new A(`Graph.${o}:  could not find the "${c}" target node in the graph.`);return Dt(!1,e,this.multi,i,l,c,h)}throw new R(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const a="map"+r[0].toUpperCase()+r.slice(1);n.prototype[a]=function(){const d=Array.prototype.slice.call(arguments),c=d.pop();let h;if(d.length===0){let l=0;e!=="directed"&&(l+=this.undirectedSize),e!=="undirected"&&(l+=this.directedSize),h=new Array(l);let f=0;d.push((m,p,y,k,w,S,g)=>{h[f++]=c(m,p,y,k,w,S,g)})}else h=[],d.push((l,f,m,p,y,k,w)=>{h.push(c(l,f,m,p,y,k,w))});return this[o].apply(this,d),h};const s="filter"+r[0].toUpperCase()+r.slice(1);n.prototype[s]=function(){const d=Array.prototype.slice.call(arguments),c=d.pop(),h=[];return d.push((l,f,m,p,y,k,w)=>{c(l,f,m,p,y,k,w)&&h.push(l)}),this[o].apply(this,d),h};const u="reduce"+r[0].toUpperCase()+r.slice(1);n.prototype[u]=function(){let d=Array.prototype.slice.call(arguments);if(d.length<2||d.length>4)throw new R(`Graph.${u}: invalid number of arguments (expecting 2, 3 or 4 and got ${d.length}).`);if(typeof d[d.length-1]=="function"&&typeof d[d.length-2]!="function")throw new R(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let c,h;d.length===2?(c=d[0],h=d[1],d=[]):d.length===3?(c=d[1],h=d[2],d=[d[0]]):d.length===4&&(c=d[2],h=d[3],d=[d[0],d[1]]);let l=h;return d.push((f,m,p,y,k,w,S)=>{l=c(l,f,m,p,y,k,w,S)}),this[o].apply(this,d),l}}function on(n,t){const{name:r,type:e,direction:i}=t,o="find"+r[0].toUpperCase()+r.slice(1,-1);n.prototype[o]=function(u,d,c){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return!1;if(arguments.length===1)return c=u,Gr(!0,this,e,c);if(arguments.length===2){u=""+u,c=d;const h=this._nodes.get(u);if(typeof h>"u")throw new A(`Graph.${o}: could not find the "${u}" node in the graph.`);return Nt(!0,this.multi,e==="mixed"?this.type:e,i,h,c)}if(arguments.length===3){u=""+u,d=""+d;const h=this._nodes.get(u);if(!h)throw new A(`Graph.${o}:  could not find the "${u}" source node in the graph.`);if(!this._nodes.has(d))throw new A(`Graph.${o}:  could not find the "${d}" target node in the graph.`);return Dt(!0,e,this.multi,i,h,d,c)}throw new R(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const a="some"+r[0].toUpperCase()+r.slice(1,-1);n.prototype[a]=function(){const u=Array.prototype.slice.call(arguments),d=u.pop();return u.push((h,l,f,m,p,y,k)=>d(h,l,f,m,p,y,k)),!!this[o].apply(this,u)};const s="every"+r[0].toUpperCase()+r.slice(1,-1);n.prototype[s]=function(){const u=Array.prototype.slice.call(arguments),d=u.pop();return u.push((h,l,f,m,p,y,k)=>!d(h,l,f,m,p,y,k)),!this[o].apply(this,u)}}function an(n,t){const{name:r,type:e,direction:i}=t,o=r.slice(0,-1)+"Entries";n.prototype[o]=function(a,s){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return Ne();if(!arguments.length)return Zi(this,e);if(arguments.length===1){a=""+a;const u=this._nodes.get(a);if(!u)throw new A(`Graph.${o}: could not find the "${a}" node in the graph.`);return Ji(e,i,u)}if(arguments.length===2){a=""+a,s=""+s;const u=this._nodes.get(a);if(!u)throw new A(`Graph.${o}:  could not find the "${a}" source node in the graph.`);if(!this._nodes.has(s))throw new A(`Graph.${o}:  could not find the "${s}" target node in the graph.`);return tn(e,i,u,s)}throw new R(`Graph.${o}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function sn(n){Wi.forEach(t=>{rn(n,t),nn(n,t),on(n,t),an(n,t)})}const un=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function tt(){this.A=null,this.B=null}tt.prototype.wrap=function(n){this.A===null?this.A=n:this.B===null&&(this.B=n)};tt.prototype.has=function(n){return this.A!==null&&n in this.A||this.B!==null&&n in this.B};function Pe(n,t,r,e,i){for(const o in e){const a=e[o],s=a.source,u=a.target,d=s===r?u:s;if(t&&t.has(d.key))continue;const c=i(d.key,d.attributes);if(n&&c)return d.key}}function Gt(n,t,r,e,i){if(t!=="mixed"){if(t==="undirected")return Pe(n,null,e,e.undirected,i);if(typeof r=="string")return Pe(n,null,e,e[r],i)}const o=new tt;let a;if(t!=="undirected"){if(r!=="out"){if(a=Pe(n,null,e,e.in,i),n&&a)return a;o.wrap(e.in)}if(r!=="in"){if(a=Pe(n,o,e,e.out,i),n&&a)return a;o.wrap(e.out)}}if(t!=="directed"&&(a=Pe(n,o,e,e.undirected,i),n&&a))return a}function dn(n,t,r){if(n!=="mixed"){if(n==="undirected")return Object.keys(r.undirected);if(typeof t=="string")return Object.keys(r[t])}const e=[];return Gt(!1,n,t,r,function(i){e.push(i)}),e}function ze(n,t,r){const e=Object.keys(r),i=e.length;let o=0;return{[Symbol.iterator](){return this},next(){let a=null;do{if(o>=i)return n&&n.wrap(r),{done:!0};const s=r[e[o++]],u=s.source,d=s.target;if(a=u===t?d:u,n&&n.has(a.key)){a=null;continue}}while(a===null);return{done:!1,value:{neighbor:a.key,attributes:a.attributes}}}}}function cn(n,t,r){if(n!=="mixed"){if(n==="undirected")return ze(null,r,r.undirected);if(typeof t=="string")return ze(null,r,r[t])}let e=Ne();const i=new tt;return n!=="undirected"&&(t!=="out"&&(e=pe(e,ze(i,r,r.in))),t!=="in"&&(e=pe(e,ze(i,r,r.out)))),n!=="directed"&&(e=pe(e,ze(i,r,r.undirected))),e}function hn(n,t){const{name:r,type:e,direction:i}=t;n.prototype[r]=function(o){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return[];o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new A(`Graph.${r}: could not find the "${o}" node in the graph.`);return dn(e==="mixed"?this.type:e,i,a)}}function ln(n,t){const{name:r,type:e,direction:i}=t,o="forEach"+r[0].toUpperCase()+r.slice(1,-1);n.prototype[o]=function(d,c){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return;d=""+d;const h=this._nodes.get(d);if(typeof h>"u")throw new A(`Graph.${o}: could not find the "${d}" node in the graph.`);Gt(!1,e==="mixed"?this.type:e,i,h,c)};const a="map"+r[0].toUpperCase()+r.slice(1);n.prototype[a]=function(d,c){const h=[];return this[o](d,(l,f)=>{h.push(c(l,f))}),h};const s="filter"+r[0].toUpperCase()+r.slice(1);n.prototype[s]=function(d,c){const h=[];return this[o](d,(l,f)=>{c(l,f)&&h.push(l)}),h};const u="reduce"+r[0].toUpperCase()+r.slice(1);n.prototype[u]=function(d,c,h){if(arguments.length<3)throw new R(`Graph.${u}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let l=h;return this[o](d,(f,m)=>{l=c(l,f,m)}),l}}function fn(n,t){const{name:r,type:e,direction:i}=t,o=r[0].toUpperCase()+r.slice(1,-1),a="find"+o;n.prototype[a]=function(d,c){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return;d=""+d;const h=this._nodes.get(d);if(typeof h>"u")throw new A(`Graph.${a}: could not find the "${d}" node in the graph.`);return Gt(!0,e==="mixed"?this.type:e,i,h,c)};const s="some"+o;n.prototype[s]=function(d,c){return!!this[a](d,c)};const u="every"+o;n.prototype[u]=function(d,c){return!this[a](d,(l,f)=>!c(l,f))}}function gn(n,t){const{name:r,type:e,direction:i}=t,o=r.slice(0,-1)+"Entries";n.prototype[o]=function(a){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return Ne();a=""+a;const s=this._nodes.get(a);if(typeof s>"u")throw new A(`Graph.${o}: could not find the "${a}" node in the graph.`);return cn(e==="mixed"?this.type:e,i,s)}}function pn(n){un.forEach(t=>{hn(n,t),ln(n,t),fn(n,t),gn(n,t)})}function He(n,t,r,e,i){const o=e._nodes.values(),a=e.type;let s,u,d,c,h,l;for(;s=o.next(),s.done!==!0;){let f=!1;if(u=s.value,a!=="undirected"){c=u.out;for(d in c){h=c[d];do l=h.target,f=!0,i(u.key,l.key,u.attributes,l.attributes,h.key,h.attributes,h.undirected),h=h.next;while(h)}}if(a!=="directed"){c=u.undirected;for(d in c)if(!(t&&u.key>d)){h=c[d];do l=h.target,l.key!==d&&(l=h.source),f=!0,i(u.key,l.key,u.attributes,l.attributes,h.key,h.attributes,h.undirected),h=h.next;while(h)}}r&&!f&&i(u.key,null,u.attributes,null,null,null,null)}}function vn(n,t){const r={key:n};return Cr(t.attributes)||(r.attributes=Y({},t.attributes)),r}function mn(n,t,r){const e={key:t,source:r.source.key,target:r.target.key};return Cr(r.attributes)||(e.attributes=Y({},r.attributes)),n==="mixed"&&r.undirected&&(e.undirected=!0),e}function yn(n){if(!Z(n))throw new R('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in n))throw new R("Graph.import: serialized node is missing its key.");if("attributes"in n&&(!Z(n.attributes)||n.attributes===null))throw new R("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function bn(n){if(!Z(n))throw new R('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in n))throw new R("Graph.import: serialized edge is missing its source.");if(!("target"in n))throw new R("Graph.import: serialized edge is missing its target.");if("attributes"in n&&(!Z(n.attributes)||n.attributes===null))throw new R("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in n&&typeof n.undirected!="boolean")throw new R("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const wn=Ei(),En=new Set(["directed","undirected","mixed"]),Ht=new Set(["domain","_events","_eventsCount","_maxListeners"]),_n=[{name:n=>`${n}Edge`,generateKey:!0},{name:n=>`${n}DirectedEdge`,generateKey:!0,type:"directed"},{name:n=>`${n}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:n=>`${n}EdgeWithKey`},{name:n=>`${n}DirectedEdgeWithKey`,type:"directed"},{name:n=>`${n}UndirectedEdgeWithKey`,type:"undirected"}],Tn={allowSelfLoops:!0,multi:!1,type:"mixed"};function xn(n,t,r){if(r&&!Z(r))throw new R(`Graph.addNode: invalid attributes. Expecting an object but got "${r}"`);if(t=""+t,r=r||{},n._nodes.has(t))throw new z(`Graph.addNode: the "${t}" node already exist in the graph.`);const e=new n.NodeDataClass(t,r);return n._nodes.set(t,e),n.emit("nodeAdded",{key:t,attributes:r}),e}function Wt(n,t,r){const e=new n.NodeDataClass(t,r);return n._nodes.set(t,e),n.emit("nodeAdded",{key:t,attributes:r}),e}function Fr(n,t,r,e,i,o,a,s){if(!e&&n.type==="undirected")throw new z(`Graph.${t}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(e&&n.type==="directed")throw new z(`Graph.${t}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(s&&!Z(s))throw new R(`Graph.${t}: invalid attributes. Expecting an object but got "${s}"`);if(o=""+o,a=""+a,s=s||{},!n.allowSelfLoops&&o===a)throw new z(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const u=n._nodes.get(o),d=n._nodes.get(a);if(!u)throw new A(`Graph.${t}: source node "${o}" not found.`);if(!d)throw new A(`Graph.${t}: target node "${a}" not found.`);const c={key:null,undirected:e,source:o,target:a,attributes:s};if(r)i=n._edgeKeyGenerator();else if(i=""+i,n._edges.has(i))throw new z(`Graph.${t}: the "${i}" edge already exists in the graph.`);if(!n.multi&&(e?typeof u.undirected[a]<"u":typeof u.out[a]<"u"))throw new z(`Graph.${t}: an edge linking "${o}" to "${a}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const h=new De(e,i,u,d,s);n._edges.set(i,h);const l=o===a;return e?(u.undirectedDegree++,d.undirectedDegree++,l&&(u.undirectedLoops++,n._undirectedSelfLoopCount++)):(u.outDegree++,d.inDegree++,l&&(u.directedLoops++,n._directedSelfLoopCount++)),n.multi?h.attachMulti():h.attach(),e?n._undirectedSize++:n._directedSize++,c.key=i,n.emit("edgeAdded",c),i}function Sn(n,t,r,e,i,o,a,s,u){if(!e&&n.type==="undirected")throw new z(`Graph.${t}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(e&&n.type==="directed")throw new z(`Graph.${t}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(s){if(u){if(typeof s!="function")throw new R(`Graph.${t}: invalid updater function. Expecting a function but got "${s}"`)}else if(!Z(s))throw new R(`Graph.${t}: invalid attributes. Expecting an object but got "${s}"`)}o=""+o,a=""+a;let d;if(u&&(d=s,s=void 0),!n.allowSelfLoops&&o===a)throw new z(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let c=n._nodes.get(o),h=n._nodes.get(a),l,f;if(!r&&(l=n._edges.get(i),l)){if((l.source.key!==o||l.target.key!==a)&&(!e||l.source.key!==a||l.target.key!==o))throw new z(`Graph.${t}: inconsistency detected when attempting to merge the "${i}" edge with "${o}" source & "${a}" target vs. ("${l.source.key}", "${l.target.key}").`);f=l}if(!f&&!n.multi&&c&&(f=e?c.undirected[a]:c.out[a]),f){const w=[f.key,!1,!1,!1];if(u?!d:!s)return w;if(u){const S=f.attributes;f.attributes=d(S),n.emit("edgeAttributesUpdated",{type:"replace",key:f.key,attributes:f.attributes})}else Y(f.attributes,s),n.emit("edgeAttributesUpdated",{type:"merge",key:f.key,attributes:f.attributes,data:s});return w}s=s||{},u&&d&&(s=d(s));const m={key:null,undirected:e,source:o,target:a,attributes:s};if(r)i=n._edgeKeyGenerator();else if(i=""+i,n._edges.has(i))throw new z(`Graph.${t}: the "${i}" edge already exists in the graph.`);let p=!1,y=!1;c||(c=Wt(n,o,{}),p=!0,o===a&&(h=c,y=!0)),h||(h=Wt(n,a,{}),y=!0),l=new De(e,i,c,h,s),n._edges.set(i,l);const k=o===a;return e?(c.undirectedDegree++,h.undirectedDegree++,k&&(c.undirectedLoops++,n._undirectedSelfLoopCount++)):(c.outDegree++,h.inDegree++,k&&(c.directedLoops++,n._directedSelfLoopCount++)),n.multi?l.attachMulti():l.attach(),e?n._undirectedSize++:n._directedSize++,m.key=i,n.emit("edgeAdded",m),[i,!0,p,y]}function Se(n,t){n._edges.delete(t.key);const{source:r,target:e,attributes:i}=t,o=t.undirected,a=r===e;o?(r.undirectedDegree--,e.undirectedDegree--,a&&(r.undirectedLoops--,n._undirectedSelfLoopCount--)):(r.outDegree--,e.inDegree--,a&&(r.directedLoops--,n._directedSelfLoopCount--)),n.multi?t.detachMulti():t.detach(),o?n._undirectedSize--:n._directedSize--,n.emit("edgeDropped",{key:t.key,attributes:i,source:r.key,target:e.key,undirected:o})}class B extends Sr.EventEmitter{constructor(t){if(super(),t=Y({},Tn,t),typeof t.multi!="boolean")throw new R(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${t.multi}".`);if(!En.has(t.type))throw new R(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${t.type}".`);if(typeof t.allowSelfLoops!="boolean")throw new R(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${t.allowSelfLoops}".`);const r=t.type==="mixed"?Ar:t.type==="directed"?kr:Rr;ne(this,"NodeDataClass",r);const e="geid_"+wn()+"_";let i=0;const o=()=>{let a;do a=e+i++;while(this._edges.has(a));return a};ne(this,"_attributes",{}),ne(this,"_nodes",new Map),ne(this,"_edges",new Map),ne(this,"_directedSize",0),ne(this,"_undirectedSize",0),ne(this,"_directedSelfLoopCount",0),ne(this,"_undirectedSelfLoopCount",0),ne(this,"_edgeKeyGenerator",o),ne(this,"_options",t),Ht.forEach(a=>ne(this,a,this[a])),ue(this,"order",()=>this._nodes.size),ue(this,"size",()=>this._edges.size),ue(this,"directedSize",()=>this._directedSize),ue(this,"undirectedSize",()=>this._undirectedSize),ue(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),ue(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),ue(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),ue(this,"multi",this._options.multi),ue(this,"type",this._options.type),ue(this,"allowSelfLoops",this._options.allowSelfLoops),ue(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(t){return this._nodes.has(""+t)}hasDirectedEdge(t,r){if(this.type==="undirected")return!1;if(arguments.length===1){const e=""+t,i=this._edges.get(e);return!!i&&!i.undirected}else if(arguments.length===2){t=""+t,r=""+r;const e=this._nodes.get(t);return e?e.out.hasOwnProperty(r):!1}throw new R(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(t,r){if(this.type==="directed")return!1;if(arguments.length===1){const e=""+t,i=this._edges.get(e);return!!i&&i.undirected}else if(arguments.length===2){t=""+t,r=""+r;const e=this._nodes.get(t);return e?e.undirected.hasOwnProperty(r):!1}throw new R(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(t,r){if(arguments.length===1){const e=""+t;return this._edges.has(e)}else if(arguments.length===2){t=""+t,r=""+r;const e=this._nodes.get(t);return e?typeof e.out<"u"&&e.out.hasOwnProperty(r)||typeof e.undirected<"u"&&e.undirected.hasOwnProperty(r):!1}throw new R(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(t,r){if(this.type==="undirected")return;if(t=""+t,r=""+r,this.multi)throw new z("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const e=this._nodes.get(t);if(!e)throw new A(`Graph.directedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(r))throw new A(`Graph.directedEdge: could not find the "${r}" target node in the graph.`);const i=e.out&&e.out[r]||void 0;if(i)return i.key}undirectedEdge(t,r){if(this.type==="directed")return;if(t=""+t,r=""+r,this.multi)throw new z("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const e=this._nodes.get(t);if(!e)throw new A(`Graph.undirectedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(r))throw new A(`Graph.undirectedEdge: could not find the "${r}" target node in the graph.`);const i=e.undirected&&e.undirected[r]||void 0;if(i)return i.key}edge(t,r){if(this.multi)throw new z("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");t=""+t,r=""+r;const e=this._nodes.get(t);if(!e)throw new A(`Graph.edge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(r))throw new A(`Graph.edge: could not find the "${r}" target node in the graph.`);const i=e.out&&e.out[r]||e.undirected&&e.undirected[r]||void 0;if(i)return i.key}areDirectedNeighbors(t,r){t=""+t,r=""+r;const e=this._nodes.get(t);if(!e)throw new A(`Graph.areDirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:r in e.in||r in e.out}areOutNeighbors(t,r){t=""+t,r=""+r;const e=this._nodes.get(t);if(!e)throw new A(`Graph.areOutNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:r in e.out}areInNeighbors(t,r){t=""+t,r=""+r;const e=this._nodes.get(t);if(!e)throw new A(`Graph.areInNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:r in e.in}areUndirectedNeighbors(t,r){t=""+t,r=""+r;const e=this._nodes.get(t);if(!e)throw new A(`Graph.areUndirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="directed"?!1:r in e.undirected}areNeighbors(t,r){t=""+t,r=""+r;const e=this._nodes.get(t);if(!e)throw new A(`Graph.areNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&(r in e.in||r in e.out)||this.type!=="directed"&&r in e.undirected}areInboundNeighbors(t,r){t=""+t,r=""+r;const e=this._nodes.get(t);if(!e)throw new A(`Graph.areInboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&r in e.in||this.type!=="directed"&&r in e.undirected}areOutboundNeighbors(t,r){t=""+t,r=""+r;const e=this._nodes.get(t);if(!e)throw new A(`Graph.areOutboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&r in e.out||this.type!=="directed"&&r in e.undirected}inDegree(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.inDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:r.inDegree}outDegree(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.outDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:r.outDegree}directedDegree(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.directedDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:r.inDegree+r.outDegree}undirectedDegree(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.undirectedDegree: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:r.undirectedDegree}inboundDegree(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.inboundDegree: could not find the "${t}" node in the graph.`);let e=0;return this.type!=="directed"&&(e+=r.undirectedDegree),this.type!=="undirected"&&(e+=r.inDegree),e}outboundDegree(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.outboundDegree: could not find the "${t}" node in the graph.`);let e=0;return this.type!=="directed"&&(e+=r.undirectedDegree),this.type!=="undirected"&&(e+=r.outDegree),e}degree(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.degree: could not find the "${t}" node in the graph.`);let e=0;return this.type!=="directed"&&(e+=r.undirectedDegree),this.type!=="undirected"&&(e+=r.inDegree+r.outDegree),e}inDegreeWithoutSelfLoops(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.inDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:r.inDegree-r.directedLoops}outDegreeWithoutSelfLoops(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.outDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:r.outDegree-r.directedLoops}directedDegreeWithoutSelfLoops(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.directedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:r.inDegree+r.outDegree-r.directedLoops*2}undirectedDegreeWithoutSelfLoops(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:r.undirectedDegree-r.undirectedLoops*2}inboundDegreeWithoutSelfLoops(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let e=0,i=0;return this.type!=="directed"&&(e+=r.undirectedDegree,i+=r.undirectedLoops*2),this.type!=="undirected"&&(e+=r.inDegree,i+=r.directedLoops),e-i}outboundDegreeWithoutSelfLoops(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let e=0,i=0;return this.type!=="directed"&&(e+=r.undirectedDegree,i+=r.undirectedLoops*2),this.type!=="undirected"&&(e+=r.outDegree,i+=r.directedLoops),e-i}degreeWithoutSelfLoops(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.degreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let e=0,i=0;return this.type!=="directed"&&(e+=r.undirectedDegree,i+=r.undirectedLoops*2),this.type!=="undirected"&&(e+=r.inDegree+r.outDegree,i+=r.directedLoops*2),e-i}source(t){t=""+t;const r=this._edges.get(t);if(!r)throw new A(`Graph.source: could not find the "${t}" edge in the graph.`);return r.source.key}target(t){t=""+t;const r=this._edges.get(t);if(!r)throw new A(`Graph.target: could not find the "${t}" edge in the graph.`);return r.target.key}extremities(t){t=""+t;const r=this._edges.get(t);if(!r)throw new A(`Graph.extremities: could not find the "${t}" edge in the graph.`);return[r.source.key,r.target.key]}opposite(t,r){t=""+t,r=""+r;const e=this._edges.get(r);if(!e)throw new A(`Graph.opposite: could not find the "${r}" edge in the graph.`);const i=e.source.key,o=e.target.key;if(t===i)return o;if(t===o)return i;throw new A(`Graph.opposite: the "${t}" node is not attached to the "${r}" edge (${i}, ${o}).`)}hasExtremity(t,r){t=""+t,r=""+r;const e=this._edges.get(t);if(!e)throw new A(`Graph.hasExtremity: could not find the "${t}" edge in the graph.`);return e.source.key===r||e.target.key===r}isUndirected(t){t=""+t;const r=this._edges.get(t);if(!r)throw new A(`Graph.isUndirected: could not find the "${t}" edge in the graph.`);return r.undirected}isDirected(t){t=""+t;const r=this._edges.get(t);if(!r)throw new A(`Graph.isDirected: could not find the "${t}" edge in the graph.`);return!r.undirected}isSelfLoop(t){t=""+t;const r=this._edges.get(t);if(!r)throw new A(`Graph.isSelfLoop: could not find the "${t}" edge in the graph.`);return r.source===r.target}addNode(t,r){return xn(this,t,r).key}mergeNode(t,r){if(r&&!Z(r))throw new R(`Graph.mergeNode: invalid attributes. Expecting an object but got "${r}"`);t=""+t,r=r||{};let e=this._nodes.get(t);return e?(r&&(Y(e.attributes,r),this.emit("nodeAttributesUpdated",{type:"merge",key:t,attributes:e.attributes,data:r})),[t,!1]):(e=new this.NodeDataClass(t,r),this._nodes.set(t,e),this.emit("nodeAdded",{key:t,attributes:r}),[t,!0])}updateNode(t,r){if(r&&typeof r!="function")throw new R(`Graph.updateNode: invalid updater function. Expecting a function but got "${r}"`);t=""+t;let e=this._nodes.get(t);if(e){if(r){const o=e.attributes;e.attributes=r(o),this.emit("nodeAttributesUpdated",{type:"replace",key:t,attributes:e.attributes})}return[t,!1]}const i=r?r({}):{};return e=new this.NodeDataClass(t,i),this._nodes.set(t,e),this.emit("nodeAdded",{key:t,attributes:i}),[t,!0]}dropNode(t){t=""+t;const r=this._nodes.get(t);if(!r)throw new A(`Graph.dropNode: could not find the "${t}" node in the graph.`);let e;if(this.type!=="undirected"){for(const i in r.out){e=r.out[i];do Se(this,e),e=e.next;while(e)}for(const i in r.in){e=r.in[i];do Se(this,e),e=e.next;while(e)}}if(this.type!=="directed")for(const i in r.undirected){e=r.undirected[i];do Se(this,e),e=e.next;while(e)}this._nodes.delete(t),this.emit("nodeDropped",{key:t,attributes:r.attributes})}dropEdge(t){let r;if(arguments.length>1){const e=""+arguments[0],i=""+arguments[1];if(r=oe(this,e,i,this.type),!r)throw new A(`Graph.dropEdge: could not find the "${e}" -> "${i}" edge in the graph.`)}else if(t=""+t,r=this._edges.get(t),!r)throw new A(`Graph.dropEdge: could not find the "${t}" edge in the graph.`);return Se(this,r),this}dropDirectedEdge(t,r){if(arguments.length<2)throw new z("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new z("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");t=""+t,r=""+r;const e=oe(this,t,r,"directed");if(!e)throw new A(`Graph.dropDirectedEdge: could not find a "${t}" -> "${r}" edge in the graph.`);return Se(this,e),this}dropUndirectedEdge(t,r){if(arguments.length<2)throw new z("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new z("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const e=oe(this,t,r,"undirected");if(!e)throw new A(`Graph.dropUndirectedEdge: could not find a "${t}" -> "${r}" edge in the graph.`);return Se(this,e),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const t=this._nodes.values();let r;for(;r=t.next(),r.done!==!0;)r.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(t){return this._attributes[t]}getAttributes(){return this._attributes}hasAttribute(t){return this._attributes.hasOwnProperty(t)}setAttribute(t,r){return this._attributes[t]=r,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}updateAttribute(t,r){if(typeof r!="function")throw new R("Graph.updateAttribute: updater should be a function.");const e=this._attributes[t];return this._attributes[t]=r(e),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}removeAttribute(t){return delete this._attributes[t],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:t}),this}replaceAttributes(t){if(!Z(t))throw new R("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=t,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(t){if(!Z(t))throw new R("Graph.mergeAttributes: provided attributes are not a plain object.");return Y(this._attributes,t),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:t}),this}updateAttributes(t){if(typeof t!="function")throw new R("Graph.updateAttributes: provided updater is not a function.");return this._attributes=t(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(t,r){if(typeof t!="function")throw new R("Graph.updateEachNodeAttributes: expecting an updater function.");if(r&&!jt(r))throw new R("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const e=this._nodes.values();let i,o;for(;i=e.next(),i.done!==!0;)o=i.value,o.attributes=t(o.key,o.attributes);this.emit("eachNodeAttributesUpdated",{hints:r||null})}updateEachEdgeAttributes(t,r){if(typeof t!="function")throw new R("Graph.updateEachEdgeAttributes: expecting an updater function.");if(r&&!jt(r))throw new R("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const e=this._edges.values();let i,o,a,s;for(;i=e.next(),i.done!==!0;)o=i.value,a=o.source,s=o.target,o.attributes=t(o.key,o.attributes,a.key,s.key,a.attributes,s.attributes,o.undirected);this.emit("eachEdgeAttributesUpdated",{hints:r||null})}forEachAdjacencyEntry(t){if(typeof t!="function")throw new R("Graph.forEachAdjacencyEntry: expecting a callback.");He(!1,!1,!1,this,t)}forEachAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new R("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");He(!1,!1,!0,this,t)}forEachAssymetricAdjacencyEntry(t){if(typeof t!="function")throw new R("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");He(!1,!0,!1,this,t)}forEachAssymetricAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new R("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");He(!1,!0,!0,this,t)}nodes(){return Array.from(this._nodes.keys())}forEachNode(t){if(typeof t!="function")throw new R("Graph.forEachNode: expecting a callback.");const r=this._nodes.values();let e,i;for(;e=r.next(),e.done!==!0;)i=e.value,t(i.key,i.attributes)}findNode(t){if(typeof t!="function")throw new R("Graph.findNode: expecting a callback.");const r=this._nodes.values();let e,i;for(;e=r.next(),e.done!==!0;)if(i=e.value,t(i.key,i.attributes))return i.key}mapNodes(t){if(typeof t!="function")throw new R("Graph.mapNode: expecting a callback.");const r=this._nodes.values();let e,i;const o=new Array(this.order);let a=0;for(;e=r.next(),e.done!==!0;)i=e.value,o[a++]=t(i.key,i.attributes);return o}someNode(t){if(typeof t!="function")throw new R("Graph.someNode: expecting a callback.");const r=this._nodes.values();let e,i;for(;e=r.next(),e.done!==!0;)if(i=e.value,t(i.key,i.attributes))return!0;return!1}everyNode(t){if(typeof t!="function")throw new R("Graph.everyNode: expecting a callback.");const r=this._nodes.values();let e,i;for(;e=r.next(),e.done!==!0;)if(i=e.value,!t(i.key,i.attributes))return!1;return!0}filterNodes(t){if(typeof t!="function")throw new R("Graph.filterNodes: expecting a callback.");const r=this._nodes.values();let e,i;const o=[];for(;e=r.next(),e.done!==!0;)i=e.value,t(i.key,i.attributes)&&o.push(i.key);return o}reduceNodes(t,r){if(typeof t!="function")throw new R("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new R("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let e=r;const i=this._nodes.values();let o,a;for(;o=i.next(),o.done!==!0;)a=o.value,e=t(e,a.key,a.attributes);return e}nodeEntries(){const t=this._nodes.values();return{[Symbol.iterator](){return this},next(){const r=t.next();if(r.done)return r;const e=r.value;return{value:{node:e.key,attributes:e.attributes},done:!1}}}}export(){const t=new Array(this._nodes.size);let r=0;this._nodes.forEach((i,o)=>{t[r++]=vn(o,i)});const e=new Array(this._edges.size);return r=0,this._edges.forEach((i,o)=>{e[r++]=mn(this.type,o,i)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:t,edges:e}}import(t,r=!1){if(t instanceof B)return t.forEachNode((u,d)=>{r?this.mergeNode(u,d):this.addNode(u,d)}),t.forEachEdge((u,d,c,h,l,f,m)=>{r?m?this.mergeUndirectedEdgeWithKey(u,c,h,d):this.mergeDirectedEdgeWithKey(u,c,h,d):m?this.addUndirectedEdgeWithKey(u,c,h,d):this.addDirectedEdgeWithKey(u,c,h,d)}),this;if(!Z(t))throw new R("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(t.attributes){if(!Z(t.attributes))throw new R("Graph.import: invalid attributes. Expecting a plain object.");r?this.mergeAttributes(t.attributes):this.replaceAttributes(t.attributes)}let e,i,o,a,s;if(t.nodes){if(o=t.nodes,!Array.isArray(o))throw new R("Graph.import: invalid nodes. Expecting an array.");for(e=0,i=o.length;e<i;e++){a=o[e],yn(a);const{key:u,attributes:d}=a;r?this.mergeNode(u,d):this.addNode(u,d)}}if(t.edges){let u=!1;if(this.type==="undirected"&&(u=!0),o=t.edges,!Array.isArray(o))throw new R("Graph.import: invalid edges. Expecting an array.");for(e=0,i=o.length;e<i;e++){s=o[e],bn(s);const{source:d,target:c,attributes:h,undirected:l=u}=s;let f;"key"in s?(f=r?l?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:l?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,f.call(this,s.key,d,c,h)):(f=r?l?this.mergeUndirectedEdge:this.mergeDirectedEdge:l?this.addUndirectedEdge:this.addDirectedEdge,f.call(this,d,c,h))}}return this}nullCopy(t){const r=new B(Y({},this._options,t));return r.replaceAttributes(Y({},this.getAttributes())),r}emptyCopy(t){const r=this.nullCopy(t);return this._nodes.forEach((e,i)=>{const o=Y({},e.attributes);e=new r.NodeDataClass(i,o),r._nodes.set(i,e)}),r}copy(t){if(t=t||{},typeof t.type=="string"&&t.type!==this.type&&t.type!=="mixed")throw new z(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${t.type}" because this would mean losing information about the current graph.`);if(typeof t.multi=="boolean"&&t.multi!==this.multi&&t.multi!==!0)throw new z("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof t.allowSelfLoops=="boolean"&&t.allowSelfLoops!==this.allowSelfLoops&&t.allowSelfLoops!==!0)throw new z("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const r=this.emptyCopy(t),e=this._edges.values();let i,o;for(;i=e.next(),i.done!==!0;)o=i.value,Fr(r,"copy",!1,o.undirected,o.key,o.source.key,o.target.key,Y({},o.attributes));return r}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const t={};this._nodes.forEach((o,a)=>{t[a]=o.attributes});const r={},e={};this._edges.forEach((o,a)=>{const s=o.undirected?"--":"->";let u="",d=o.source.key,c=o.target.key,h;o.undirected&&d>c&&(h=d,d=c,c=h);const l=`(${d})${s}(${c})`;a.startsWith("geid_")?this.multi&&(typeof e[l]>"u"?e[l]=0:e[l]++,u+=`${e[l]}. `):u+=`[${a}]: `,u+=l,r[u]=o.attributes});const i={};for(const o in this)this.hasOwnProperty(o)&&!Ht.has(o)&&typeof this[o]!="function"&&typeof o!="symbol"&&(i[o]=this[o]);return i.attributes=this._attributes,i.nodes=t,i.edges=r,ne(i,"constructor",this.constructor),i}}typeof Symbol<"u"&&(B.prototype[Symbol.for("nodejs.util.inspect.custom")]=B.prototype.inspect);_n.forEach(n=>{["add","merge","update"].forEach(t=>{const r=n.name(t),e=t==="add"?Fr:Sn;n.generateKey?B.prototype[r]=function(i,o,a){return e(this,r,!0,(n.type||this.type)==="undirected",null,i,o,a,t==="update")}:B.prototype[r]=function(i,o,a,s){return e(this,r,!1,(n.type||this.type)==="undirected",i,o,a,s,t==="update")}})});Gi(B);Hi(B);sn(B);pn(B);class Pr extends B{constructor(t){const r=Y({type:"directed"},t);if("multi"in r&&r.multi!==!1)throw new R("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(r.type!=="directed")throw new R('DirectedGraph.from: inconsistent "'+r.type+'" type in given options!');super(r)}}class zr extends B{constructor(t){const r=Y({type:"undirected"},t);if("multi"in r&&r.multi!==!1)throw new R("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(r.type!=="undirected")throw new R('UndirectedGraph.from: inconsistent "'+r.type+'" type in given options!');super(r)}}class Or extends B{constructor(t){const r=Y({multi:!0},t);if("multi"in r&&r.multi!==!0)throw new R("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(r)}}class Ir extends B{constructor(t){const r=Y({type:"directed",multi:!0},t);if("multi"in r&&r.multi!==!0)throw new R("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(r.type!=="directed")throw new R('MultiDirectedGraph.from: inconsistent "'+r.type+'" type in given options!');super(r)}}class Mr extends B{constructor(t){const r=Y({type:"undirected",multi:!0},t);if("multi"in r&&r.multi!==!0)throw new R("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(r.type!=="undirected")throw new R('MultiUndirectedGraph.from: inconsistent "'+r.type+'" type in given options!');super(r)}}function Ge(n){n.from=function(t,r){const e=Y({},t.options,r),i=new n(e);return i.import(t),i}}Ge(B);Ge(Pr);Ge(zr);Ge(Or);Ge(Ir);Ge(Mr);B.Graph=B;B.DirectedGraph=Pr;B.UndirectedGraph=zr;B.MultiGraph=Or;B.MultiDirectedGraph=Ir;B.MultiUndirectedGraph=Mr;B.InvalidArgumentsGraphError=R;B.NotFoundGraphError=A;B.UsageGraphError=z;function Cn(n,t){if(typeof n!="object"||!n)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var e=r.call(n,t);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function Ue(n){var t=Cn(n,"string");return typeof t=="symbol"?t:t+""}function J(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function Vt(n,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,Ue(e.key),e)}}function ee(n,t,r){return t&&Vt(n.prototype,t),r&&Vt(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}function Re(n){return Re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Re(n)}function $r(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return($r=function(){return!!n})()}function An(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function kn(n,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return An(n)}function ae(n,t,r){return t=Re(t),kn(n,$r()?Reflect.construct(t,r||[],Re(n).constructor):t.apply(n,r))}function bt(n,t){return bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},bt(n,t)}function se(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&bt(n,t)}function Rn(n){if(Array.isArray(n))return n}function Ln(n,t){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var e,i,o,a,s=[],u=!0,d=!1;try{if(o=(r=r.call(n)).next,t===0){if(Object(r)!==r)return;u=!1}else for(;!(u=(e=o.call(r)).done)&&(s.push(e.value),s.length!==t);u=!0);}catch(c){d=!0,i=c}finally{try{if(!u&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(d)throw i}}return s}}function wt(n,t){(t==null||t>n.length)&&(t=n.length);for(var r=0,e=Array(t);r<t;r++)e[r]=n[r];return e}function Ur(n,t){if(n){if(typeof n=="string")return wt(n,t);var r={}.toString.call(n).slice(8,-1);return r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set"?Array.from(n):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?wt(n,t):void 0}}function Nn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Le(n,t){return Rn(n)||Ln(n,t)||Ur(n,t)||Nn()}var st={black:"#000000",silver:"#C0C0C0",gray:"#808080",grey:"#808080",white:"#FFFFFF",maroon:"#800000",red:"#FF0000",purple:"#800080",fuchsia:"#FF00FF",green:"#008000",lime:"#00FF00",olive:"#808000",yellow:"#FFFF00",navy:"#000080",blue:"#0000FF",teal:"#008080",aqua:"#00FFFF",darkblue:"#00008B",mediumblue:"#0000CD",darkgreen:"#006400",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",springgreen:"#00FF7F",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",rebeccapurple:"#663399",mediumaquamarine:"#66CDAA",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370DB",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",palevioletred:"#DB7093",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",lightyellow:"#FFFFE0",ivory:"#FFFFF0"},Br=new Int8Array(4),Ze=new Int32Array(Br.buffer,0,1),jr=new Float32Array(Br.buffer,0,1),Dn=/^\s*rgba?\s*\(/,Gn=/^\s*rgba?\s*\(\s*([0-9]*)\s*,\s*([0-9]*)\s*,\s*([0-9]*)(?:\s*,\s*(.*)?)?\)\s*$/;function Fn(n){var t=0,r=0,e=0,i=1;if(n[0]==="#")n.length===4?(t=parseInt(n.charAt(1)+n.charAt(1),16),r=parseInt(n.charAt(2)+n.charAt(2),16),e=parseInt(n.charAt(3)+n.charAt(3),16)):(t=parseInt(n.charAt(1)+n.charAt(2),16),r=parseInt(n.charAt(3)+n.charAt(4),16),e=parseInt(n.charAt(5)+n.charAt(6),16)),n.length===9&&(i=parseInt(n.charAt(7)+n.charAt(8),16)/255);else if(Dn.test(n)){var o=n.match(Gn);o&&(t=+o[1],r=+o[2],e=+o[3],o[4]&&(i=+o[4]))}return{r:t,g:r,b:e,a:i}}var ke={};for(var We in st)ke[We]=me(st[We]),ke[st[We]]=ke[We];function Hr(n,t,r,e,i){return Ze[0]=e<<24|r<<16|t<<8|n,Ze[0]=Ze[0]&4278190079,jr[0]}function me(n){if(n=n.toLowerCase(),typeof ke[n]<"u")return ke[n];var t=Fn(n),r=t.r,e=t.g,i=t.b,o=t.a;o=o*255|0;var a=Hr(r,e,i,o);return ke[n]=a,a}function Pn(n,t){jr[0]=me(n);var r=Ze[0],e=r&255,i=r>>8&255,o=r>>16&255,a=r>>24&255;return[e,i,o,a]}var ut={};function Wr(n){if(typeof ut[n]<"u")return ut[n];var t=(n&16711680)>>>16,r=(n&65280)>>>8,e=n&255,i=255,o=Hr(t,r,e,i);return ut[n]=o,o}function qt(n,t,r,e){return r+(t<<8)+(n<<16)}function Yt(n,t,r,e,i,o){var a=Math.floor(r/o*i),s=Math.floor(n.drawingBufferHeight/o-e/o*i),u=new Uint8Array(4);n.bindFramebuffer(n.FRAMEBUFFER,t),n.readPixels(a,s,1,1,n.RGBA,n.UNSIGNED_BYTE,u);var d=Le(u,4),c=d[0],h=d[1],l=d[2],f=d[3];return[c,h,l,f]}function E(n,t,r){return(t=Ue(t))in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function Kt(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);t&&(e=e.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),r.push.apply(r,e)}return r}function G(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Kt(Object(r),!0).forEach(function(e){E(n,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Kt(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})}return n}function zn(n,t){for(;!{}.hasOwnProperty.call(n,t)&&(n=Re(n))!==null;);return n}function Et(){return Et=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,t,r){var e=zn(n,t);if(e){var i=Object.getOwnPropertyDescriptor(e,t);return i.get?i.get.call(arguments.length<3?n:r):i.value}},Et.apply(null,arguments)}function Vr(n,t,r,e){var i=Et(Re(n.prototype),t,r);return typeof i=="function"?function(o){return i.apply(r,o)}:i}function On(n){return n.normalized?1:n.size}function dt(n){var t=0;return n.forEach(function(r){return t+=On(r)}),t}function qr(n,t,r){var e=n==="VERTEX"?t.VERTEX_SHADER:t.FRAGMENT_SHADER,i=t.createShader(e);if(i===null)throw new Error("loadShader: error while creating the shader");t.shaderSource(i,r),t.compileShader(i);var o=t.getShaderParameter(i,t.COMPILE_STATUS);if(!o){var a=t.getShaderInfoLog(i);throw t.deleteShader(i),new Error(`loadShader: error while compiling the shader:
`.concat(a,`
`).concat(r))}return i}function In(n,t){return qr("VERTEX",n,t)}function Mn(n,t){return qr("FRAGMENT",n,t)}function $n(n,t){var r=n.createProgram();if(r===null)throw new Error("loadProgram: error while creating the program.");var e,i;for(e=0,i=t.length;e<i;e++)n.attachShader(r,t[e]);n.linkProgram(r);var o=n.getProgramParameter(r,n.LINK_STATUS);if(!o)throw n.deleteProgram(r),new Error("loadProgram: error while linking the program.");return r}function Xt(n){var t=n.gl,r=n.buffer,e=n.program,i=n.vertexShader,o=n.fragmentShader;t.deleteShader(i),t.deleteShader(o),t.deleteProgram(e),t.deleteBuffer(r)}function Zt(n){return n%1===0?n.toFixed(1):n.toString()}var Qt=`#define PICKING_MODE
`,Un=E(E(E(E(E(E(E(E({},WebGL2RenderingContext.BOOL,1),WebGL2RenderingContext.BYTE,1),WebGL2RenderingContext.UNSIGNED_BYTE,1),WebGL2RenderingContext.SHORT,2),WebGL2RenderingContext.UNSIGNED_SHORT,2),WebGL2RenderingContext.INT,4),WebGL2RenderingContext.UNSIGNED_INT,4),WebGL2RenderingContext.FLOAT,4),Yr=(function(){function n(t,r,e){J(this,n),E(this,"array",new Float32Array),E(this,"constantArray",new Float32Array),E(this,"capacity",0),E(this,"verticesCount",0);var i=this.getDefinition();if(this.VERTICES=i.VERTICES,this.VERTEX_SHADER_SOURCE=i.VERTEX_SHADER_SOURCE,this.FRAGMENT_SHADER_SOURCE=i.FRAGMENT_SHADER_SOURCE,this.UNIFORMS=i.UNIFORMS,this.ATTRIBUTES=i.ATTRIBUTES,this.METHOD=i.METHOD,this.CONSTANT_ATTRIBUTES="CONSTANT_ATTRIBUTES"in i?i.CONSTANT_ATTRIBUTES:[],this.CONSTANT_DATA="CONSTANT_DATA"in i?i.CONSTANT_DATA:[],this.isInstanced="CONSTANT_ATTRIBUTES"in i,this.ATTRIBUTES_ITEMS_COUNT=dt(this.ATTRIBUTES),this.STRIDE=this.VERTICES*this.ATTRIBUTES_ITEMS_COUNT,this.renderer=e,this.normalProgram=this.getProgramInfo("normal",t,i.VERTEX_SHADER_SOURCE,i.FRAGMENT_SHADER_SOURCE,null),this.pickProgram=r?this.getProgramInfo("pick",t,Qt+i.VERTEX_SHADER_SOURCE,Qt+i.FRAGMENT_SHADER_SOURCE,r):null,this.isInstanced){var o=dt(this.CONSTANT_ATTRIBUTES);if(this.CONSTANT_DATA.length!==this.VERTICES)throw new Error("Program: error while getting constant data (expected ".concat(this.VERTICES," items, received ").concat(this.CONSTANT_DATA.length," instead)"));this.constantArray=new Float32Array(this.CONSTANT_DATA.length*o);for(var a=0;a<this.CONSTANT_DATA.length;a++){var s=this.CONSTANT_DATA[a];if(s.length!==o)throw new Error("Program: error while getting constant data (one vector has ".concat(s.length," items instead of ").concat(o,")"));for(var u=0;u<s.length;u++)this.constantArray[a*o+u]=s[u]}this.STRIDE=this.ATTRIBUTES_ITEMS_COUNT}}return ee(n,[{key:"kill",value:function(){Xt(this.normalProgram),this.pickProgram&&(Xt(this.pickProgram),this.pickProgram=null)}},{key:"getProgramInfo",value:function(r,e,i,o,a){var s=this.getDefinition(),u=e.createBuffer();if(u===null)throw new Error("Program: error while creating the WebGL buffer.");var d=In(e,i),c=Mn(e,o),h=$n(e,[d,c]),l={};s.UNIFORMS.forEach(function(p){var y=e.getUniformLocation(h,p);y&&(l[p]=y)});var f={};s.ATTRIBUTES.forEach(function(p){f[p.name]=e.getAttribLocation(h,p.name)});var m;if("CONSTANT_ATTRIBUTES"in s&&(s.CONSTANT_ATTRIBUTES.forEach(function(p){f[p.name]=e.getAttribLocation(h,p.name)}),m=e.createBuffer(),m===null))throw new Error("Program: error while creating the WebGL constant buffer.");return{name:r,program:h,gl:e,frameBuffer:a,buffer:u,constantBuffer:m||{},uniformLocations:l,attributeLocations:f,isPicking:r==="pick",vertexShader:d,fragmentShader:c}}},{key:"bindProgram",value:function(r){var e=this,i=0,o=r.gl,a=r.buffer;this.isInstanced?(o.bindBuffer(o.ARRAY_BUFFER,r.constantBuffer),i=0,this.CONSTANT_ATTRIBUTES.forEach(function(s){return i+=e.bindAttribute(s,r,i,!1)}),o.bufferData(o.ARRAY_BUFFER,this.constantArray,o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,r.buffer),i=0,this.ATTRIBUTES.forEach(function(s){return i+=e.bindAttribute(s,r,i,!0)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)):(o.bindBuffer(o.ARRAY_BUFFER,a),i=0,this.ATTRIBUTES.forEach(function(s){return i+=e.bindAttribute(s,r,i)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)),o.bindBuffer(o.ARRAY_BUFFER,null)}},{key:"unbindProgram",value:function(r){var e=this;this.isInstanced?(this.CONSTANT_ATTRIBUTES.forEach(function(i){return e.unbindAttribute(i,r,!1)}),this.ATTRIBUTES.forEach(function(i){return e.unbindAttribute(i,r,!0)})):this.ATTRIBUTES.forEach(function(i){return e.unbindAttribute(i,r)})}},{key:"bindAttribute",value:function(r,e,i,o){var a=Un[r.type];if(typeof a!="number")throw new Error('Program.bind: yet unsupported attribute type "'.concat(r.type,'"'));var s=e.attributeLocations[r.name],u=e.gl;if(s!==-1){u.enableVertexAttribArray(s);var d=this.isInstanced?(o?this.ATTRIBUTES_ITEMS_COUNT:dt(this.CONSTANT_ATTRIBUTES))*Float32Array.BYTES_PER_ELEMENT:this.ATTRIBUTES_ITEMS_COUNT*Float32Array.BYTES_PER_ELEMENT;if(u.vertexAttribPointer(s,r.size,r.type,r.normalized||!1,d,i),this.isInstanced&&o)if(u instanceof WebGL2RenderingContext)u.vertexAttribDivisor(s,1);else{var c=u.getExtension("ANGLE_instanced_arrays");c&&c.vertexAttribDivisorANGLE(s,1)}}return r.size*a}},{key:"unbindAttribute",value:function(r,e,i){var o=e.attributeLocations[r.name],a=e.gl;if(o!==-1&&(a.disableVertexAttribArray(o),this.isInstanced&&i))if(a instanceof WebGL2RenderingContext)a.vertexAttribDivisor(o,0);else{var s=a.getExtension("ANGLE_instanced_arrays");s&&s.vertexAttribDivisorANGLE(o,0)}}},{key:"reallocate",value:function(r){r!==this.capacity&&(this.capacity=r,this.verticesCount=this.VERTICES*r,this.array=new Float32Array(this.isInstanced?this.capacity*this.ATTRIBUTES_ITEMS_COUNT:this.verticesCount*this.ATTRIBUTES_ITEMS_COUNT))}},{key:"hasNothingToRender",value:function(){return this.verticesCount===0}},{key:"renderProgram",value:function(r,e){var i=e.gl,o=e.program;i.enable(i.BLEND),i.useProgram(o),this.setUniforms(r,e),this.drawWebGL(this.METHOD,e)}},{key:"render",value:function(r){this.hasNothingToRender()||(this.pickProgram&&(this.pickProgram.gl.viewport(0,0,r.width*r.pixelRatio/r.downSizingRatio,r.height*r.pixelRatio/r.downSizingRatio),this.bindProgram(this.pickProgram),this.renderProgram(G(G({},r),{},{pixelRatio:r.pixelRatio/r.downSizingRatio}),this.pickProgram),this.unbindProgram(this.pickProgram)),this.normalProgram.gl.viewport(0,0,r.width*r.pixelRatio,r.height*r.pixelRatio),this.bindProgram(this.normalProgram),this.renderProgram(r,this.normalProgram),this.unbindProgram(this.normalProgram))}},{key:"drawWebGL",value:function(r,e){var i=e.gl,o=e.frameBuffer;if(i.bindFramebuffer(i.FRAMEBUFFER,o),!this.isInstanced)i.drawArrays(r,0,this.verticesCount);else if(i instanceof WebGL2RenderingContext)i.drawArraysInstanced(r,0,this.VERTICES,this.capacity);else{var a=i.getExtension("ANGLE_instanced_arrays");a&&a.drawArraysInstancedANGLE(r,0,this.VERTICES,this.capacity)}}}])})(),Ft=(function(n){function t(){return J(this,t),ae(this,t,arguments)}return se(t,n),ee(t,[{key:"kill",value:function(){Vr(t,"kill",this)([])}},{key:"process",value:function(e,i,o){var a=i*this.STRIDE;if(o.hidden){for(var s=a+this.STRIDE;a<s;a++)this.array[a]=0;return}return this.processVisibleItem(Wr(e),a,o)}}])})(Yr),rt=(function(n){function t(){var r;J(this,t);for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r=ae(this,t,[].concat(i)),E(r,"drawLabel",void 0),r}return se(t,n),ee(t,[{key:"kill",value:function(){Vr(t,"kill",this)([])}},{key:"process",value:function(e,i,o,a,s){var u=i*this.STRIDE;if(s.hidden||o.hidden||a.hidden){for(var d=u+this.STRIDE;u<d;u++)this.array[u]=0;return}return this.processVisibleItem(Wr(e),u,o,a,s)}}])})(Yr);function Bn(n,t){return(function(){function r(e,i,o){J(this,r),E(this,"drawLabel",t),this.programs=n.map(function(a){return new a(e,i,o)})}return ee(r,[{key:"reallocate",value:function(i){this.programs.forEach(function(o){return o.reallocate(i)})}},{key:"process",value:function(i,o,a,s,u){this.programs.forEach(function(d){return d.process(i,o,a,s,u)})}},{key:"render",value:function(i){this.programs.forEach(function(o){return o.render(i)})}},{key:"kill",value:function(){this.programs.forEach(function(i){return i.kill()})}}])})()}function jn(n,t,r,e,i){var o=i.edgeLabelSize,a=i.edgeLabelFont,s=i.edgeLabelWeight,u=i.edgeLabelColor.attribute?t[i.edgeLabelColor.attribute]||i.edgeLabelColor.color||"#000":i.edgeLabelColor.color,d=t.label;if(d){n.fillStyle=u,n.font="".concat(s," ").concat(o,"px ").concat(a);var c=r.size,h=e.size,l=r.x,f=r.y,m=e.x,p=e.y,y=(l+m)/2,k=(f+p)/2,w=m-l,S=p-f,g=Math.sqrt(w*w+S*S);if(!(g<c+h)){l+=w*c/g,f+=S*c/g,m-=w*h/g,p-=S*h/g,y=(l+m)/2,k=(f+p)/2,w=m-l,S=p-f,g=Math.sqrt(w*w+S*S);var v=n.measureText(d).width;if(v>g){var b="";for(d=d+b,v=n.measureText(d).width;v>g&&d.length>1;)d=d.slice(0,-2)+b,v=n.measureText(d).width;if(d.length<4)return}var T;w>0?S>0?T=Math.acos(w/g):T=Math.asin(S/g):S>0?T=Math.acos(w/g)+Math.PI:T=Math.asin(w/g)+Math.PI/2,n.save(),n.translate(y,k),n.rotate(T),n.fillText(d,-v/2,t.size/2+o),n.restore()}}}function Pt(n,t,r){if(t.label){var e=r.labelSize,i=r.labelFont,o=r.labelWeight,a=r.labelColor.attribute?t[r.labelColor.attribute]||r.labelColor.color||"#000":r.labelColor.color;n.fillStyle=a,n.font="".concat(o," ").concat(e,"px ").concat(i),n.fillText(t.label,t.x+t.size+3,t.y+e/3)}}function Hn(n,t,r){var e=r.labelSize,i=r.labelFont,o=r.labelWeight;n.font="".concat(o," ").concat(e,"px ").concat(i),n.fillStyle="#FFF",n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=8,n.shadowColor="#000";var a=2;if(typeof t.label=="string"){var s=n.measureText(t.label).width,u=Math.round(s+5),d=Math.round(e+2*a),c=Math.max(t.size,e/2)+a,h=Math.asin(d/2/c),l=Math.sqrt(Math.abs(Math.pow(c,2)-Math.pow(d/2,2)));n.beginPath(),n.moveTo(t.x+l,t.y+d/2),n.lineTo(t.x+c+u,t.y+d/2),n.lineTo(t.x+c+u,t.y-d/2),n.lineTo(t.x+l,t.y-d/2),n.arc(t.x,t.y,c,h,-h),n.closePath(),n.fill()}else n.beginPath(),n.arc(t.x,t.y,t.size+a,0,Math.PI*2),n.closePath(),n.fill();n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,Pt(n,t,r)}var Wn=`
precision highp float;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;

uniform float u_correctionRatio;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float border = u_correctionRatio * 2.0;
  float dist = length(v_diffVector) - v_radius + border;

  // No antialiasing for picking mode:
  #ifdef PICKING_MODE
  if (dist > border)
    gl_FragColor = transparent;
  else
    gl_FragColor = v_color;

  #else
  float t = 0.0;
  if (dist > border)
    t = 1.0;
  else if (dist > 0.0)
    t = dist / border;

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Vn=Wn,qn=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;
varying float v_border;

const float bias = 255.0 / 254.0;

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;
  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  v_diffVector = diffVector;
  v_radius = size / 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Yn=qn,Kr=WebGLRenderingContext,Jt=Kr.UNSIGNED_BYTE,ct=Kr.FLOAT,Kn=["u_sizeRatio","u_correctionRatio","u_matrix"],it=(function(n){function t(){return J(this,t),ae(this,t,arguments)}return se(t,n),ee(t,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:Yn,FRAGMENT_SHADER_SOURCE:Vn,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Kn,ATTRIBUTES:[{name:"a_position",size:2,type:ct},{name:"a_size",size:1,type:ct},{name:"a_color",size:4,type:Jt,normalized:!0},{name:"a_id",size:4,type:Jt,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:ct}],CONSTANT_DATA:[[t.ANGLE_1],[t.ANGLE_2],[t.ANGLE_3]]}}},{key:"processVisibleItem",value:function(e,i,o){var a=this.array,s=me(o.color);a[i++]=o.x,a[i++]=o.y,a[i++]=o.size,a[i++]=s,a[i++]=e}},{key:"setUniforms",value:function(e,i){var o=i.gl,a=i.uniformLocations,s=a.u_sizeRatio,u=a.u_correctionRatio,d=a.u_matrix;o.uniform1f(u,e.correctionRatio),o.uniform1f(s,e.sizeRatio),o.uniformMatrix3fv(d,!1,e.matrix)}}])})(Ft);E(it,"ANGLE_1",0);E(it,"ANGLE_2",2*Math.PI/3);E(it,"ANGLE_3",4*Math.PI/3);var Xn=`
precision mediump float;

varying vec4 v_color;

void main(void) {
  gl_FragColor = v_color;
}
`,Zn=Xn,Qn=`
attribute vec2 a_position;
attribute vec2 a_normal;
attribute float a_radius;
attribute vec3 a_barycentric;

#ifdef PICKING_MODE
attribute vec4 a_id;
#else
attribute vec4 a_color;
#endif

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;

varying vec4 v_color;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float normalLength = length(a_normal);
  vec2 unitNormal = a_normal / normalLength;

  // These first computations are taken from edge.vert.glsl and
  // edge.clamped.vert.glsl. Please read it to get better comments on what's
  // happening:
  float pixelsThickness = max(normalLength / u_sizeRatio, minThickness);
  float webGLThickness = pixelsThickness * u_correctionRatio;
  float webGLNodeRadius = a_radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;
  float webGLArrowHeadThickness = webGLThickness * u_widenessToThicknessRatio;

  float da = a_barycentric.x;
  float db = a_barycentric.y;
  float dc = a_barycentric.z;

  vec2 delta = vec2(
      da * (webGLNodeRadius * unitNormal.y)
    + db * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y + webGLArrowHeadThickness * unitNormal.x)
    + dc * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y - webGLArrowHeadThickness * unitNormal.x),

      da * (-webGLNodeRadius * unitNormal.x)
    + db * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x + webGLArrowHeadThickness * unitNormal.y)
    + dc * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x - webGLArrowHeadThickness * unitNormal.y)
  );

  vec2 position = (u_matrix * vec3(a_position + delta, 1)).xy;

  gl_Position = vec4(position, 0, 1);

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Jn=Qn,Xr=WebGLRenderingContext,er=Xr.UNSIGNED_BYTE,Ve=Xr.FLOAT,eo=["u_matrix","u_sizeRatio","u_correctionRatio","u_minEdgeThickness","u_lengthToThicknessRatio","u_widenessToThicknessRatio"],nt={extremity:"target",lengthToThicknessRatio:2.5,widenessToThicknessRatio:2};function Zr(n){var t=G(G({},nt),{});return(function(r){function e(){return J(this,e),ae(this,e,arguments)}return se(e,r),ee(e,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:Jn,FRAGMENT_SHADER_SOURCE:Zn,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:eo,ATTRIBUTES:[{name:"a_position",size:2,type:Ve},{name:"a_normal",size:2,type:Ve},{name:"a_radius",size:1,type:Ve},{name:"a_color",size:4,type:er,normalized:!0},{name:"a_id",size:4,type:er,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_barycentric",size:3,type:Ve}],CONSTANT_DATA:[[1,0,0],[0,1,0],[0,0,1]]}}},{key:"processVisibleItem",value:function(o,a,s,u,d){if(t.extremity==="source"){var c=[u,s];s=c[0],u=c[1]}var h=d.size||1,l=u.size||1,f=s.x,m=s.y,p=u.x,y=u.y,k=me(d.color),w=p-f,S=y-m,g=w*w+S*S,v=0,b=0;g&&(g=1/Math.sqrt(g),v=-S*g*h,b=w*g*h);var T=this.array;T[a++]=p,T[a++]=y,T[a++]=-v,T[a++]=-b,T[a++]=l,T[a++]=k,T[a++]=o}},{key:"setUniforms",value:function(o,a){var s=a.gl,u=a.uniformLocations,d=u.u_matrix,c=u.u_sizeRatio,h=u.u_correctionRatio,l=u.u_minEdgeThickness,f=u.u_lengthToThicknessRatio,m=u.u_widenessToThicknessRatio;s.uniformMatrix3fv(d,!1,o.matrix),s.uniform1f(c,o.sizeRatio),s.uniform1f(h,o.correctionRatio),s.uniform1f(l,o.minEdgeThickness),s.uniform1f(f,t.lengthToThicknessRatio),s.uniform1f(m,t.widenessToThicknessRatio)}}])})(rt)}Zr();var to=`
precision mediump float;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  // We only handle antialiasing for normal mode:
  #ifdef PICKING_MODE
  gl_FragColor = v_color;
  #else
  float dist = length(v_normal) * v_thickness;

  float t = smoothstep(
    v_thickness - v_feather,
    v_thickness,
    dist
  );

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Qr=to,ro=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;
attribute float a_radius;
attribute float a_radiusCoef;

uniform mat3 u_matrix;
uniform float u_zoomRatio;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float radius = a_radius * a_radiusCoef;
  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // These first computations are taken from edge.vert.glsl. Please read it to
  // get better comments on what's happening:
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here, we move the point to leave space for the arrow head:
  float direction = sign(radius);
  float webGLNodeRadius = direction * radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;

  vec2 compensationVector = vec2(-direction * unitNormal.y, direction * unitNormal.x) * (webGLNodeRadius + webGLArrowHeadLength);

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness + compensationVector, 1)).xy, 0, 1);

  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,io=ro,Jr=WebGLRenderingContext,tr=Jr.UNSIGNED_BYTE,_e=Jr.FLOAT,no=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness","u_lengthToThicknessRatio"],oo={lengthToThicknessRatio:nt.lengthToThicknessRatio};function ei(n){var t=G(G({},oo),{});return(function(r){function e(){return J(this,e),ae(this,e,arguments)}return se(e,r),ee(e,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:io,FRAGMENT_SHADER_SOURCE:Qr,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:no,ATTRIBUTES:[{name:"a_positionStart",size:2,type:_e},{name:"a_positionEnd",size:2,type:_e},{name:"a_normal",size:2,type:_e},{name:"a_color",size:4,type:tr,normalized:!0},{name:"a_id",size:4,type:tr,normalized:!0},{name:"a_radius",size:1,type:_e}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:_e},{name:"a_normalCoef",size:1,type:_e},{name:"a_radiusCoef",size:1,type:_e}],CONSTANT_DATA:[[0,1,0],[0,-1,0],[1,1,1],[1,1,1],[0,-1,0],[1,-1,-1]]}}},{key:"processVisibleItem",value:function(o,a,s,u,d){var c=d.size||1,h=s.x,l=s.y,f=u.x,m=u.y,p=me(d.color),y=f-h,k=m-l,w=u.size||1,S=y*y+k*k,g=0,v=0;S&&(S=1/Math.sqrt(S),g=-k*S*c,v=y*S*c);var b=this.array;b[a++]=h,b[a++]=l,b[a++]=f,b[a++]=m,b[a++]=g,b[a++]=v,b[a++]=p,b[a++]=o,b[a++]=w}},{key:"setUniforms",value:function(o,a){var s=a.gl,u=a.uniformLocations,d=u.u_matrix,c=u.u_zoomRatio,h=u.u_feather,l=u.u_pixelRatio,f=u.u_correctionRatio,m=u.u_sizeRatio,p=u.u_minEdgeThickness,y=u.u_lengthToThicknessRatio;s.uniformMatrix3fv(d,!1,o.matrix),s.uniform1f(c,o.zoomRatio),s.uniform1f(m,o.sizeRatio),s.uniform1f(f,o.correctionRatio),s.uniform1f(l,o.pixelRatio),s.uniform1f(h,o.antiAliasingFeather),s.uniform1f(p,o.minEdgeThickness),s.uniform1f(y,t.lengthToThicknessRatio)}}])})(rt)}ei();function ao(n){return Bn([ei(),Zr()])}var so=ao(),uo=so,co=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_zoomRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // We require edges to be at least "minThickness" pixels thick *on screen*
  // (so we need to compensate the size ratio):
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);

  // Then, we need to retrieve the normalized thickness of the edge in the WebGL
  // referential (in a ([0, 1], [0, 1]) space), using our "magic" correction
  // ratio:
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness, 1)).xy, 0, 1);

  // For the fragment shader though, we need a thickness that takes the "magic"
  // correction ratio into account (as in webGLThickness), but so that the
  // antialiasing effect does not depend on the zoom level. So here's yet
  // another thickness version:
  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,ho=co,ti=WebGLRenderingContext,rr=ti.UNSIGNED_BYTE,Oe=ti.FLOAT,lo=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness"],fo=(function(n){function t(){return J(this,t),ae(this,t,arguments)}return se(t,n),ee(t,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:ho,FRAGMENT_SHADER_SOURCE:Qr,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:lo,ATTRIBUTES:[{name:"a_positionStart",size:2,type:Oe},{name:"a_positionEnd",size:2,type:Oe},{name:"a_normal",size:2,type:Oe},{name:"a_color",size:4,type:rr,normalized:!0},{name:"a_id",size:4,type:rr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:Oe},{name:"a_normalCoef",size:1,type:Oe}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[1,1],[0,-1],[1,-1]]}}},{key:"processVisibleItem",value:function(e,i,o,a,s){var u=s.size||1,d=o.x,c=o.y,h=a.x,l=a.y,f=me(s.color),m=h-d,p=l-c,y=m*m+p*p,k=0,w=0;y&&(y=1/Math.sqrt(y),k=-p*y*u,w=m*y*u);var S=this.array;S[i++]=d,S[i++]=c,S[i++]=h,S[i++]=l,S[i++]=k,S[i++]=w,S[i++]=f,S[i++]=e}},{key:"setUniforms",value:function(e,i){var o=i.gl,a=i.uniformLocations,s=a.u_matrix,u=a.u_zoomRatio,d=a.u_feather,c=a.u_pixelRatio,h=a.u_correctionRatio,l=a.u_sizeRatio,f=a.u_minEdgeThickness;o.uniformMatrix3fv(s,!1,e.matrix),o.uniform1f(u,e.zoomRatio),o.uniform1f(l,e.sizeRatio),o.uniform1f(h,e.correctionRatio),o.uniform1f(c,e.pixelRatio),o.uniform1f(d,e.antiAliasingFeather),o.uniform1f(f,e.minEdgeThickness)}}])})(rt),zt=(function(n){function t(){var r;return J(this,t),r=ae(this,t),r.rawEmitter=r,r}return se(t,n),ee(t)})(Sr.EventEmitter),ht,ir;function go(){return ir||(ir=1,ht=function(t){return t!==null&&typeof t=="object"&&typeof t.addUndirectedEdgeWithKey=="function"&&typeof t.dropNode=="function"&&typeof t.multi=="boolean"}),ht}var po=go();const vo=xr(po);var mo=function(t){return t},yo=function(t){return t*t},bo=function(t){return t*(2-t)},wo=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Eo=function(t){return t*t*t},_o=function(t){return--t*t*t+1},To=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},xo={linear:mo,quadraticIn:yo,quadraticOut:bo,quadraticInOut:wo,cubicIn:Eo,cubicOut:_o,cubicInOut:To},So={easing:"quadraticInOut",duration:150};function de(){return Float32Array.of(1,0,0,0,1,0,0,0,1)}function qe(n,t,r){return n[0]=t,n[4]=typeof r=="number"?r:t,n}function nr(n,t){var r=Math.sin(t),e=Math.cos(t);return n[0]=e,n[1]=r,n[3]=-r,n[4]=e,n}function or(n,t,r){return n[6]=t,n[7]=r,n}function ye(n,t){var r=n[0],e=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=n[6],d=n[7],c=n[8],h=t[0],l=t[1],f=t[2],m=t[3],p=t[4],y=t[5],k=t[6],w=t[7],S=t[8];return n[0]=h*r+l*o+f*u,n[1]=h*e+l*a+f*d,n[2]=h*i+l*s+f*c,n[3]=m*r+p*o+y*u,n[4]=m*e+p*a+y*d,n[5]=m*i+p*s+y*c,n[6]=k*r+w*o+S*u,n[7]=k*e+w*a+S*d,n[8]=k*i+w*s+S*c,n}function _t(n,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,e=n[0],i=n[1],o=n[3],a=n[4],s=n[6],u=n[7],d=t.x,c=t.y;return{x:d*e+c*o+s*r,y:d*i+c*a+u*r}}function Co(n,t){var r=n.height/n.width,e=t.height/t.width;return r<1&&e>1||r>1&&e<1?1:Math.min(Math.max(e,1/e),Math.max(1/r,r))}function Ie(n,t,r,e,i){var o=n.angle,a=n.ratio,s=n.x,u=n.y,d=t.width,c=t.height,h=de(),l=Math.min(d,c)-2*e,f=Co(t,r);return i?(ye(h,or(de(),s,u)),ye(h,qe(de(),a)),ye(h,nr(de(),o)),ye(h,qe(de(),d/l/2/f,c/l/2/f))):(ye(h,qe(de(),2*(l/d)*f,2*(l/c)*f)),ye(h,nr(de(),-o)),ye(h,qe(de(),1/a)),ye(h,or(de(),-s,-u))),h}function Ao(n,t,r){var e=_t(n,{x:Math.cos(t.angle),y:Math.sin(t.angle)},0),i=e.x,o=e.y;return 1/Math.sqrt(Math.pow(i,2)+Math.pow(o,2))/r.width}function ko(n){if(!n.order)return{x:[0,1],y:[0,1]};var t=1/0,r=-1/0,e=1/0,i=-1/0;return n.forEachNode(function(o,a){var s=a.x,u=a.y;s<t&&(t=s),s>r&&(r=s),u<e&&(e=u),u>i&&(i=u)}),{x:[t,r],y:[e,i]}}function Ro(n){if(!vo(n))throw new Error("Sigma: invalid graph instance.");n.forEachNode(function(t,r){if(!Number.isFinite(r.x)||!Number.isFinite(r.y))throw new Error("Sigma: Coordinates of node ".concat(t," are invalid. A node must have a numeric 'x' and 'y' attribute."))})}function Lo(n,t,r){var e=document.createElement(n);if(t)for(var i in t)e.style[i]=t[i];if(r)for(var o in r)e.setAttribute(o,r[o]);return e}function ar(){return typeof window.devicePixelRatio<"u"?window.devicePixelRatio:1}function sr(n,t,r){return r.sort(function(e,i){var o=t(e)||0,a=t(i)||0;return o<a?-1:o>a?1:0})}function ur(n){var t=Le(n.x,2),r=t[0],e=t[1],i=Le(n.y,2),o=i[0],a=i[1],s=Math.max(e-r,a-o),u=(e+r)/2,d=(a+o)/2;(s===0||Math.abs(s)===1/0||isNaN(s))&&(s=1),isNaN(u)&&(u=0),isNaN(d)&&(d=0);var c=function(l){return{x:.5+(l.x-u)/s,y:.5+(l.y-d)/s}};return c.applyTo=function(h){h.x=.5+(h.x-u)/s,h.y=.5+(h.y-d)/s},c.inverse=function(h){return{x:u+s*(h.x-.5),y:d+s*(h.y-.5)}},c.ratio=s,c}function Tt(n){"@babel/helpers - typeof";return Tt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tt(n)}function dr(n,t){var r=t.size;if(r!==0){var e=n.length;n.length+=r;var i=0;t.forEach(function(o){n[e+i]=o,i++})}}function lt(n){n=n||{};for(var t=0,r=arguments.length<=1?0:arguments.length-1;t<r;t++){var e=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];e&&Object.assign(n,e)}return n}var Ot={hideEdgesOnMove:!1,hideLabelsOnMove:!1,renderLabels:!0,renderEdgeLabels:!1,enableEdgeEvents:!1,defaultNodeColor:"#999",defaultNodeType:"circle",defaultEdgeColor:"#ccc",defaultEdgeType:"line",labelFont:"Arial",labelSize:14,labelWeight:"normal",labelColor:{color:"#000"},edgeLabelFont:"Arial",edgeLabelSize:14,edgeLabelWeight:"normal",edgeLabelColor:{attribute:"color"},stagePadding:30,defaultDrawEdgeLabel:jn,defaultDrawNodeLabel:Pt,defaultDrawNodeHover:Hn,minEdgeThickness:1.7,antiAliasingFeather:1,dragTimeout:100,draggedEventsTolerance:3,inertiaDuration:200,inertiaRatio:3,zoomDuration:250,zoomingRatio:1.7,doubleClickTimeout:300,doubleClickZoomingRatio:2.2,doubleClickZoomingDuration:200,tapMoveTolerance:10,zoomToSizeRatioFunction:Math.sqrt,itemSizesReference:"screen",autoRescale:!0,autoCenter:!0,labelDensity:1,labelGridCellSize:100,labelRenderedSizeThreshold:6,nodeReducer:null,edgeReducer:null,zIndex:!1,minCameraRatio:null,maxCameraRatio:null,enableCameraZooming:!0,enableCameraPanning:!0,enableCameraRotation:!0,cameraPanBoundaries:null,allowInvalidContainer:!1,nodeProgramClasses:{},nodeHoverProgramClasses:{},edgeProgramClasses:{}},No={circle:it},Do={arrow:uo,line:fo};function ft(n){if(typeof n.labelDensity!="number"||n.labelDensity<0)throw new Error("Settings: invalid `labelDensity`. Expecting a positive number.");var t=n.minCameraRatio,r=n.maxCameraRatio;if(typeof t=="number"&&typeof r=="number"&&r<t)throw new Error("Settings: invalid camera ratio boundaries. Expecting `maxCameraRatio` to be greater than `minCameraRatio`.")}function Go(n){var t=lt({},Ot,n);return t.nodeProgramClasses=lt({},No,t.nodeProgramClasses),t.edgeProgramClasses=lt({},Do,t.edgeProgramClasses),t}var Ye=1.5,cr=(function(n){function t(){var r;return J(this,t),r=ae(this,t),E(r,"x",.5),E(r,"y",.5),E(r,"angle",0),E(r,"ratio",1),E(r,"minRatio",null),E(r,"maxRatio",null),E(r,"enabledZooming",!0),E(r,"enabledPanning",!0),E(r,"enabledRotation",!0),E(r,"clean",null),E(r,"nextFrame",null),E(r,"previousState",null),E(r,"enabled",!0),r.previousState=r.getState(),r}return se(t,n),ee(t,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"getState",value:function(){return{x:this.x,y:this.y,angle:this.angle,ratio:this.ratio}}},{key:"hasState",value:function(e){return this.x===e.x&&this.y===e.y&&this.ratio===e.ratio&&this.angle===e.angle}},{key:"getPreviousState",value:function(){var e=this.previousState;return e?{x:e.x,y:e.y,angle:e.angle,ratio:e.ratio}:null}},{key:"getBoundedRatio",value:function(e){var i=e;return typeof this.minRatio=="number"&&(i=Math.max(i,this.minRatio)),typeof this.maxRatio=="number"&&(i=Math.min(i,this.maxRatio)),i}},{key:"validateState",value:function(e){var i={};return this.enabledPanning&&typeof e.x=="number"&&(i.x=e.x),this.enabledPanning&&typeof e.y=="number"&&(i.y=e.y),this.enabledZooming&&typeof e.ratio=="number"&&(i.ratio=this.getBoundedRatio(e.ratio)),this.enabledRotation&&typeof e.angle=="number"&&(i.angle=e.angle),this.clean?this.clean(G(G({},this.getState()),i)):i}},{key:"isAnimated",value:function(){return!!this.nextFrame}},{key:"setState",value:function(e){if(!this.enabled)return this;this.previousState=this.getState();var i=this.validateState(e);return typeof i.x=="number"&&(this.x=i.x),typeof i.y=="number"&&(this.y=i.y),typeof i.ratio=="number"&&(this.ratio=i.ratio),typeof i.angle=="number"&&(this.angle=i.angle),this.hasState(this.previousState)||this.emit("updated",this.getState()),this}},{key:"updateState",value:function(e){return this.setState(e(this.getState())),this}},{key:"animate",value:function(e){var i=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;if(!a)return new Promise(function(f){return i.animate(e,o,f)});if(this.enabled){var s=G(G({},So),o),u=this.validateState(e),d=typeof s.easing=="function"?s.easing:xo[s.easing],c=Date.now(),h=this.getState(),l=function(){var m=(Date.now()-c)/s.duration;if(m>=1){i.nextFrame=null,i.setState(u),i.animationCallback&&(i.animationCallback.call(null),i.animationCallback=void 0);return}var p=d(m),y={};typeof u.x=="number"&&(y.x=h.x+(u.x-h.x)*p),typeof u.y=="number"&&(y.y=h.y+(u.y-h.y)*p),i.enabledRotation&&typeof u.angle=="number"&&(y.angle=h.angle+(u.angle-h.angle)*p),typeof u.ratio=="number"&&(y.ratio=h.ratio+(u.ratio-h.ratio)*p),i.setState(y),i.nextFrame=requestAnimationFrame(l)};this.nextFrame?(cancelAnimationFrame(this.nextFrame),this.animationCallback&&this.animationCallback.call(null),this.nextFrame=requestAnimationFrame(l)):l(),this.animationCallback=a}}},{key:"animatedZoom",value:function(e){return e?typeof e=="number"?this.animate({ratio:this.ratio/e}):this.animate({ratio:this.ratio/(e.factor||Ye)},e):this.animate({ratio:this.ratio/Ye})}},{key:"animatedUnzoom",value:function(e){return e?typeof e=="number"?this.animate({ratio:this.ratio*e}):this.animate({ratio:this.ratio*(e.factor||Ye)},e):this.animate({ratio:this.ratio*Ye})}},{key:"animatedReset",value:function(e){return this.animate({x:.5,y:.5,ratio:1,angle:0},e)}},{key:"copy",value:function(){return t.from(this.getState())}}],[{key:"from",value:function(e){var i=new t;return i.setState(e)}}])})(zt);function ce(n,t){var r=t.getBoundingClientRect();return{x:n.clientX-r.left,y:n.clientY-r.top}}function fe(n,t){var r=G(G({},ce(n,t)),{},{sigmaDefaultPrevented:!1,preventSigmaDefault:function(){r.sigmaDefaultPrevented=!0},original:n});return r}function Me(n){var t="x"in n?n:G(G({},n.touches[0]||n.previousTouches[0]),{},{original:n.original,sigmaDefaultPrevented:n.sigmaDefaultPrevented,preventSigmaDefault:function(){n.sigmaDefaultPrevented=!0,t.sigmaDefaultPrevented=!0}});return t}function Fo(n,t){return G(G({},fe(n,t)),{},{delta:ri(n)})}var Po=2;function Qe(n){for(var t=[],r=0,e=Math.min(n.length,Po);r<e;r++)t.push(n[r]);return t}function $e(n,t,r){var e={touches:Qe(n.touches).map(function(i){return ce(i,r)}),previousTouches:t.map(function(i){return ce(i,r)}),sigmaDefaultPrevented:!1,preventSigmaDefault:function(){e.sigmaDefaultPrevented=!0},original:n};return e}function ri(n){if(typeof n.deltaY<"u")return n.deltaY*-3/360;if(typeof n.detail<"u")return n.detail/-9;throw new Error("Captor: could not extract delta from event.")}var ii=(function(n){function t(r,e){var i;return J(this,t),i=ae(this,t),i.container=r,i.renderer=e,i}return se(t,n),ee(t)})(zt),zo=["doubleClickTimeout","doubleClickZoomingDuration","doubleClickZoomingRatio","dragTimeout","draggedEventsTolerance","inertiaDuration","inertiaRatio","zoomDuration","zoomingRatio"],Oo=zo.reduce(function(n,t){return G(G({},n),{},E({},t,Ot[t]))},{}),Io=(function(n){function t(r,e){var i;return J(this,t),i=ae(this,t,[r,e]),E(i,"enabled",!0),E(i,"draggedEvents",0),E(i,"downStartTime",null),E(i,"lastMouseX",null),E(i,"lastMouseY",null),E(i,"isMouseDown",!1),E(i,"isMoving",!1),E(i,"movingTimeout",null),E(i,"startCameraState",null),E(i,"clicks",0),E(i,"doubleClickTimeout",null),E(i,"currentWheelDirection",0),E(i,"settings",Oo),i.handleClick=i.handleClick.bind(i),i.handleRightClick=i.handleRightClick.bind(i),i.handleDown=i.handleDown.bind(i),i.handleUp=i.handleUp.bind(i),i.handleMove=i.handleMove.bind(i),i.handleWheel=i.handleWheel.bind(i),i.handleLeave=i.handleLeave.bind(i),i.handleEnter=i.handleEnter.bind(i),r.addEventListener("click",i.handleClick,{capture:!1}),r.addEventListener("contextmenu",i.handleRightClick,{capture:!1}),r.addEventListener("mousedown",i.handleDown,{capture:!1}),r.addEventListener("wheel",i.handleWheel,{capture:!1}),r.addEventListener("mouseleave",i.handleLeave,{capture:!1}),r.addEventListener("mouseenter",i.handleEnter,{capture:!1}),document.addEventListener("mousemove",i.handleMove,{capture:!1}),document.addEventListener("mouseup",i.handleUp,{capture:!1}),i}return se(t,n),ee(t,[{key:"kill",value:function(){var e=this.container;e.removeEventListener("click",this.handleClick),e.removeEventListener("contextmenu",this.handleRightClick),e.removeEventListener("mousedown",this.handleDown),e.removeEventListener("wheel",this.handleWheel),e.removeEventListener("mouseleave",this.handleLeave),e.removeEventListener("mouseenter",this.handleEnter),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleUp)}},{key:"handleClick",value:function(e){var i=this;if(this.enabled){if(this.clicks++,this.clicks===2)return this.clicks=0,typeof this.doubleClickTimeout=="number"&&(clearTimeout(this.doubleClickTimeout),this.doubleClickTimeout=null),this.handleDoubleClick(e);setTimeout(function(){i.clicks=0,i.doubleClickTimeout=null},this.settings.doubleClickTimeout),this.draggedEvents<this.settings.draggedEventsTolerance&&this.emit("click",fe(e,this.container))}}},{key:"handleRightClick",value:function(e){this.enabled&&this.emit("rightClick",fe(e,this.container))}},{key:"handleDoubleClick",value:function(e){if(this.enabled){e.preventDefault(),e.stopPropagation();var i=fe(e,this.container);if(this.emit("doubleClick",i),!i.sigmaDefaultPrevented){var o=this.renderer.getCamera(),a=o.getBoundedRatio(o.getState().ratio/this.settings.doubleClickZoomingRatio);o.animate(this.renderer.getViewportZoomedState(ce(e,this.container),a),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}}},{key:"handleDown",value:function(e){if(this.enabled){if(e.button===0){this.startCameraState=this.renderer.getCamera().getState();var i=ce(e,this.container),o=i.x,a=i.y;this.lastMouseX=o,this.lastMouseY=a,this.draggedEvents=0,this.downStartTime=Date.now(),this.isMouseDown=!0}this.emit("mousedown",fe(e,this.container))}}},{key:"handleUp",value:function(e){var i=this;if(!(!this.enabled||!this.isMouseDown)){var o=this.renderer.getCamera();this.isMouseDown=!1,typeof this.movingTimeout=="number"&&(clearTimeout(this.movingTimeout),this.movingTimeout=null);var a=ce(e,this.container),s=a.x,u=a.y,d=o.getState(),c=o.getPreviousState()||{x:0,y:0};this.isMoving?o.animate({x:d.x+this.settings.inertiaRatio*(d.x-c.x),y:d.y+this.settings.inertiaRatio*(d.y-c.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"}):(this.lastMouseX!==s||this.lastMouseY!==u)&&o.setState({x:d.x,y:d.y}),this.isMoving=!1,setTimeout(function(){var h=i.draggedEvents>0;i.draggedEvents=0,h&&i.renderer.getSetting("hideEdgesOnMove")&&i.renderer.refresh()},0),this.emit("mouseup",fe(e,this.container))}}},{key:"handleMove",value:function(e){var i=this;if(this.enabled){var o=fe(e,this.container);if(this.emit("mousemovebody",o),(e.target===this.container||e.composedPath()[0]===this.container)&&this.emit("mousemove",o),!o.sigmaDefaultPrevented&&this.isMouseDown){this.isMoving=!0,this.draggedEvents++,typeof this.movingTimeout=="number"&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){i.movingTimeout=null,i.isMoving=!1},this.settings.dragTimeout);var a=this.renderer.getCamera(),s=ce(e,this.container),u=s.x,d=s.y,c=this.renderer.viewportToFramedGraph({x:this.lastMouseX,y:this.lastMouseY}),h=this.renderer.viewportToFramedGraph({x:u,y:d}),l=c.x-h.x,f=c.y-h.y,m=a.getState(),p=m.x+l,y=m.y+f;a.setState({x:p,y}),this.lastMouseX=u,this.lastMouseY=d,e.preventDefault(),e.stopPropagation()}}}},{key:"handleLeave",value:function(e){this.emit("mouseleave",fe(e,this.container))}},{key:"handleEnter",value:function(e){this.emit("mouseenter",fe(e,this.container))}},{key:"handleWheel",value:function(e){var i=this,o=this.renderer.getCamera();if(!(!this.enabled||!o.enabledZooming)){var a=ri(e);if(a){var s=Fo(e,this.container);if(this.emit("wheel",s),s.sigmaDefaultPrevented){e.preventDefault(),e.stopPropagation();return}var u=o.getState().ratio,d=a>0?1/this.settings.zoomingRatio:this.settings.zoomingRatio,c=o.getBoundedRatio(u*d),h=a>0?1:-1,l=Date.now();u!==c&&(e.preventDefault(),e.stopPropagation(),!(this.currentWheelDirection===h&&this.lastWheelTriggerTime&&l-this.lastWheelTriggerTime<this.settings.zoomDuration/5)&&(o.animate(this.renderer.getViewportZoomedState(ce(e,this.container),c),{easing:"quadraticOut",duration:this.settings.zoomDuration},function(){i.currentWheelDirection=0}),this.currentWheelDirection=h,this.lastWheelTriggerTime=l))}}}},{key:"setSettings",value:function(e){this.settings=e}}])})(ii),Mo=["dragTimeout","inertiaDuration","inertiaRatio","doubleClickTimeout","doubleClickZoomingRatio","doubleClickZoomingDuration","tapMoveTolerance"],$o=Mo.reduce(function(n,t){return G(G({},n),{},E({},t,Ot[t]))},{}),Uo=(function(n){function t(r,e){var i;return J(this,t),i=ae(this,t,[r,e]),E(i,"enabled",!0),E(i,"isMoving",!1),E(i,"hasMoved",!1),E(i,"touchMode",0),E(i,"startTouchesPositions",[]),E(i,"lastTouches",[]),E(i,"lastTap",null),E(i,"settings",$o),i.handleStart=i.handleStart.bind(i),i.handleLeave=i.handleLeave.bind(i),i.handleMove=i.handleMove.bind(i),r.addEventListener("touchstart",i.handleStart,{capture:!1}),r.addEventListener("touchcancel",i.handleLeave,{capture:!1}),document.addEventListener("touchend",i.handleLeave,{capture:!1,passive:!1}),document.addEventListener("touchmove",i.handleMove,{capture:!1,passive:!1}),i}return se(t,n),ee(t,[{key:"kill",value:function(){var e=this.container;e.removeEventListener("touchstart",this.handleStart),e.removeEventListener("touchcancel",this.handleLeave),document.removeEventListener("touchend",this.handleLeave),document.removeEventListener("touchmove",this.handleMove)}},{key:"getDimensions",value:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},{key:"handleStart",value:function(e){var i=this;if(this.enabled){e.preventDefault();var o=Qe(e.touches);if(this.touchMode=o.length,this.startCameraState=this.renderer.getCamera().getState(),this.startTouchesPositions=o.map(function(f){return ce(f,i.container)}),this.touchMode===2){var a=Le(this.startTouchesPositions,2),s=a[0],u=s.x,d=s.y,c=a[1],h=c.x,l=c.y;this.startTouchesAngle=Math.atan2(l-d,h-u),this.startTouchesDistance=Math.sqrt(Math.pow(h-u,2)+Math.pow(l-d,2))}this.emit("touchdown",$e(e,this.lastTouches,this.container)),this.lastTouches=o,this.lastTouchesPositions=this.startTouchesPositions}}},{key:"handleLeave",value:function(e){if(!(!this.enabled||!this.startTouchesPositions.length)){switch(e.cancelable&&e.preventDefault(),this.movingTimeout&&(this.isMoving=!1,clearTimeout(this.movingTimeout)),this.touchMode){case 2:if(e.touches.length===1){this.handleStart(e),e.preventDefault();break}case 1:if(this.isMoving){var i=this.renderer.getCamera(),o=i.getState(),a=i.getPreviousState()||{x:0,y:0};i.animate({x:o.x+this.settings.inertiaRatio*(o.x-a.x),y:o.y+this.settings.inertiaRatio*(o.y-a.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"})}this.hasMoved=!1,this.isMoving=!1,this.touchMode=0;break}if(this.emit("touchup",$e(e,this.lastTouches,this.container)),!e.touches.length){var s=ce(this.lastTouches[0],this.container),u=this.startTouchesPositions[0],d=Math.pow(s.x-u.x,2)+Math.pow(s.y-u.y,2);if(!e.touches.length&&d<Math.pow(this.settings.tapMoveTolerance,2))if(this.lastTap&&Date.now()-this.lastTap.time<this.settings.doubleClickTimeout){var c=$e(e,this.lastTouches,this.container);if(this.emit("doubletap",c),this.lastTap=null,!c.sigmaDefaultPrevented){var h=this.renderer.getCamera(),l=h.getBoundedRatio(h.getState().ratio/this.settings.doubleClickZoomingRatio);h.animate(this.renderer.getViewportZoomedState(s,l),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}else{var f=$e(e,this.lastTouches,this.container);this.emit("tap",f),this.lastTap={time:Date.now(),position:f.touches[0]||f.previousTouches[0]}}}this.lastTouches=Qe(e.touches),this.startTouchesPositions=[]}}},{key:"handleMove",value:function(e){var i=this;if(!(!this.enabled||!this.startTouchesPositions.length)){e.preventDefault();var o=Qe(e.touches),a=o.map(function(O){return ce(O,i.container)}),s=this.lastTouches;this.lastTouches=o,this.lastTouchesPositions=a;var u=$e(e,s,this.container);if(this.emit("touchmove",u),!u.sigmaDefaultPrevented&&(this.hasMoved||(this.hasMoved=a.some(function(O,H){var U=i.startTouchesPositions[H];return U&&(O.x!==U.x||O.y!==U.y)})),!!this.hasMoved)){this.isMoving=!0,this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){i.isMoving=!1},this.settings.dragTimeout);var d=this.renderer.getCamera(),c=this.startCameraState,h=this.renderer.getSetting("stagePadding");switch(this.touchMode){case 1:{var l=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0]),f=l.x,m=l.y,p=this.renderer.viewportToFramedGraph(a[0]),y=p.x,k=p.y;d.setState({x:c.x+f-y,y:c.y+m-k});break}case 2:{var w={x:.5,y:.5,angle:0,ratio:1},S=a[0],g=S.x,v=S.y,b=a[1],T=b.x,N=b.y,F=Math.atan2(N-v,T-g)-this.startTouchesAngle,D=Math.hypot(N-v,T-g)/this.startTouchesDistance,M=d.getBoundedRatio(c.ratio/D);w.ratio=M,w.angle=c.angle+F;var j=this.getDimensions(),X=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0],{cameraState:c}),W=Math.min(j.width,j.height)-2*h,K=W/j.width,_=W/j.height,x=M/W,C=g-W/2/K,P=v-W/2/_,L=[C*Math.cos(-w.angle)-P*Math.sin(-w.angle),P*Math.cos(-w.angle)+C*Math.sin(-w.angle)];C=L[0],P=L[1],w.x=X.x-C*x,w.y=X.y+P*x,d.setState(w);break}}}}}},{key:"setSettings",value:function(e){this.settings=e}}])})(ii);function Bo(n){if(Array.isArray(n))return wt(n)}function jo(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Ho(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hr(n){return Bo(n)||jo(n)||Ur(n)||Ho()}function Wo(n,t){if(n==null)return{};var r={};for(var e in n)if({}.hasOwnProperty.call(n,e)){if(t.indexOf(e)!==-1)continue;r[e]=n[e]}return r}function gt(n,t){if(n==null)return{};var r,e,i=Wo(n,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(e=0;e<o.length;e++)r=o[e],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(n,r)&&(i[r]=n[r])}return i}var lr=(function(){function n(t,r){J(this,n),this.key=t,this.size=r}return ee(n,null,[{key:"compare",value:function(r,e){return r.size>e.size?-1:r.size<e.size||r.key>e.key?1:-1}}])})(),fr=(function(){function n(){J(this,n),E(this,"width",0),E(this,"height",0),E(this,"cellSize",0),E(this,"columns",0),E(this,"rows",0),E(this,"cells",{})}return ee(n,[{key:"resizeAndClear",value:function(r,e){this.width=r.width,this.height=r.height,this.cellSize=e,this.columns=Math.ceil(r.width/e),this.rows=Math.ceil(r.height/e),this.cells={}}},{key:"getIndex",value:function(r){var e=Math.floor(r.x/this.cellSize),i=Math.floor(r.y/this.cellSize);return i*this.columns+e}},{key:"add",value:function(r,e,i){var o=new lr(r,e),a=this.getIndex(i),s=this.cells[a];s||(s=[],this.cells[a]=s),s.push(o)}},{key:"organize",value:function(){for(var r in this.cells){var e=this.cells[r];e.sort(lr.compare)}}},{key:"getLabelsToDisplay",value:function(r,e){var i=this.cellSize*this.cellSize,o=i/r/r,a=o*e/i,s=Math.ceil(a),u=[];for(var d in this.cells)for(var c=this.cells[d],h=0;h<Math.min(s,c.length);h++)u.push(c[h].key);return u}}])})();function Vo(n){var t=n.graph,r=n.hoveredNode,e=n.highlightedNodes,i=n.displayedNodeLabels,o=[];return t.forEachEdge(function(a,s,u,d){(u===r||d===r||e.has(u)||e.has(d)||i.has(u)&&i.has(d))&&o.push(a)}),o}var gr=150,pr=50,ge=Object.prototype.hasOwnProperty;function qo(n,t,r){if(!ge.call(r,"x")||!ge.call(r,"y"))throw new Error('Sigma: could not find a valid position (x, y) for node "'.concat(t,'". All your nodes must have a number "x" and "y". Maybe your forgot to apply a layout or your "nodeReducer" is not returning the correct data?'));return r.color||(r.color=n.defaultNodeColor),!r.label&&r.label!==""&&(r.label=null),r.label!==void 0&&r.label!==null?r.label=""+r.label:r.label=null,r.size||(r.size=2),ge.call(r,"hidden")||(r.hidden=!1),ge.call(r,"highlighted")||(r.highlighted=!1),ge.call(r,"forceLabel")||(r.forceLabel=!1),(!r.type||r.type==="")&&(r.type=n.defaultNodeType),r.zIndex||(r.zIndex=0),r}function Yo(n,t,r){return r.color||(r.color=n.defaultEdgeColor),r.label||(r.label=""),r.size||(r.size=.5),ge.call(r,"hidden")||(r.hidden=!1),ge.call(r,"forceLabel")||(r.forceLabel=!1),(!r.type||r.type==="")&&(r.type=n.defaultEdgeType),r.zIndex||(r.zIndex=0),r}var Ko=(function(n){function t(r,e){var i,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(J(this,t),i=ae(this,t),E(i,"elements",{}),E(i,"canvasContexts",{}),E(i,"webGLContexts",{}),E(i,"pickingLayers",new Set),E(i,"textures",{}),E(i,"frameBuffers",{}),E(i,"activeListeners",{}),E(i,"labelGrid",new fr),E(i,"nodeDataCache",{}),E(i,"edgeDataCache",{}),E(i,"nodeProgramIndex",{}),E(i,"edgeProgramIndex",{}),E(i,"nodesWithForcedLabels",new Set),E(i,"edgesWithForcedLabels",new Set),E(i,"nodeExtent",{x:[0,1],y:[0,1]}),E(i,"nodeZExtent",[1/0,-1/0]),E(i,"edgeZExtent",[1/0,-1/0]),E(i,"matrix",de()),E(i,"invMatrix",de()),E(i,"correctionRatio",1),E(i,"customBBox",null),E(i,"normalizationFunction",ur({x:[0,1],y:[0,1]})),E(i,"graphToViewportRatio",1),E(i,"itemIDsIndex",{}),E(i,"nodeIndices",{}),E(i,"edgeIndices",{}),E(i,"width",0),E(i,"height",0),E(i,"pixelRatio",ar()),E(i,"pickingDownSizingRatio",2*i.pixelRatio),E(i,"displayedNodeLabels",new Set),E(i,"displayedEdgeLabels",new Set),E(i,"highlightedNodes",new Set),E(i,"hoveredNode",null),E(i,"hoveredEdge",null),E(i,"renderFrame",null),E(i,"renderHighlightedNodesFrame",null),E(i,"needToProcess",!1),E(i,"checkEdgesEventsFrame",null),E(i,"nodePrograms",{}),E(i,"nodeHoverPrograms",{}),E(i,"edgePrograms",{}),i.settings=Go(o),ft(i.settings),Ro(r),!(e instanceof HTMLElement))throw new Error("Sigma: container should be an html element.");i.graph=r,i.container=e,i.createWebGLContext("edges",{picking:o.enableEdgeEvents}),i.createCanvasContext("edgeLabels"),i.createWebGLContext("nodes",{picking:!0}),i.createCanvasContext("labels"),i.createCanvasContext("hovers"),i.createWebGLContext("hoverNodes"),i.createCanvasContext("mouse",{style:{touchAction:"none",userSelect:"none"}}),i.resize();for(var a in i.settings.nodeProgramClasses)i.registerNodeProgram(a,i.settings.nodeProgramClasses[a],i.settings.nodeHoverProgramClasses[a]);for(var s in i.settings.edgeProgramClasses)i.registerEdgeProgram(s,i.settings.edgeProgramClasses[s]);return i.camera=new cr,i.bindCameraHandlers(),i.mouseCaptor=new Io(i.elements.mouse,i),i.mouseCaptor.setSettings(i.settings),i.touchCaptor=new Uo(i.elements.mouse,i),i.touchCaptor.setSettings(i.settings),i.bindEventHandlers(),i.bindGraphHandlers(),i.handleSettingsUpdate(),i.refresh(),i}return se(t,n),ee(t,[{key:"registerNodeProgram",value:function(e,i,o){return this.nodePrograms[e]&&this.nodePrograms[e].kill(),this.nodeHoverPrograms[e]&&this.nodeHoverPrograms[e].kill(),this.nodePrograms[e]=new i(this.webGLContexts.nodes,this.frameBuffers.nodes,this),this.nodeHoverPrograms[e]=new(o||i)(this.webGLContexts.hoverNodes,null,this),this}},{key:"registerEdgeProgram",value:function(e,i){return this.edgePrograms[e]&&this.edgePrograms[e].kill(),this.edgePrograms[e]=new i(this.webGLContexts.edges,this.frameBuffers.edges,this),this}},{key:"unregisterNodeProgram",value:function(e){if(this.nodePrograms[e]){var i=this.nodePrograms,o=i[e],a=gt(i,[e].map(Ue));o.kill(),this.nodePrograms=a}if(this.nodeHoverPrograms[e]){var s=this.nodeHoverPrograms,u=s[e],d=gt(s,[e].map(Ue));u.kill(),this.nodePrograms=d}return this}},{key:"unregisterEdgeProgram",value:function(e){if(this.edgePrograms[e]){var i=this.edgePrograms,o=i[e],a=gt(i,[e].map(Ue));o.kill(),this.edgePrograms=a}return this}},{key:"resetWebGLTexture",value:function(e){var i=this.webGLContexts[e],o=this.frameBuffers[e],a=this.textures[e];a&&i.deleteTexture(a);var s=i.createTexture();return i.bindFramebuffer(i.FRAMEBUFFER,o),i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,s,0),this.textures[e]=s,this}},{key:"bindCameraHandlers",value:function(){var e=this;return this.activeListeners.camera=function(){e.scheduleRender()},this.camera.on("updated",this.activeListeners.camera),this}},{key:"unbindCameraHandlers",value:function(){return this.camera.removeListener("updated",this.activeListeners.camera),this}},{key:"getNodeAtPosition",value:function(e){var i=e.x,o=e.y,a=Yt(this.webGLContexts.nodes,this.frameBuffers.nodes,i,o,this.pixelRatio,this.pickingDownSizingRatio),s=qt.apply(void 0,hr(a)),u=this.itemIDsIndex[s];return u&&u.type==="node"?u.id:null}},{key:"bindEventHandlers",value:function(){var e=this;this.activeListeners.handleResize=function(){e.scheduleRefresh()},window.addEventListener("resize",this.activeListeners.handleResize),this.activeListeners.handleMove=function(o){var a=Me(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}},u=e.getNodeAtPosition(a);if(u&&e.hoveredNode!==u&&!e.nodeDataCache[u].hidden){e.hoveredNode&&e.emit("leaveNode",G(G({},s),{},{node:e.hoveredNode})),e.hoveredNode=u,e.emit("enterNode",G(G({},s),{},{node:u})),e.scheduleHighlightedNodesRender();return}if(e.hoveredNode&&e.getNodeAtPosition(a)!==e.hoveredNode){var d=e.hoveredNode;e.hoveredNode=null,e.emit("leaveNode",G(G({},s),{},{node:d})),e.scheduleHighlightedNodesRender();return}if(e.settings.enableEdgeEvents){var c=e.hoveredNode?null:e.getEdgeAtPoint(s.event.x,s.event.y);c!==e.hoveredEdge&&(e.hoveredEdge&&e.emit("leaveEdge",G(G({},s),{},{edge:e.hoveredEdge})),c&&e.emit("enterEdge",G(G({},s),{},{edge:c})),e.hoveredEdge=c)}},this.activeListeners.handleMoveBody=function(o){var a=Me(o);e.emit("moveBody",{event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}})},this.activeListeners.handleLeave=function(o){var a=Me(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};e.hoveredNode&&(e.emit("leaveNode",G(G({},s),{},{node:e.hoveredNode})),e.scheduleHighlightedNodesRender()),e.settings.enableEdgeEvents&&e.hoveredEdge&&(e.emit("leaveEdge",G(G({},s),{},{edge:e.hoveredEdge})),e.scheduleHighlightedNodesRender()),e.emit("leaveStage",G({},s))},this.activeListeners.handleEnter=function(o){var a=Me(o),s={event:a,preventSigmaDefault:function(){a.preventSigmaDefault()}};e.emit("enterStage",G({},s))};var i=function(a){return function(s){var u=Me(s),d={event:u,preventSigmaDefault:function(){u.preventSigmaDefault()}},c=e.getNodeAtPosition(u);if(c)return e.emit("".concat(a,"Node"),G(G({},d),{},{node:c}));if(e.settings.enableEdgeEvents){var h=e.getEdgeAtPoint(u.x,u.y);if(h)return e.emit("".concat(a,"Edge"),G(G({},d),{},{edge:h}))}return e.emit("".concat(a,"Stage"),d)}};return this.activeListeners.handleClick=i("click"),this.activeListeners.handleRightClick=i("rightClick"),this.activeListeners.handleDoubleClick=i("doubleClick"),this.activeListeners.handleWheel=i("wheel"),this.activeListeners.handleDown=i("down"),this.activeListeners.handleUp=i("up"),this.mouseCaptor.on("mousemove",this.activeListeners.handleMove),this.mouseCaptor.on("mousemovebody",this.activeListeners.handleMoveBody),this.mouseCaptor.on("click",this.activeListeners.handleClick),this.mouseCaptor.on("rightClick",this.activeListeners.handleRightClick),this.mouseCaptor.on("doubleClick",this.activeListeners.handleDoubleClick),this.mouseCaptor.on("wheel",this.activeListeners.handleWheel),this.mouseCaptor.on("mousedown",this.activeListeners.handleDown),this.mouseCaptor.on("mouseup",this.activeListeners.handleUp),this.mouseCaptor.on("mouseleave",this.activeListeners.handleLeave),this.mouseCaptor.on("mouseenter",this.activeListeners.handleEnter),this.touchCaptor.on("touchdown",this.activeListeners.handleDown),this.touchCaptor.on("touchdown",this.activeListeners.handleMove),this.touchCaptor.on("touchup",this.activeListeners.handleUp),this.touchCaptor.on("touchmove",this.activeListeners.handleMove),this.touchCaptor.on("tap",this.activeListeners.handleClick),this.touchCaptor.on("doubletap",this.activeListeners.handleDoubleClick),this.touchCaptor.on("touchmove",this.activeListeners.handleMoveBody),this}},{key:"bindGraphHandlers",value:function(){var e=this,i=this.graph,o=new Set(["x","y","zIndex","type"]);return this.activeListeners.eachNodeAttributesUpdatedGraphUpdate=function(a){var s,u=(s=a.hints)===null||s===void 0?void 0:s.attributes;e.graph.forEachNode(function(c){return e.updateNode(c)});var d=!u||u.some(function(c){return o.has(c)});e.refresh({partialGraph:{nodes:i.nodes()},skipIndexation:!d,schedule:!0})},this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate=function(a){var s,u=(s=a.hints)===null||s===void 0?void 0:s.attributes;e.graph.forEachEdge(function(c){return e.updateEdge(c)});var d=u&&["zIndex","type"].some(function(c){return u?.includes(c)});e.refresh({partialGraph:{edges:i.edges()},skipIndexation:!d,schedule:!0})},this.activeListeners.addNodeGraphUpdate=function(a){var s=a.key;e.addNode(s),e.refresh({partialGraph:{nodes:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.updateNodeGraphUpdate=function(a){var s=a.key;e.refresh({partialGraph:{nodes:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropNodeGraphUpdate=function(a){var s=a.key;e.removeNode(s),e.refresh({schedule:!0})},this.activeListeners.addEdgeGraphUpdate=function(a){var s=a.key;e.addEdge(s),e.refresh({partialGraph:{edges:[s]},schedule:!0})},this.activeListeners.updateEdgeGraphUpdate=function(a){var s=a.key;e.refresh({partialGraph:{edges:[s]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropEdgeGraphUpdate=function(a){var s=a.key;e.removeEdge(s),e.refresh({schedule:!0})},this.activeListeners.clearEdgesGraphUpdate=function(){e.clearEdgeState(),e.clearEdgeIndices(),e.refresh({schedule:!0})},this.activeListeners.clearGraphUpdate=function(){e.clearEdgeState(),e.clearNodeState(),e.clearEdgeIndices(),e.clearNodeIndices(),e.refresh({schedule:!0})},i.on("nodeAdded",this.activeListeners.addNodeGraphUpdate),i.on("nodeDropped",this.activeListeners.dropNodeGraphUpdate),i.on("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),i.on("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),i.on("edgeAdded",this.activeListeners.addEdgeGraphUpdate),i.on("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),i.on("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),i.on("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),i.on("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),i.on("cleared",this.activeListeners.clearGraphUpdate),this}},{key:"unbindGraphHandlers",value:function(){var e=this.graph;e.removeListener("nodeAdded",this.activeListeners.addNodeGraphUpdate),e.removeListener("nodeDropped",this.activeListeners.dropNodeGraphUpdate),e.removeListener("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),e.removeListener("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),e.removeListener("edgeAdded",this.activeListeners.addEdgeGraphUpdate),e.removeListener("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),e.removeListener("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),e.removeListener("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),e.removeListener("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),e.removeListener("cleared",this.activeListeners.clearGraphUpdate)}},{key:"getEdgeAtPoint",value:function(e,i){var o=Yt(this.webGLContexts.edges,this.frameBuffers.edges,e,i,this.pixelRatio,this.pickingDownSizingRatio),a=qt.apply(void 0,hr(o)),s=this.itemIDsIndex[a];return s&&s.type==="edge"?s.id:null}},{key:"process",value:function(){var e=this;this.emit("beforeProcess");var i=this.graph,o=this.settings,a=this.getDimensions();if(this.nodeExtent=ko(this.graph),!this.settings.autoRescale){var s=a.width,u=a.height,d=this.nodeExtent,c=d.x,h=d.y;this.nodeExtent={x:[(c[0]+c[1])/2-s/2,(c[0]+c[1])/2+s/2],y:[(h[0]+h[1])/2-u/2,(h[0]+h[1])/2+u/2]}}this.normalizationFunction=ur(this.customBBox||this.nodeExtent);var l=new cr,f=Ie(l.getState(),a,this.getGraphDimensions(),this.getStagePadding());this.labelGrid.resizeAndClear(a,o.labelGridCellSize);for(var m={},p={},y={},k={},w=1,S=i.nodes(),g=0,v=S.length;g<v;g++){var b=S[g],T=this.nodeDataCache[b],N=i.getNodeAttributes(b);T.x=N.x,T.y=N.y,this.normalizationFunction.applyTo(T),typeof T.label=="string"&&!T.hidden&&this.labelGrid.add(b,T.size,this.framedGraphToViewport(T,{matrix:f})),m[T.type]=(m[T.type]||0)+1}this.labelGrid.organize();for(var F in this.nodePrograms){if(!ge.call(this.nodePrograms,F))throw new Error('Sigma: could not find a suitable program for node type "'.concat(F,'"!'));this.nodePrograms[F].reallocate(m[F]||0),m[F]=0}this.settings.zIndex&&this.nodeZExtent[0]!==this.nodeZExtent[1]&&(S=sr(this.nodeZExtent,function(te){return e.nodeDataCache[te].zIndex},S));for(var D=0,M=S.length;D<M;D++){var j=S[D];p[j]=w,k[p[j]]={type:"node",id:j},w++;var X=this.nodeDataCache[j];this.addNodeToProgram(j,p[j],m[X.type]++)}for(var W={},K=i.edges(),_=0,x=K.length;_<x;_++){var C=K[_],P=this.edgeDataCache[C];W[P.type]=(W[P.type]||0)+1}this.settings.zIndex&&this.edgeZExtent[0]!==this.edgeZExtent[1]&&(K=sr(this.edgeZExtent,function(te){return e.edgeDataCache[te].zIndex},K));for(var L in this.edgePrograms){if(!ge.call(this.edgePrograms,L))throw new Error('Sigma: could not find a suitable program for edge type "'.concat(L,'"!'));this.edgePrograms[L].reallocate(W[L]||0),W[L]=0}for(var O=0,H=K.length;O<H;O++){var U=K[O];y[U]=w,k[y[U]]={type:"edge",id:U},w++;var V=this.edgeDataCache[U];this.addEdgeToProgram(U,y[U],W[V.type]++)}return this.itemIDsIndex=k,this.nodeIndices=p,this.edgeIndices=y,this.emit("afterProcess"),this}},{key:"handleSettingsUpdate",value:function(e){var i=this,o=this.settings;if(this.camera.minRatio=o.minCameraRatio,this.camera.maxRatio=o.maxCameraRatio,this.camera.enabledZooming=o.enableCameraZooming,this.camera.enabledPanning=o.enableCameraPanning,this.camera.enabledRotation=o.enableCameraRotation,o.cameraPanBoundaries?this.camera.clean=function(c){return i.cleanCameraState(c,o.cameraPanBoundaries&&Tt(o.cameraPanBoundaries)==="object"?o.cameraPanBoundaries:{})}:this.camera.clean=null,this.camera.setState(this.camera.validateState(this.camera.getState())),e){if(e.edgeProgramClasses!==o.edgeProgramClasses){for(var a in o.edgeProgramClasses)o.edgeProgramClasses[a]!==e.edgeProgramClasses[a]&&this.registerEdgeProgram(a,o.edgeProgramClasses[a]);for(var s in e.edgeProgramClasses)o.edgeProgramClasses[s]||this.unregisterEdgeProgram(s)}if(e.nodeProgramClasses!==o.nodeProgramClasses||e.nodeHoverProgramClasses!==o.nodeHoverProgramClasses){for(var u in o.nodeProgramClasses)(o.nodeProgramClasses[u]!==e.nodeProgramClasses[u]||o.nodeHoverProgramClasses[u]!==e.nodeHoverProgramClasses[u])&&this.registerNodeProgram(u,o.nodeProgramClasses[u],o.nodeHoverProgramClasses[u]);for(var d in e.nodeProgramClasses)o.nodeProgramClasses[d]||this.unregisterNodeProgram(d)}}return this.mouseCaptor.setSettings(this.settings),this.touchCaptor.setSettings(this.settings),this}},{key:"cleanCameraState",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.tolerance,a=o===void 0?0:o,s=i.boundaries,u=G({},e),d=s||this.nodeExtent,c=Le(d.x,2),h=c[0],l=c[1],f=Le(d.y,2),m=f[0],p=f[1],y=[this.graphToViewport({x:h,y:m},{cameraState:e}),this.graphToViewport({x:l,y:m},{cameraState:e}),this.graphToViewport({x:h,y:p},{cameraState:e}),this.graphToViewport({x:l,y:p},{cameraState:e})],k=1/0,w=-1/0,S=1/0,g=-1/0;y.forEach(function(W){var K=W.x,_=W.y;k=Math.min(k,K),w=Math.max(w,K),S=Math.min(S,_),g=Math.max(g,_)});var v=w-k,b=g-S,T=this.getDimensions(),N=T.width,F=T.height,D=0,M=0;if(v>=N?w<N-a?D=w-(N-a):k>a&&(D=k-a):w>N+a?D=w-(N+a):k<-a&&(D=k+a),b>=F?g<F-a?M=g-(F-a):S>a&&(M=S-a):g>F+a?M=g-(F+a):S<-a&&(M=S+a),D||M){var j=this.viewportToFramedGraph({x:0,y:0},{cameraState:e}),X=this.viewportToFramedGraph({x:D,y:M},{cameraState:e});D=X.x-j.x,M=X.y-j.y,u.x+=D,u.y+=M}return u}},{key:"renderLabels",value:function(){if(!this.settings.renderLabels)return this;var e=this.camera.getState(),i=this.labelGrid.getLabelsToDisplay(e.ratio,this.settings.labelDensity);dr(i,this.nodesWithForcedLabels),this.displayedNodeLabels=new Set;for(var o=this.canvasContexts.labels,a=0,s=i.length;a<s;a++){var u=i[a],d=this.nodeDataCache[u];if(!this.displayedNodeLabels.has(u)&&!d.hidden){var c=this.framedGraphToViewport(d),h=c.x,l=c.y,f=this.scaleSize(d.size);if(!(!d.forceLabel&&f<this.settings.labelRenderedSizeThreshold)&&!(h<-gr||h>this.width+gr||l<-pr||l>this.height+pr)){this.displayedNodeLabels.add(u);var m=this.settings.defaultDrawNodeLabel,p=this.nodePrograms[d.type],y=p?.drawLabel||m;y(o,G(G({key:u},d),{},{size:f,x:h,y:l}),this.settings)}}}return this}},{key:"renderEdgeLabels",value:function(){if(!this.settings.renderEdgeLabels)return this;var e=this.canvasContexts.edgeLabels;e.clearRect(0,0,this.width,this.height);var i=Vo({graph:this.graph,hoveredNode:this.hoveredNode,displayedNodeLabels:this.displayedNodeLabels,highlightedNodes:this.highlightedNodes});dr(i,this.edgesWithForcedLabels);for(var o=new Set,a=0,s=i.length;a<s;a++){var u=i[a],d=this.graph.extremities(u),c=this.nodeDataCache[d[0]],h=this.nodeDataCache[d[1]],l=this.edgeDataCache[u];if(!o.has(u)&&!(l.hidden||c.hidden||h.hidden)){var f=this.settings.defaultDrawEdgeLabel,m=this.edgePrograms[l.type],p=m?.drawLabel||f;p(e,G(G({key:u},l),{},{size:this.scaleSize(l.size)}),G(G(G({key:d[0]},c),this.framedGraphToViewport(c)),{},{size:this.scaleSize(c.size)}),G(G(G({key:d[1]},h),this.framedGraphToViewport(h)),{},{size:this.scaleSize(h.size)}),this.settings),o.add(u)}}return this.displayedEdgeLabels=o,this}},{key:"renderHighlightedNodes",value:function(){var e=this,i=this.canvasContexts.hovers;i.clearRect(0,0,this.width,this.height);var o=function(f){var m=e.nodeDataCache[f],p=e.framedGraphToViewport(m),y=p.x,k=p.y,w=e.scaleSize(m.size),S=e.settings.defaultDrawNodeHover,g=e.nodePrograms[m.type],v=g?.drawHover||S;v(i,G(G({key:f},m),{},{size:w,x:y,y:k}),e.settings)},a=[];this.hoveredNode&&!this.nodeDataCache[this.hoveredNode].hidden&&a.push(this.hoveredNode),this.highlightedNodes.forEach(function(l){l!==e.hoveredNode&&a.push(l)}),a.forEach(function(l){return o(l)});var s={};a.forEach(function(l){var f=e.nodeDataCache[l].type;s[f]=(s[f]||0)+1});for(var u in this.nodeHoverPrograms)this.nodeHoverPrograms[u].reallocate(s[u]||0),s[u]=0;a.forEach(function(l){var f=e.nodeDataCache[l];e.nodeHoverPrograms[f.type].process(0,s[f.type]++,f)}),this.webGLContexts.hoverNodes.clear(this.webGLContexts.hoverNodes.COLOR_BUFFER_BIT);var d=this.getRenderParams();for(var c in this.nodeHoverPrograms){var h=this.nodeHoverPrograms[c];h.render(d)}}},{key:"scheduleHighlightedNodesRender",value:function(){var e=this;this.renderHighlightedNodesFrame||this.renderFrame||(this.renderHighlightedNodesFrame=requestAnimationFrame(function(){e.renderHighlightedNodesFrame=null,e.renderHighlightedNodes(),e.renderEdgeLabels()}))}},{key:"render",value:function(){var e=this;this.emit("beforeRender");var i=function(){return e.emit("afterRender"),e};if(this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.resize(),this.needToProcess&&this.process(),this.needToProcess=!1,this.clear(),this.pickingLayers.forEach(function(y){return e.resetWebGLTexture(y)}),!this.graph.order)return i();var o=this.mouseCaptor,a=this.camera.isAnimated()||o.isMoving||o.draggedEvents||o.currentWheelDirection,s=this.camera.getState(),u=this.getDimensions(),d=this.getGraphDimensions(),c=this.getStagePadding();this.matrix=Ie(s,u,d,c),this.invMatrix=Ie(s,u,d,c,!0),this.correctionRatio=Ao(this.matrix,s,u),this.graphToViewportRatio=this.getGraphToViewportRatio();var h=this.getRenderParams();for(var l in this.nodePrograms){var f=this.nodePrograms[l];f.render(h)}if(!this.settings.hideEdgesOnMove||!a)for(var m in this.edgePrograms){var p=this.edgePrograms[m];p.render(h)}return this.settings.hideLabelsOnMove&&a||(this.renderLabels(),this.renderEdgeLabels(),this.renderHighlightedNodes()),i()}},{key:"addNode",value:function(e){var i=Object.assign({},this.graph.getNodeAttributes(e));this.settings.nodeReducer&&(i=this.settings.nodeReducer(e,i));var o=qo(this.settings,e,i);this.nodeDataCache[e]=o,this.nodesWithForcedLabels.delete(e),o.forceLabel&&!o.hidden&&this.nodesWithForcedLabels.add(e),this.highlightedNodes.delete(e),o.highlighted&&!o.hidden&&this.highlightedNodes.add(e),this.settings.zIndex&&(o.zIndex<this.nodeZExtent[0]&&(this.nodeZExtent[0]=o.zIndex),o.zIndex>this.nodeZExtent[1]&&(this.nodeZExtent[1]=o.zIndex))}},{key:"updateNode",value:function(e){this.addNode(e);var i=this.nodeDataCache[e];this.normalizationFunction.applyTo(i)}},{key:"removeNode",value:function(e){delete this.nodeDataCache[e],delete this.nodeProgramIndex[e],this.highlightedNodes.delete(e),this.hoveredNode===e&&(this.hoveredNode=null),this.nodesWithForcedLabels.delete(e)}},{key:"addEdge",value:function(e){var i=Object.assign({},this.graph.getEdgeAttributes(e));this.settings.edgeReducer&&(i=this.settings.edgeReducer(e,i));var o=Yo(this.settings,e,i);this.edgeDataCache[e]=o,this.edgesWithForcedLabels.delete(e),o.forceLabel&&!o.hidden&&this.edgesWithForcedLabels.add(e),this.settings.zIndex&&(o.zIndex<this.edgeZExtent[0]&&(this.edgeZExtent[0]=o.zIndex),o.zIndex>this.edgeZExtent[1]&&(this.edgeZExtent[1]=o.zIndex))}},{key:"updateEdge",value:function(e){this.addEdge(e)}},{key:"removeEdge",value:function(e){delete this.edgeDataCache[e],delete this.edgeProgramIndex[e],this.hoveredEdge===e&&(this.hoveredEdge=null),this.edgesWithForcedLabels.delete(e)}},{key:"clearNodeIndices",value:function(){this.labelGrid=new fr,this.nodeExtent={x:[0,1],y:[0,1]},this.nodeDataCache={},this.edgeProgramIndex={},this.nodesWithForcedLabels=new Set,this.nodeZExtent=[1/0,-1/0],this.highlightedNodes=new Set}},{key:"clearEdgeIndices",value:function(){this.edgeDataCache={},this.edgeProgramIndex={},this.edgesWithForcedLabels=new Set,this.edgeZExtent=[1/0,-1/0]}},{key:"clearIndices",value:function(){this.clearEdgeIndices(),this.clearNodeIndices()}},{key:"clearNodeState",value:function(){this.displayedNodeLabels=new Set,this.highlightedNodes=new Set,this.hoveredNode=null}},{key:"clearEdgeState",value:function(){this.displayedEdgeLabels=new Set,this.highlightedNodes=new Set,this.hoveredEdge=null}},{key:"clearState",value:function(){this.clearEdgeState(),this.clearNodeState()}},{key:"addNodeToProgram",value:function(e,i,o){var a=this.nodeDataCache[e],s=this.nodePrograms[a.type];if(!s)throw new Error('Sigma: could not find a suitable program for node type "'.concat(a.type,'"!'));s.process(i,o,a),this.nodeProgramIndex[e]=o}},{key:"addEdgeToProgram",value:function(e,i,o){var a=this.edgeDataCache[e],s=this.edgePrograms[a.type];if(!s)throw new Error('Sigma: could not find a suitable program for edge type "'.concat(a.type,'"!'));var u=this.graph.extremities(e),d=this.nodeDataCache[u[0]],c=this.nodeDataCache[u[1]];s.process(i,o,d,c,a),this.edgeProgramIndex[e]=o}},{key:"getRenderParams",value:function(){return{matrix:this.matrix,invMatrix:this.invMatrix,width:this.width,height:this.height,pixelRatio:this.pixelRatio,zoomRatio:this.camera.ratio,cameraAngle:this.camera.angle,sizeRatio:1/this.scaleSize(),correctionRatio:this.correctionRatio,downSizingRatio:this.pickingDownSizingRatio,minEdgeThickness:this.settings.minEdgeThickness,antiAliasingFeather:this.settings.antiAliasingFeather}}},{key:"getStagePadding",value:function(){var e=this.settings,i=e.stagePadding,o=e.autoRescale;return o&&i||0}},{key:"createLayer",value:function(e,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.elements[e])throw new Error('Sigma: a layer named "'.concat(e,'" already exists'));var a=Lo(i,{position:"absolute"},{class:"sigma-".concat(e)});return o.style&&Object.assign(a.style,o.style),this.elements[e]=a,"beforeLayer"in o&&o.beforeLayer?this.elements[o.beforeLayer].before(a):"afterLayer"in o&&o.afterLayer?this.elements[o.afterLayer].after(a):this.container.appendChild(a),a}},{key:"createCanvas",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.createLayer(e,"canvas",i)}},{key:"createCanvasContext",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.createCanvas(e,i),a={preserveDrawingBuffer:!1,antialias:!1};return this.canvasContexts[e]=o.getContext("2d",a),this}},{key:"createWebGLContext",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i?.canvas||this.createCanvas(e,i);i.hidden&&o.remove();var a=G({preserveDrawingBuffer:!1,antialias:!1},i),s;s=o.getContext("webgl2",a),s||(s=o.getContext("webgl",a)),s||(s=o.getContext("experimental-webgl",a));var u=s;if(this.webGLContexts[e]=u,u.blendFunc(u.ONE,u.ONE_MINUS_SRC_ALPHA),i.picking){this.pickingLayers.add(e);var d=u.createFramebuffer();if(!d)throw new Error("Sigma: cannot create a new frame buffer for layer ".concat(e));this.frameBuffers[e]=d}return u}},{key:"killLayer",value:function(e){var i=this.elements[e];if(!i)throw new Error("Sigma: cannot kill layer ".concat(e,", which does not exist"));if(this.webGLContexts[e]){var o,a=this.webGLContexts[e];(o=a.getExtension("WEBGL_lose_context"))===null||o===void 0||o.loseContext(),delete this.webGLContexts[e]}else this.canvasContexts[e]&&delete this.canvasContexts[e];return i.remove(),delete this.elements[e],this}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(e){this.unbindCameraHandlers(),this.camera=e,this.bindCameraHandlers()}},{key:"getContainer",value:function(){return this.container}},{key:"getGraph",value:function(){return this.graph}},{key:"setGraph",value:function(e){e!==this.graph&&(this.hoveredNode&&!e.hasNode(this.hoveredNode)&&(this.hoveredNode=null),this.hoveredEdge&&!e.hasEdge(this.hoveredEdge)&&(this.hoveredEdge=null),this.unbindGraphHandlers(),this.checkEdgesEventsFrame!==null&&(cancelAnimationFrame(this.checkEdgesEventsFrame),this.checkEdgesEventsFrame=null),this.graph=e,this.bindGraphHandlers(),this.refresh())}},{key:"getMouseCaptor",value:function(){return this.mouseCaptor}},{key:"getTouchCaptor",value:function(){return this.touchCaptor}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"getGraphDimensions",value:function(){var e=this.customBBox||this.nodeExtent;return{width:e.x[1]-e.x[0]||1,height:e.y[1]-e.y[0]||1}}},{key:"getNodeDisplayData",value:function(e){var i=this.nodeDataCache[e];return i?Object.assign({},i):void 0}},{key:"getEdgeDisplayData",value:function(e){var i=this.edgeDataCache[e];return i?Object.assign({},i):void 0}},{key:"getNodeDisplayedLabels",value:function(){return new Set(this.displayedNodeLabels)}},{key:"getEdgeDisplayedLabels",value:function(){return new Set(this.displayedEdgeLabels)}},{key:"getSettings",value:function(){return G({},this.settings)}},{key:"getSetting",value:function(e){return this.settings[e]}},{key:"setSetting",value:function(e,i){var o=G({},this.settings);return this.settings[e]=i,ft(this.settings),this.handleSettingsUpdate(o),this.scheduleRefresh(),this}},{key:"updateSetting",value:function(e,i){return this.setSetting(e,i(this.settings[e])),this}},{key:"setSettings",value:function(e){var i=G({},this.settings);return this.settings=G(G({},this.settings),e),ft(this.settings),this.handleSettingsUpdate(i),this.scheduleRefresh(),this}},{key:"resize",value:function(e){var i=this.width,o=this.height;if(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.pixelRatio=ar(),this.width===0)if(this.settings.allowInvalidContainer)this.width=1;else throw new Error("Sigma: Container has no width. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(this.height===0)if(this.settings.allowInvalidContainer)this.height=1;else throw new Error("Sigma: Container has no height. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(!e&&i===this.width&&o===this.height)return this;for(var a in this.elements){var s=this.elements[a];s.style.width=this.width+"px",s.style.height=this.height+"px"}for(var u in this.canvasContexts)this.elements[u].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[u].setAttribute("height",this.height*this.pixelRatio+"px"),this.pixelRatio!==1&&this.canvasContexts[u].scale(this.pixelRatio,this.pixelRatio);for(var d in this.webGLContexts){this.elements[d].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[d].setAttribute("height",this.height*this.pixelRatio+"px");var c=this.webGLContexts[d];if(c.viewport(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.pickingLayers.has(d)){var h=this.textures[d];h&&c.deleteTexture(h)}}return this.emit("resize"),this}},{key:"clear",value:function(){return this.emit("beforeClear"),this.webGLContexts.nodes.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.nodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.edges.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.edges.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.hoverNodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.canvasContexts.labels.clearRect(0,0,this.width,this.height),this.canvasContexts.hovers.clearRect(0,0,this.width,this.height),this.canvasContexts.edgeLabels.clearRect(0,0,this.width,this.height),this.emit("afterClear"),this}},{key:"refresh",value:function(e){var i=this,o=e?.skipIndexation!==void 0?e?.skipIndexation:!1,a=e?.schedule!==void 0?e.schedule:!1,s=!e||!e.partialGraph;if(s)this.clearEdgeIndices(),this.clearNodeIndices(),this.graph.forEachNode(function(g){return i.addNode(g)}),this.graph.forEachEdge(function(g){return i.addEdge(g)});else{for(var u,d,c=((u=e.partialGraph)===null||u===void 0?void 0:u.nodes)||[],h=0,l=c?.length||0;h<l;h++){var f=c[h];if(this.updateNode(f),o){var m=this.nodeProgramIndex[f];if(m===void 0)throw new Error('Sigma: node "'.concat(f,`" can't be repaint`));this.addNodeToProgram(f,this.nodeIndices[f],m)}}for(var p=(e==null||(d=e.partialGraph)===null||d===void 0?void 0:d.edges)||[],y=0,k=p.length;y<k;y++){var w=p[y];if(this.updateEdge(w),o){var S=this.edgeProgramIndex[w];if(S===void 0)throw new Error('Sigma: edge "'.concat(w,`" can't be repaint`));this.addEdgeToProgram(w,this.edgeIndices[w],S)}}}return(s||!o)&&(this.needToProcess=!0),a?this.scheduleRender():this.render(),this}},{key:"scheduleRender",value:function(){var e=this;return this.renderFrame||(this.renderFrame=requestAnimationFrame(function(){e.render()})),this}},{key:"scheduleRefresh",value:function(e){return this.refresh(G(G({},e),{},{schedule:!0}))}},{key:"getViewportZoomedState",value:function(e,i){var o=this.camera.getState(),a=o.ratio,s=o.angle,u=o.x,d=o.y,c=this.settings,h=c.minCameraRatio,l=c.maxCameraRatio;typeof l=="number"&&(i=Math.min(i,l)),typeof h=="number"&&(i=Math.max(i,h));var f=i/a,m={x:this.width/2,y:this.height/2},p=this.viewportToFramedGraph(e),y=this.viewportToFramedGraph(m);return{angle:s,x:(p.x-y.x)*(1-f)+u,y:(p.y-y.y)*(1-f)+d,ratio:i}}},{key:"viewRectangle",value:function(){var e=this.viewportToFramedGraph({x:0,y:0}),i=this.viewportToFramedGraph({x:this.width,y:0}),o=this.viewportToFramedGraph({x:0,y:this.height});return{x1:e.x,y1:e.y,x2:i.x,y2:i.y,height:i.y-o.y}}},{key:"framedGraphToViewport",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!i.cameraState||!!i.viewportDimensions||!!i.graphDimensions,a=i.matrix?i.matrix:o?Ie(i.cameraState||this.camera.getState(),i.viewportDimensions||this.getDimensions(),i.graphDimensions||this.getGraphDimensions(),i.padding||this.getStagePadding()):this.matrix,s=_t(a,e);return{x:(1+s.x)*this.width/2,y:(1-s.y)*this.height/2}}},{key:"viewportToFramedGraph",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!i.cameraState||!!i.viewportDimensions||!i.graphDimensions,a=i.matrix?i.matrix:o?Ie(i.cameraState||this.camera.getState(),i.viewportDimensions||this.getDimensions(),i.graphDimensions||this.getGraphDimensions(),i.padding||this.getStagePadding(),!0):this.invMatrix,s=_t(a,{x:e.x/this.width*2-1,y:1-e.y/this.height*2});return isNaN(s.x)&&(s.x=0),isNaN(s.y)&&(s.y=0),s}},{key:"viewportToGraph",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.normalizationFunction.inverse(this.viewportToFramedGraph(e,i))}},{key:"graphToViewport",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.framedGraphToViewport(this.normalizationFunction(e),i)}},{key:"getGraphToViewportRatio",value:function(){var e={x:0,y:0},i={x:1,y:1},o=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)),a=this.graphToViewport(e),s=this.graphToViewport(i),u=Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2));return u/o}},{key:"getBBox",value:function(){return this.nodeExtent}},{key:"getCustomBBox",value:function(){return this.customBBox}},{key:"setCustomBBox",value:function(e){return this.customBBox=e,this.scheduleRender(),this}},{key:"kill",value:function(){this.emit("kill"),this.removeAllListeners(),this.unbindCameraHandlers(),window.removeEventListener("resize",this.activeListeners.handleResize),this.mouseCaptor.kill(),this.touchCaptor.kill(),this.unbindGraphHandlers(),this.clearIndices(),this.clearState(),this.nodeDataCache={},this.edgeDataCache={},this.highlightedNodes.clear(),this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.renderHighlightedNodesFrame&&(cancelAnimationFrame(this.renderHighlightedNodesFrame),this.renderHighlightedNodesFrame=null);for(var e=this.container;e.firstChild;)e.removeChild(e.firstChild);for(var i in this.nodePrograms)this.nodePrograms[i].kill();for(var o in this.nodeHoverPrograms)this.nodeHoverPrograms[o].kill();for(var a in this.edgePrograms)this.edgePrograms[a].kill();this.nodePrograms={},this.nodeHoverPrograms={},this.edgePrograms={};for(var s in this.elements)this.killLayer(s);this.canvasContexts={},this.webGLContexts={},this.elements={}}},{key:"scaleSize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.camera.ratio;return e/this.settings.zoomToSizeRatioFunction(i)*(this.getSetting("itemSizesReference")==="positions"?i*this.graphToViewportRatio:1)}},{key:"getCanvases",value:function(){var e={};for(var i in this.elements)this.elements[i]instanceof HTMLCanvasElement&&(e[i]=this.elements[i]);return e}}])})(zt),ni=Ko;function Xo(n){if(Array.isArray(n))return n}function Zo(n,t){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var e,i,o,a,s=[],u=!0,d=!1;try{if(o=(r=r.call(n)).next,t!==0)for(;!(u=(e=o.call(r)).done)&&(s.push(e.value),s.length!==t);u=!0);}catch(c){d=!0,i=c}finally{try{if(!u&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(d)throw i}}return s}}function xt(n,t){(t==null||t>n.length)&&(t=n.length);for(var r=0,e=Array(t);r<t;r++)e[r]=n[r];return e}function oi(n,t){if(n){if(typeof n=="string")return xt(n,t);var r={}.toString.call(n).slice(8,-1);return r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set"?Array.from(n):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?xt(n,t):void 0}}function Qo(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jo(n,t){return Xo(n)||Zo(n,t)||oi(n,t)||Qo()}function ea(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function ta(n,t){if(typeof n!="object"||!n)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var e=r.call(n,t);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function ai(n){var t=ta(n,"string");return typeof t=="symbol"?t:t+""}function ra(n,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,ai(e.key),e)}}function ia(n,t,r){return t&&ra(n.prototype,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function et(n){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},et(n)}function si(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(si=function(){return!!n})()}function St(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function na(n,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return St(n)}function oa(n,t,r){return t=et(t),na(n,si()?Reflect.construct(t,r||[],et(n).constructor):t.apply(n,r))}function Ct(n,t){return Ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},Ct(n,t)}function aa(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&Ct(n,t)}function Ae(n,t,r){return(t=ai(t))in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function sa(n){if(Array.isArray(n))return xt(n)}function ua(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function da(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pt(n){return sa(n)||ua(n)||oi(n)||da()}function vr(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);t&&(e=e.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),r.push.apply(r,e)}return r}function mr(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?vr(Object(r),!0).forEach(function(e){Ae(n,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):vr(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})}return n}var ca="relative",ha={drawLabel:void 0,drawHover:void 0,borders:[{size:{value:.1},color:{attribute:"borderColor"}},{size:{fill:!0},color:{attribute:"color"}}]},la="#000000";function fa(n){var t=n.borders,r=Zt(t.filter(function(i){var o=i.size;return"fill"in o}).length),e=`
precision highp float;

varying vec2 v_diffVector;
varying float v_radius;

#ifdef PICKING_MODE
varying vec4 v_color;
#else
// For normal mode, we use the border colors defined in the program:
`.concat(t.flatMap(function(i,o){var a=i.size;return"attribute"in a?["varying float v_borderSize_".concat(o+1,";")]:[]}).join(`
`),`
`).concat(t.flatMap(function(i,o){var a=i.color;return"attribute"in a?["varying vec4 v_borderColor_".concat(o+1,";")]:"value"in a?["uniform vec4 u_borderColor_".concat(o+1,";")]:[]}).join(`
`),`
#endif

uniform float u_correctionRatio;

const float bias = 255.0 / 254.0;
const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float dist = length(v_diffVector);
  float aaBorder = 2.0 * u_correctionRatio;
  float v_borderSize_0 = v_radius;
  vec4 v_borderColor_0 = transparent;

  // No antialiasing for picking mode:
  #ifdef PICKING_MODE
  if (dist > v_radius)
    gl_FragColor = transparent;
  else {
    gl_FragColor = v_color;
    gl_FragColor.a *= bias;
  }
  #else
  // Sizes:
`).concat(t.flatMap(function(i,o){var a=i.size;if("fill"in a)return[];a=a;var s="attribute"in a?"v_borderSize_".concat(o+1):Zt(a.value),u=(a.mode||ca)==="pixels"?"u_correctionRatio":"v_radius";return["  float borderSize_".concat(o+1," = ").concat(u," * ").concat(s,";")]}).join(`
`),`
  // Now, let's split the remaining space between "fill" borders:
  float fillBorderSize = (v_radius - (`).concat(t.flatMap(function(i,o){var a=i.size;return"fill"in a?[]:["borderSize_".concat(o+1)]}).join(" + "),") ) / ").concat(r,`;
`).concat(t.flatMap(function(i,o){var a=i.size;return"fill"in a?["  float borderSize_".concat(o+1," = fillBorderSize;")]:[]}).join(`
`),`

  // Finally, normalize all border sizes, to start from the full size and to end with the smallest:
  float adjustedBorderSize_0 = v_radius;
`).concat(t.map(function(i,o){return"  float adjustedBorderSize_".concat(o+1," = adjustedBorderSize_").concat(o," - borderSize_").concat(o+1,";")}).join(`
`),`

  // Colors:
  vec4 borderColor_0 = transparent;
`).concat(t.map(function(i,o){var a=i.color,s=[];return"attribute"in a?s.push("  vec4 borderColor_".concat(o+1," = v_borderColor_").concat(o+1,";")):"transparent"in a?s.push("  vec4 borderColor_".concat(o+1," = vec4(0.0, 0.0, 0.0, 0.0);")):s.push("  vec4 borderColor_".concat(o+1," = u_borderColor_").concat(o+1,";")),s.push("  borderColor_".concat(o+1,".a *= bias;")),s.push("  if (borderSize_".concat(o+1," <= 1.0 * u_correctionRatio) { borderColor_").concat(o+1," = borderColor_").concat(o,"; }")),s.join(`
`)}).join(`
`),`
  if (dist > adjustedBorderSize_0) {
    gl_FragColor = borderColor_0;
  } else `).concat(t.map(function(i,o){return"if (dist > adjustedBorderSize_".concat(o,` - aaBorder) {
    gl_FragColor = mix(borderColor_`).concat(o+1,", borderColor_").concat(o,", (dist - adjustedBorderSize_").concat(o,` + aaBorder) / aaBorder);
  } else if (dist > adjustedBorderSize_`).concat(o+1,`) {
    gl_FragColor = borderColor_`).concat(o+1,`;
  } else `)}).join(""),` { /* Nothing to add here */ }
  #endif
}
`);return e}function ga(n){var t=n.borders,r=`
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;

varying vec2 v_diffVector;
varying float v_radius;

#ifdef PICKING_MODE
attribute vec4 a_id;
varying vec4 v_color;
#else
`.concat(t.flatMap(function(e,i){var o=e.size;return"attribute"in o?["attribute float a_borderSize_".concat(i+1,";"),"varying float v_borderSize_".concat(i+1,";")]:[]}).join(`
`),`
`).concat(t.flatMap(function(e,i){var o=e.color;return"attribute"in o?["attribute vec4 a_borderColor_".concat(i+1,";"),"varying vec4 v_borderColor_".concat(i+1,";")]:[]}).join(`
`),`
#endif

const float bias = 255.0 / 254.0;
const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;
  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  v_radius = size / 2.0;
  v_diffVector = diffVector;

  #ifdef PICKING_MODE
  v_color = a_id;
  #else
`).concat(t.flatMap(function(e,i){var o=e.size;return"attribute"in o?["  v_borderSize_".concat(i+1," = a_borderSize_").concat(i+1,";")]:[]}).join(`
`),`
`).concat(t.flatMap(function(e,i){var o=e.color;return"attribute"in o?["  v_borderColor_".concat(i+1," = a_borderColor_").concat(i+1,";")]:[]}).join(`
`),`
  #endif
}
`);return r}var ui=WebGLRenderingContext,yr=ui.UNSIGNED_BYTE,Ke=ui.FLOAT;function pa(n){var t,r=mr(mr({},ha),{}),e=r.borders,i=r.drawLabel,o=r.drawHover,a=["u_sizeRatio","u_correctionRatio","u_matrix"].concat(pt(e.flatMap(function(s,u){var d=s.color;return"value"in d?["u_borderColor_".concat(u+1)]:[]})));return t=(function(s){aa(u,s);function u(){var d;ea(this,u);for(var c=arguments.length,h=new Array(c),l=0;l<c;l++)h[l]=arguments[l];return d=oa(this,u,[].concat(h)),Ae(St(d),"drawLabel",i),Ae(St(d),"drawHover",o),d}return ia(u,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:ga(r),FRAGMENT_SHADER_SOURCE:fa(r),METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:a,ATTRIBUTES:[{name:"a_position",size:2,type:Ke},{name:"a_id",size:4,type:yr,normalized:!0},{name:"a_size",size:1,type:Ke}].concat(pt(e.flatMap(function(c,h){var l=c.color;return"attribute"in l?[{name:"a_borderColor_".concat(h+1),size:4,type:yr,normalized:!0}]:[]})),pt(e.flatMap(function(c,h){var l=c.size;return"attribute"in l?[{name:"a_borderSize_".concat(h+1),size:1,type:Ke}]:[]}))),CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:Ke}],CONSTANT_DATA:[[u.ANGLE_1],[u.ANGLE_2],[u.ANGLE_3]]}}},{key:"processVisibleItem",value:function(c,h,l){var f=this.array;f[h++]=l.x,f[h++]=l.y,f[h++]=c,f[h++]=l.size,e.forEach(function(m){var p=m.color;"attribute"in p&&(f[h++]=me(l[p.attribute]||p.defaultValue||la))}),e.forEach(function(m){var p=m.size;"attribute"in p&&(f[h++]=l[p.attribute]||p.defaultValue)})}},{key:"setUniforms",value:function(c,h){var l=h.gl,f=h.uniformLocations,m=f.u_sizeRatio,p=f.u_correctionRatio,y=f.u_matrix;l.uniform1f(p,c.correctionRatio),l.uniform1f(m,c.sizeRatio),l.uniformMatrix3fv(y,!1,c.matrix),e.forEach(function(k,w){var S=k.color;if("value"in S){var g=f["u_borderColor_".concat(w+1)],v=Pn(S.value),b=Jo(v,4),T=b[0],N=b[1],F=b[2],D=b[3];l.uniform4f(g,T/255,N/255,F/255,D/255)}})}}]),u})(Ft),Ae(t,"ANGLE_1",0),Ae(t,"ANGLE_2",2*Math.PI/3),Ae(t,"ANGLE_3",4*Math.PI/3),t}var va=pa();function di(n,t,r){return Pt(n,t,r)}function ma(n,t,r){const e=r.labelSize,i=r.labelFont,o=r.labelWeight;n.font=`${o} ${e}px ${i}`,n.fillStyle="#FFF",n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=8,n.shadowColor="#000";const a=2;if(typeof t.label=="string"){const s=n.measureText(t.label).width,u=Math.round(s+5),d=Math.round(e+2*a),c=Math.max(t.size,e/2)+a;n.beginPath(),n.moveTo(t.x+c,t.y+d/2),n.lineTo(t.x+c+u,t.y+d/2),n.lineTo(t.x+c+u,t.y-d/2),n.lineTo(t.x+c,t.y-d/2),n.lineTo(t.x+c,t.y-c),n.lineTo(t.x-c,t.y-c),n.lineTo(t.x-c,t.y+c),n.lineTo(t.x+c,t.y+c),n.moveTo(t.x+c,t.y+d/2),n.closePath(),n.fill()}else{const s=t.size+a;n.fillRect(t.x-s,t.y-s,s*2,s*2)}n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,di(n,t,r)}const ya=`
precision mediump float;

varying vec4 v_color;

void main(void) {
  gl_FragColor = v_color;
}
`,ba=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_cameraAngle;
uniform float u_correctionRatio;

varying vec4 v_color;

const float bias = 255.0 / 254.0;
const float sqrt_8 = sqrt(8.0);

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * sqrt_8;
  float angle = a_angle + u_cameraAngle; 
  vec2 diffVector = size * vec2(cos(angle), sin(angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  #ifdef PICKING_MODE
  v_color = a_id;
  #else
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,{UNSIGNED_BYTE:br,FLOAT:vt}=WebGLRenderingContext,wa=["u_sizeRatio","u_correctionRatio","u_cameraAngle","u_matrix"],Ce=Math.PI;class Ea extends Ft{constructor(){super(...arguments),this.drawHover=ma,this.drawLabel=di}getDefinition(){return{VERTICES:6,VERTEX_SHADER_SOURCE:ba,FRAGMENT_SHADER_SOURCE:ya,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:wa,ATTRIBUTES:[{name:"a_position",size:2,type:vt},{name:"a_size",size:1,type:vt},{name:"a_color",size:4,type:br,normalized:!0},{name:"a_id",size:4,type:br,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:vt}],CONSTANT_DATA:[[Ce/4],[3*Ce/4],[-Ce/4],[3*Ce/4],[-Ce/4],[-3*Ce/4]]}}processVisibleItem(t,r,e){const i=this.array,o=me(e.color);i[r++]=e.x,i[r++]=e.y,i[r++]=e.size,i[r++]=o,i[r++]=t}setUniforms(t,{gl:r,uniformLocations:e}){const{u_sizeRatio:i,u_correctionRatio:o,u_cameraAngle:a,u_matrix:s}=e;r.uniform1f(i,t.sizeRatio),r.uniform1f(a,t.cameraAngle),r.uniform1f(o,t.correctionRatio),r.uniformMatrix3fv(s,!1,t.matrix)}}function ci(n,t,r,e){const i=(1-n)**2*t.x+2*(1-n)*n*r.x+n**2*e.x,o=(1-n)**2*t.y+2*(1-n)*n*r.y+n**2*e.y;return{x:i,y:o}}function _a(n,t,r){let i=0,o=n;for(let a=0;a<20;a++){const s=ci((a+1)/20,n,t,r);i+=Math.sqrt((o.x-s.x)**2+(o.y-s.y)**2),o=s}return i}function Ta({curvatureAttribute:n,defaultCurvature:t,keepLabelUpright:r=!0}){return(e,i,o,a,s)=>{const u=s.edgeLabelSize,d=i[n]||t,c=s.edgeLabelFont,h=s.edgeLabelWeight,l=s.edgeLabelColor.attribute?i[s.edgeLabelColor.attribute]||s.edgeLabelColor.color||"#000":s.edgeLabelColor.color;let f=i.label;if(!f)return;e.fillStyle=l,e.font=`${h} ${u}px ${c}`;const m=!r||o.x<a.x;let p=m?o.x:a.x,y=m?o.y:a.y,k=m?a.x:o.x,w=m?a.y:o.y;const S=(p+k)/2,g=(y+w)/2,v=k-p,b=w-y,T=Math.sqrt(v**2+b**2),N=m?1:-1;let F=S+b*d*N,D=g-v*d*N;const M=i.size*.7+5,j={x:D-y,y:-(F-p)},X=Math.sqrt(j.x**2+j.y**2),W={x:w-D,y:-(k-F)},K=Math.sqrt(W.x**2+W.y**2);p+=M*j.x/X,y+=M*j.y/X,k+=M*W.x/K,w+=M*W.y/K,F+=M*b/T,D-=M*v/T;const _={x:F,y:D},x={x:p,y},C={x:k,y:w},P=_a(x,_,C);if(P<o.size+a.size)return;let L=e.measureText(f).width;const O=P-o.size-a.size;if(L>O){for(f=f+"",L=e.measureText(f).width;L>O&&f.length>1;)f=f.slice(0,-2)+"",L=e.measureText(f).width;if(f.length<4)return}const H={};for(let V=0,te=f.length;V<te;V++){const ie=f[V];H[ie]||(H[ie]=e.measureText(ie).width*(1+d*.35))}let U=.5-L/P/2;for(let V=0,te=f.length;V<te;V++){const ie=f[V],he=ci(U,x,_,C),vi=2*(1-U)*(F-p)+2*U*(k-F),mi=2*(1-U)*(D-y)+2*U*(w-D),yi=Math.atan2(mi,vi);e.save(),e.translate(he.x,he.y),e.rotate(yi),e.fillText(ie,0,0),e.restore(),U+=H[ie]/P}}}function xa({arrowHead:n}){const t=n?.extremity==="target"||n?.extremity==="both",r=n?.extremity==="source"||n?.extremity==="both";return`
precision highp float;

varying vec4 v_color;
varying float v_thickness;
varying float v_feather;
varying vec2 v_cpA;
varying vec2 v_cpB;
varying vec2 v_cpC;
${t?`
varying float v_targetSize;
varying vec2 v_targetPoint;`:""}
${r?`
varying float v_sourceSize;
varying vec2 v_sourcePoint;`:""}
${n?`
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;`:""}

float det(vec2 a, vec2 b) {
  return a.x * b.y - b.x * a.y;
}

vec2 getDistanceVector(vec2 b0, vec2 b1, vec2 b2) {
  float a = det(b0, b2), b = 2.0 * det(b1, b0), d = 2.0 * det(b2, b1);
  float f = b * d - a * a;
  vec2 d21 = b2 - b1, d10 = b1 - b0, d20 = b2 - b0;
  vec2 gf = 2.0 * (b * d21 + d * d10 + a * d20);
  gf = vec2(gf.y, -gf.x);
  vec2 pp = -f * gf / dot(gf, gf);
  vec2 d0p = b0 - pp;
  float ap = det(d0p, d20), bp = 2.0 * det(d10, d0p);
  float t = clamp((ap + bp) / (2.0 * a + b + d), 0.0, 1.0);
  return mix(mix(b0, b1, t), mix(b1, b2, t), t);
}

float distToQuadraticBezierCurve(vec2 p, vec2 b0, vec2 b1, vec2 b2) {
  return length(getDistanceVector(b0 - p, b1 - p, b2 - p));
}

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float dist = distToQuadraticBezierCurve(gl_FragCoord.xy, v_cpA, v_cpB, v_cpC);
  float thickness = v_thickness;
${t?`
  float distToTarget = length(gl_FragCoord.xy - v_targetPoint);
  float targetArrowLength = v_targetSize + thickness * u_lengthToThicknessRatio;
  if (distToTarget < targetArrowLength) {
    thickness = (distToTarget - v_targetSize) / (targetArrowLength - v_targetSize) * u_widenessToThicknessRatio * thickness;
  }`:""}
${r?`
  float distToSource = length(gl_FragCoord.xy - v_sourcePoint);
  float sourceArrowLength = v_sourceSize + thickness * u_lengthToThicknessRatio;
  if (distToSource < sourceArrowLength) {
    thickness = (distToSource - v_sourceSize) / (sourceArrowLength - v_sourceSize) * u_widenessToThicknessRatio * thickness;
  }`:""}

  float halfThickness = thickness / 2.0;
  if (dist < halfThickness) {
    #ifdef PICKING_MODE
    gl_FragColor = v_color;
    #else
    float t = smoothstep(
      halfThickness - v_feather,
      halfThickness,
      dist
    );

    gl_FragColor = mix(v_color, transparent, t);
    #endif
  } else {
    gl_FragColor = transparent;
  }
}
`}function Sa({arrowHead:n}){const t=n?.extremity==="target"||n?.extremity==="both",r=n?.extremity==="source"||n?.extremity==="both";return`
attribute vec4 a_id;
attribute vec4 a_color;
attribute float a_direction;
attribute float a_thickness;
attribute vec2 a_source;
attribute vec2 a_target;
attribute float a_current;
attribute float a_curvature;
${t?`attribute float a_targetSize;
`:""}
${r?`attribute float a_sourceSize;
`:""}

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform vec2 u_dimensions;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying float v_thickness;
varying float v_feather;
varying vec2 v_cpA;
varying vec2 v_cpB;
varying vec2 v_cpC;
${t?`
varying float v_targetSize;
varying vec2 v_targetPoint;`:""}
${r?`
varying float v_sourceSize;
varying vec2 v_sourcePoint;`:""}
${n?`
uniform float u_widenessToThicknessRatio;`:""}

const float bias = 255.0 / 254.0;
const float epsilon = 0.7;

vec2 clipspaceToViewport(vec2 pos, vec2 dimensions) {
  return vec2(
    (pos.x + 1.0) * dimensions.x / 2.0,
    (pos.y + 1.0) * dimensions.y / 2.0
  );
}

vec2 viewportToClipspace(vec2 pos, vec2 dimensions) {
  return vec2(
    pos.x / dimensions.x * 2.0 - 1.0,
    pos.y / dimensions.y * 2.0 - 1.0
  );
}

void main() {
  float minThickness = u_minEdgeThickness;

  // Selecting the correct position
  // Branchless "position = a_source if a_current == 1.0 else a_target"
  vec2 position = a_source * max(0.0, a_current) + a_target * max(0.0, 1.0 - a_current);
  position = (u_matrix * vec3(position, 1)).xy;

  vec2 source = (u_matrix * vec3(a_source, 1)).xy;
  vec2 target = (u_matrix * vec3(a_target, 1)).xy;

  vec2 viewportPosition = clipspaceToViewport(position, u_dimensions);
  vec2 viewportSource = clipspaceToViewport(source, u_dimensions);
  vec2 viewportTarget = clipspaceToViewport(target, u_dimensions);

  vec2 delta = viewportTarget.xy - viewportSource.xy;
  float len = length(delta);
  vec2 normal = vec2(-delta.y, delta.x) * a_direction;
  vec2 unitNormal = normal / len;
  float boundingBoxThickness = len * a_curvature;

  float curveThickness = max(minThickness, a_thickness / u_sizeRatio);
  v_thickness = curveThickness * u_pixelRatio;
  v_feather = u_feather;

  v_cpA = viewportSource;
  v_cpB = 0.5 * (viewportSource + viewportTarget) + unitNormal * a_direction * boundingBoxThickness;
  v_cpC = viewportTarget;

  vec2 viewportOffsetPosition = (
    viewportPosition +
    unitNormal * (boundingBoxThickness / 2.0 + sign(boundingBoxThickness) * (${n?"curveThickness * u_widenessToThicknessRatio":"curveThickness"} + epsilon)) *
    max(0.0, a_direction) // NOTE: cutting the bounding box in half to avoid overdraw
  );

  position = viewportToClipspace(viewportOffsetPosition, u_dimensions);
  gl_Position = vec4(position, 0, 1);
    
${t?`
  v_targetSize = a_targetSize * u_pixelRatio / u_sizeRatio;
  v_targetPoint = viewportTarget;
`:""}
${r?`
  v_sourceSize = a_sourceSize * u_pixelRatio / u_sizeRatio;
  v_sourcePoint = viewportSource;
`:""}

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`}const hi=.25,Ca={arrowHead:null,curvatureAttribute:"curvature",defaultCurvature:hi},{UNSIGNED_BYTE:wr,FLOAT:be}=WebGLRenderingContext;function It(n){const t={...Ca,...n||{}},{arrowHead:r,curvatureAttribute:e,drawLabel:i}=t,o=r?.extremity==="target"||r?.extremity==="both",a=r?.extremity==="source"||r?.extremity==="both",s=["u_matrix","u_sizeRatio","u_dimensions","u_pixelRatio","u_feather","u_minEdgeThickness",...r?["u_lengthToThicknessRatio","u_widenessToThicknessRatio"]:[]];return class extends rt{constructor(){super(...arguments),this.drawLabel=i||Ta(t)}getDefinition(){return{VERTICES:6,VERTEX_SHADER_SOURCE:Sa(t),FRAGMENT_SHADER_SOURCE:xa(t),METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:s,ATTRIBUTES:[{name:"a_source",size:2,type:be},{name:"a_target",size:2,type:be},...o?[{name:"a_targetSize",size:1,type:be}]:[],...a?[{name:"a_sourceSize",size:1,type:be}]:[],{name:"a_thickness",size:1,type:be},{name:"a_curvature",size:1,type:be},{name:"a_color",size:4,type:wr,normalized:!0},{name:"a_id",size:4,type:wr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_current",size:1,type:be},{name:"a_direction",size:1,type:be}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[0,-1],[1,1],[1,-1]]}}processVisibleItem(d,c,h,l,f){const m=f.size||1,p=h.x,y=h.y,k=l.x,w=l.y,S=me(f.color),g=f[e]??hi,v=this.array;v[c++]=p,v[c++]=y,v[c++]=k,v[c++]=w,o&&(v[c++]=l.size),a&&(v[c++]=h.size),v[c++]=m,v[c++]=g,v[c++]=S,v[c++]=d}setUniforms(d,{gl:c,uniformLocations:h}){const{u_matrix:l,u_pixelRatio:f,u_feather:m,u_sizeRatio:p,u_dimensions:y,u_minEdgeThickness:k}=h;if(c.uniformMatrix3fv(l,!1,d.matrix),c.uniform1f(f,d.pixelRatio),c.uniform1f(p,d.sizeRatio),c.uniform1f(m,d.antiAliasingFeather),c.uniform2f(y,d.width*d.pixelRatio,d.height*d.pixelRatio),c.uniform1f(k,d.minEdgeThickness),r){const{u_lengthToThicknessRatio:w,u_widenessToThicknessRatio:S}=h;c.uniform1f(w,r.lengthToThicknessRatio),c.uniform1f(S,r.widenessToThicknessRatio)}}}}const Aa=It();It({arrowHead:nt});It({arrowHead:{...nt,extremity:"both"}});var Je={exports:{}},ka=Je.exports,Er;function Ra(){return Er||(Er=1,(function(n,t){(function(r,e){e()})(ka,function(){function r(d,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(d.type)?new Blob(["\uFEFF",d],{type:d.type}):d}function e(d,c,h){var l=new XMLHttpRequest;l.open("GET",d),l.responseType="blob",l.onload=function(){u(l.response,c,h)},l.onerror=function(){console.error("could not download file")},l.send()}function i(d){var c=new XMLHttpRequest;c.open("HEAD",d,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function o(d){try{d.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),d.dispatchEvent(c)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Be=="object"&&Be.global===Be?Be:void 0,s=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(d,c,h){var l=a.URL||a.webkitURL,f=document.createElement("a");c=c||d.name||"download",f.download=c,f.rel="noopener",typeof d=="string"?(f.href=d,f.origin===location.origin?o(f):i(f.href)?e(d,c,h):o(f,f.target="_blank")):(f.href=l.createObjectURL(d),setTimeout(function(){l.revokeObjectURL(f.href)},4e4),setTimeout(function(){o(f)},0))}:"msSaveOrOpenBlob"in navigator?function(d,c,h){if(c=c||d.name||"download",typeof d!="string")navigator.msSaveOrOpenBlob(r(d,h),c);else if(i(d))e(d,c,h);else{var l=document.createElement("a");l.href=d,l.target="_blank",setTimeout(function(){o(l)})}}:function(d,c,h,l){if(l=l||open("","_blank"),l&&(l.document.title=l.document.body.innerText="downloading..."),typeof d=="string")return e(d,c,h);var f=d.type==="application/octet-stream",m=/constructor/i.test(a.HTMLElement)||a.safari,p=/CriOS\/[\d]+/.test(navigator.userAgent);if((p||f&&m||s)&&typeof FileReader<"u"){var y=new FileReader;y.onloadend=function(){var S=y.result;S=p?S:S.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=S:location=S,l=null},y.readAsDataURL(d)}else{var k=a.URL||a.webkitURL,w=k.createObjectURL(d);l?l.location=w:location.href=w,l=null,setTimeout(function(){k.revokeObjectURL(w)},4e4)}});a.saveAs=u.saveAs=u,n.exports=u})})(Je)),Je.exports}var La=Ra();const Na=xr(La);var Mt={layers:null,width:null,height:null,fileName:"graph",format:"png",sigmaSettings:{},cameraState:null,backgroundColor:"transparent",withTempRenderer:null};function xe(){xe=function(){return t};var n,t={},r=Object.prototype,e=r.hasOwnProperty,i=Object.defineProperty||function(_,x,C){_[x]=C.value},o=typeof Symbol=="function"?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function d(_,x,C){return Object.defineProperty(_,x,{value:C,enumerable:!0,configurable:!0,writable:!0}),_[x]}try{d({},"")}catch{d=function(x,C,P){return x[C]=P}}function c(_,x,C,P){var L=x&&x.prototype instanceof k?x:k,O=Object.create(L.prototype),H=new W(P||[]);return i(O,"_invoke",{value:D(_,C,H)}),O}function h(_,x,C){try{return{type:"normal",arg:_.call(x,C)}}catch(P){return{type:"throw",arg:P}}}t.wrap=c;var l="suspendedStart",f="suspendedYield",m="executing",p="completed",y={};function k(){}function w(){}function S(){}var g={};d(g,a,function(){return this});var v=Object.getPrototypeOf,b=v&&v(v(K([])));b&&b!==r&&e.call(b,a)&&(g=b);var T=S.prototype=k.prototype=Object.create(g);function N(_){["next","throw","return"].forEach(function(x){d(_,x,function(C){return this._invoke(x,C)})})}function F(_,x){function C(L,O,H,U){var V=h(_[L],_,O);if(V.type!=="throw"){var te=V.arg,ie=te.value;return ie&&typeof ie=="object"&&e.call(ie,"__await")?x.resolve(ie.__await).then(function(he){C("next",he,H,U)},function(he){C("throw",he,H,U)}):x.resolve(ie).then(function(he){te.value=he,H(te)},function(he){return C("throw",he,H,U)})}U(V.arg)}var P;i(this,"_invoke",{value:function(L,O){function H(){return new x(function(U,V){C(L,O,U,V)})}return P=P?P.then(H,H):H()}})}function D(_,x,C){var P=l;return function(L,O){if(P===m)throw Error("Generator is already running");if(P===p){if(L==="throw")throw O;return{value:n,done:!0}}for(C.method=L,C.arg=O;;){var H=C.delegate;if(H){var U=M(H,C);if(U){if(U===y)continue;return U}}if(C.method==="next")C.sent=C._sent=C.arg;else if(C.method==="throw"){if(P===l)throw P=p,C.arg;C.dispatchException(C.arg)}else C.method==="return"&&C.abrupt("return",C.arg);P=m;var V=h(_,x,C);if(V.type==="normal"){if(P=C.done?p:f,V.arg===y)continue;return{value:V.arg,done:C.done}}V.type==="throw"&&(P=p,C.method="throw",C.arg=V.arg)}}}function M(_,x){var C=x.method,P=_.iterator[C];if(P===n)return x.delegate=null,C==="throw"&&_.iterator.return&&(x.method="return",x.arg=n,M(_,x),x.method==="throw")||C!=="return"&&(x.method="throw",x.arg=new TypeError("The iterator does not provide a '"+C+"' method")),y;var L=h(P,_.iterator,x.arg);if(L.type==="throw")return x.method="throw",x.arg=L.arg,x.delegate=null,y;var O=L.arg;return O?O.done?(x[_.resultName]=O.value,x.next=_.nextLoc,x.method!=="return"&&(x.method="next",x.arg=n),x.delegate=null,y):O:(x.method="throw",x.arg=new TypeError("iterator result is not an object"),x.delegate=null,y)}function j(_){var x={tryLoc:_[0]};1 in _&&(x.catchLoc=_[1]),2 in _&&(x.finallyLoc=_[2],x.afterLoc=_[3]),this.tryEntries.push(x)}function X(_){var x=_.completion||{};x.type="normal",delete x.arg,_.completion=x}function W(_){this.tryEntries=[{tryLoc:"root"}],_.forEach(j,this),this.reset(!0)}function K(_){if(_||_===""){var x=_[a];if(x)return x.call(_);if(typeof _.next=="function")return _;if(!isNaN(_.length)){var C=-1,P=function L(){for(;++C<_.length;)if(e.call(_,C))return L.value=_[C],L.done=!1,L;return L.value=n,L.done=!0,L};return P.next=P}}throw new TypeError(typeof _+" is not iterable")}return w.prototype=S,i(T,"constructor",{value:S,configurable:!0}),i(S,"constructor",{value:w,configurable:!0}),w.displayName=d(S,u,"GeneratorFunction"),t.isGeneratorFunction=function(_){var x=typeof _=="function"&&_.constructor;return!!x&&(x===w||(x.displayName||x.name)==="GeneratorFunction")},t.mark=function(_){return Object.setPrototypeOf?Object.setPrototypeOf(_,S):(_.__proto__=S,d(_,u,"GeneratorFunction")),_.prototype=Object.create(T),_},t.awrap=function(_){return{__await:_}},N(F.prototype),d(F.prototype,s,function(){return this}),t.AsyncIterator=F,t.async=function(_,x,C,P,L){L===void 0&&(L=Promise);var O=new F(c(_,x,C,P),L);return t.isGeneratorFunction(x)?O:O.next().then(function(H){return H.done?H.value:O.next()})},N(T),d(T,u,"Generator"),d(T,a,function(){return this}),d(T,"toString",function(){return"[object Generator]"}),t.keys=function(_){var x=Object(_),C=[];for(var P in x)C.push(P);return C.reverse(),function L(){for(;C.length;){var O=C.pop();if(O in x)return L.value=O,L.done=!1,L}return L.done=!0,L}},t.values=K,W.prototype={constructor:W,reset:function(_){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(X),!_)for(var x in this)x.charAt(0)==="t"&&e.call(this,x)&&!isNaN(+x.slice(1))&&(this[x]=n)},stop:function(){this.done=!0;var _=this.tryEntries[0].completion;if(_.type==="throw")throw _.arg;return this.rval},dispatchException:function(_){if(this.done)throw _;var x=this;function C(V,te){return O.type="throw",O.arg=_,x.next=V,te&&(x.method="next",x.arg=n),!!te}for(var P=this.tryEntries.length-1;P>=0;--P){var L=this.tryEntries[P],O=L.completion;if(L.tryLoc==="root")return C("end");if(L.tryLoc<=this.prev){var H=e.call(L,"catchLoc"),U=e.call(L,"finallyLoc");if(H&&U){if(this.prev<L.catchLoc)return C(L.catchLoc,!0);if(this.prev<L.finallyLoc)return C(L.finallyLoc)}else if(H){if(this.prev<L.catchLoc)return C(L.catchLoc,!0)}else{if(!U)throw Error("try statement without catch or finally");if(this.prev<L.finallyLoc)return C(L.finallyLoc)}}}},abrupt:function(_,x){for(var C=this.tryEntries.length-1;C>=0;--C){var P=this.tryEntries[C];if(P.tryLoc<=this.prev&&e.call(P,"finallyLoc")&&this.prev<P.finallyLoc){var L=P;break}}L&&(_==="break"||_==="continue")&&L.tryLoc<=x&&x<=L.finallyLoc&&(L=null);var O=L?L.completion:{};return O.type=_,O.arg=x,L?(this.method="next",this.next=L.finallyLoc,y):this.complete(O)},complete:function(_,x){if(_.type==="throw")throw _.arg;return _.type==="break"||_.type==="continue"?this.next=_.arg:_.type==="return"?(this.rval=this.arg=_.arg,this.method="return",this.next="end"):_.type==="normal"&&x&&(this.next=x),y},finish:function(_){for(var x=this.tryEntries.length-1;x>=0;--x){var C=this.tryEntries[x];if(C.finallyLoc===_)return this.complete(C.completion,C.afterLoc),X(C),y}},catch:function(_){for(var x=this.tryEntries.length-1;x>=0;--x){var C=this.tryEntries[x];if(C.tryLoc===_){var P=C.completion;if(P.type==="throw"){var L=P.arg;X(C)}return L}}throw Error("illegal catch attempt")},delegateYield:function(_,x,C){return this.delegate={iterator:K(_),resultName:x,nextLoc:C},this.method==="next"&&(this.arg=n),y}},t}function Da(n,t){if(typeof n!="object"||!n)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var e=r.call(n,t);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function Ga(n){var t=Da(n,"string");return typeof t=="symbol"?t:t+""}function Fa(n,t,r){return(t=Ga(t))in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function _r(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);t&&(e=e.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),r.push.apply(r,e)}return r}function we(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_r(Object(r),!0).forEach(function(e){Fa(n,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):_r(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})}return n}function Tr(n,t,r,e,i,o,a){try{var s=n[o](a),u=s.value}catch(d){return void r(d)}s.done?t(u):Promise.resolve(u).then(e,i)}function $t(n){return function(){var t=this,r=arguments;return new Promise(function(e,i){var o=n.apply(t,r);function a(u){Tr(o,e,i,a,s,"next",u)}function s(u){Tr(o,e,i,a,s,"throw",u)}a(void 0)})}}function Pa(n){return At.apply(this,arguments)}function At(){return At=$t(xe().mark(function n(t){var r,e,i,o,a,s,u,d,c,h,l,f,m,p,y,k,w,S,g,v=arguments;return xe().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(r=v.length>1&&v[1]!==void 0?v[1]:{},e=we(we({},Mt),r),i=e.layers,o=e.backgroundColor,a=e.width,s=e.height,u=e.cameraState,d=e.sigmaSettings,c=e.withTempRenderer,h=t.getDimensions(),l=window.devicePixelRatio||1,f=typeof a!="number"?h.width:a,m=typeof s!="number"?h.height:s,p=document.createElement("DIV"),p.style.width="".concat(f,"px"),p.style.height="".concat(m,"px"),p.style.position="absolute",p.style.right="101%",p.style.bottom="101%",document.body.appendChild(p),y=new ni(t.getGraph(),p,we(we({},t.getSettings()),d)),y.getCamera().setState(u||t.getCamera().getState()),y.setCustomBBox(t.getCustomBBox()),y.refresh(),k=document.createElement("CANVAS"),k.setAttribute("width",f*l+""),k.setAttribute("height",m*l+""),w=k.getContext("2d"),w.fillStyle=o,w.fillRect(0,0,f*l,m*l),!c){T.next=26;break}return T.next=26,c(y);case 26:return S=y.getCanvases(),g=i?i.filter(function(N){return!!S[N]}):Object.keys(S),g.forEach(function(N){w.drawImage(S[N],0,0,f*l,m*l,0,0,f*l,m*l)}),y.kill(),p.remove(),T.abrupt("return",k);case 32:case"end":return T.stop()}},n)})),At.apply(this,arguments)}function za(n,t){if(n==null)return{};var r={};for(var e in n)if({}.hasOwnProperty.call(n,e)){if(t.includes(e))continue;r[e]=n[e]}return r}function Oa(n,t){if(n==null)return{};var r,e,i=za(n,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(e=0;e<o.length;e++)r=o[e],t.includes(r)||{}.propertyIsEnumerable.call(n,r)&&(i[r]=n[r])}return i}var Ia=["format"];function Ma(n){return kt.apply(this,arguments)}function kt(){return kt=$t(xe().mark(function n(t){var r,e,i,o,a,s=arguments;return xe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return r=s.length>1&&s[1]!==void 0?s[1]:{},e=we(we({},Mt),r),i=e.format,o=Oa(e,Ia),d.next=4,Pa(t,o);case 4:return a=d.sent,d.abrupt("return",new Promise(function(c,h){a.toBlob(function(l){l?c(l):h(new Error('No actual blob was obtained by canvas.toBlob(..., "image/'.concat(i,'")')))},"image/".concat(i))}));case 6:case"end":return d.stop()}},n)})),kt.apply(this,arguments)}function $a(n){return Rt.apply(this,arguments)}function Rt(){return Rt=$t(xe().mark(function n(t){var r,e,i,o,a,s=arguments;return xe().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return r=s.length>1&&s[1]!==void 0?s[1]:{},e=we(we({},Mt),r),i=e.fileName,o=e.format,d.next=4,Ma(t,r);case 4:a=d.sent,Na.saveAs(a,"".concat(i,".").concat(o));case 6:case"end":return d.stop()}},n)})),Rt.apply(this,arguments)}function li(n,t,r){const e=r.labelSize,i=r.labelFont,o=r.labelWeight,a=t.label,s=q?"#1a1a1a":"#ffffff",u=q?"#ffffff":"#000000",d=q?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.5)";n.font=`${o} ${e}px ${i}`;const c=n.measureText(a).width,h=Math.round(t.x),l=Math.round(t.y),f=t.size,m=h-f,p=l-e/2-4,y=f*2+c+e/2+10,k=e+8;n.beginPath(),n.fillStyle=s,n.shadowOffsetX=0,n.shadowOffsetY=2,n.shadowBlur=8,n.shadowColor=d;const w=5;n.moveTo(m+w,p),n.lineTo(m+y-w,p),n.quadraticCurveTo(m+y,p,m+y,p+w),n.lineTo(m+y,p+k-w),n.quadraticCurveTo(m+y,p+k,m+y-w,p+k),n.lineTo(m+w,p+k),n.quadraticCurveTo(m,p+k,m,p+k-w),n.lineTo(m,p+w),n.quadraticCurveTo(m,p,m+w,p),n.closePath(),n.fill(),n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,n.fillStyle=u,n.fillText(a,h+f+3,l+e/3)}class Ua extends Ea{constructor(...t){super(...t),this.drawHover=li}}let $,I,re,Ee="combined";function Ba(n){Ee=n,Ut(),$.refresh({skipIndexation:!0})}window.setDiscourseMode=Ba;const le={clusters:new Set,categories:new Set},Q={hoveredNode:null,hoveredNeighbors:null,selectedNode:null,selectedNeighbors:null};let Te=!1,q=!0;async function ja(){try{re=await(await fetch("network_data.json")).json(),console.log("Dataset loaded:",re),I=new B,re.nodes.forEach(e=>{I.addNode(e.key,{label:e.label,size:e.size,sizeMigration:e.sizeMigration,sizeEducation:e.sizeEducation,color:e.color,borderColor:e.borderColor,cluster:e.cluster,category:e.category,node_type:e.node_type,type:e.node_type==="frame"?"square":"circle",data_points:e.data_points||[],url:e.url,citation:e.citation,x:e.x||Math.random(),y:e.y||Math.random()})}),re.edges.forEach(e=>{let i,o,a,s,u,d;Array.isArray(e)?(i=e[0],o=e[1],a="#cccccc",s=1,u=0,d=0):(i=e.source,o=e.target,a=e.color||"#cccccc",s=e.weight||1,u=e.weightMigration||0,d=e.weightEducation||0),I.hasNode(i)&&I.hasNode(o)&&I.addEdge(i,o,{color:a,size:s,weight:s,weightMigration:u,weightEducation:d})}),re.clusters.forEach(e=>le.clusters.add(e.key)),console.log("Using pre-calculated positions from NetworkX"),$=new ni(I,document.getElementById("sigma-container"),{defaultEdgeType:"curve",edgeProgramClasses:{curve:Aa},defaultNodeType:"circle",nodeProgramClasses:{circle:va,square:Ua},defaultDrawNodeHover:li,renderEdgeLabels:!1,minCameraRatio:.1,maxCameraRatio:10,enableEdgeClickEvents:!0,enableEdgeWheelEvents:!1,enableEdgeHoverEvents:!1,labelSize:20,labelWeight:"bold",labelRenderedSizeThreshold:4});const t=$.getCamera(),r=t.getState();t.setState({x:.4,y:.5,ratio:r.ratio*1.1}),Ha(),Wa(),Ka(),pi(),Va(),Ut(),document.getElementById("loading").style.display="none",console.log("Visualization ready!")}catch(n){console.error("Error loading graph:",n),document.getElementById("loading").innerHTML='<div style="color: red;">Fehler beim Laden.<br>Stelle sicher, dass network_data.json vorhanden ist.</div>'}}function Ha(){$.setSetting("nodeReducer",(n,t)=>{const r={...t},e=I.getNodeAttributes(n),i=Q.selectedNode||Q.hoveredNode,o=Q.selectedNeighbors||Q.hoveredNeighbors;if(i&&!o.has(n)&&i!==n&&(r.color="#e0e0e0",t.node_type==="frame"?r.label="":r.labelColor="#cccccc"),n===i&&q&&(r.labelColor="#000000"),Ee==="migration"){const a=e.sizeMigration||0;a===0?r.hidden=!0:r.size=a}else if(Ee==="education"){const a=e.sizeEducation||0;a===0?r.hidden=!0:r.size=a}else r.size=e.size||t.size;return r}),$.setSetting("edgeReducer",(n,t)=>{const r={...t},e=Q.selectedNode||Q.hoveredNode;if(e&&!I.extremities(n).includes(e))return r.hidden=!0,r;const i=I.getEdgeAttributes(n);if(Ee==="migration"){const o=i.weightMigration||0;o===0?r.hidden=!0:r.size=o}else if(Ee==="education"){const o=i.weightEducation||0;o===0?r.hidden=!0:r.size=o}else r.size=i.weight||t.size||1;return r})}function mt(n){n?(Q.hoveredNode=n,Q.hoveredNeighbors=new Set(I.neighbors(n))):(Q.hoveredNode=null,Q.hoveredNeighbors=null),$.refresh({skipIndexation:!0})}function Xe(n){n?(Q.selectedNode=n,Q.selectedNeighbors=new Set(I.neighbors(n))):(Q.selectedNode=null,Q.selectedNeighbors=null),$.refresh({skipIndexation:!0})}function Wa(){let n=null;$.on("downNode",e=>{Te=!0,n=e.node,I.setNodeAttribute(n,"highlighted",!0),mt(null)}),$.getMouseCaptor().on("mousemovebody",e=>{if(!Te||!n)return;const i=$.viewportToGraph(e);I.setNodeAttribute(n,"x",i.x),I.setNodeAttribute(n,"y",i.y),e.preventSigmaDefault(),e.original.preventDefault(),e.original.stopPropagation()}),$.getMouseCaptor().on("mouseup",()=>{n&&(I.setNodeAttribute(n,"highlighted",!1),n=null),Te=!1}),$.getMouseCaptor().on("touchup",()=>{n&&(I.setNodeAttribute(n,"highlighted",!1),n=null),Te=!1}),$.on("enterNode",({node:e})=>{!Te&&!Q.selectedNode&&mt(e)}),$.on("leaveNode",()=>{Te||mt(null)}),$.on("clickNode",({node:e})=>{Te||(Q.selectedNode===e?(Xe(null),yt()):(Xe(e),rs(e)))}),$.on("clickStage",()=>{Xe(null),yt()});const t=document.getElementById("search-input"),r=document.getElementById("search-suggestions");t.addEventListener("input",e=>{const i=e.target.value.toLowerCase();if(r.innerHTML="",I.forEachNode(s=>{I.setNodeAttribute(s,"highlighted",!1)}),i.length<2){$.refresh();return}const o=[];I.forEachNode((s,u)=>{u.label&&u.label.toLowerCase().startsWith(i)&&o.push({id:s,label:u.label})}),o.forEach(s=>{const u=document.createElement("option");u.value=s.label,r.appendChild(u)});const a=o.find(s=>s.label.toLowerCase()===i);if(a){I.setNodeAttribute(a.id,"highlighted",!0);const s=$.getNodeDisplayData(a.id);s&&$.getCamera().animate({...s,ratio:.1},{duration:600})}$.refresh()}),document.getElementById("zoom-in").addEventListener("click",()=>{$.getCamera().animatedZoom({duration:300})}),document.getElementById("zoom-out").addEventListener("click",()=>{$.getCamera().animatedUnzoom({duration:300})}),document.getElementById("zoom-reset").addEventListener("click",()=>{$.getCamera().animate({x:.4,y:.5,ratio:1.1},{duration:300}),Xe(null),yt(),document.getElementById("search-input").value="",I.forEachNode(i=>{I.setNodeAttribute(i,"highlighted",!1)}),Ee="combined",Ut(),re.clusters.forEach(i=>{le.clusters.add(i.key),document.getElementById(`cluster-${i.key}`).checked=!0}),Fe(),$.refresh()}),document.getElementById("fullscreen").addEventListener("click",()=>{const e=document.getElementById("container");document.fullscreenElement?document.exitFullscreen():e.requestFullscreen().catch(i=>{console.error("Error attempting fullscreen:",i)})}),document.getElementById("theme-toggle").addEventListener("click",()=>{qa()}),document.getElementById("export-image").addEventListener("click",()=>{Ya()})}function Ut(){document.querySelectorAll(".button-group .btn").forEach(r=>{r.classList.remove("active")});const n={combined:0,migration:1,education:2},t=document.querySelectorAll("#discourse-mode-panel .btn");t[n[Ee]]&&t[n[Ee]].classList.add("active")}function Va(){localStorage.getItem("theme")==="dark"&&(q=!0,document.body.dataset.theme="dark",fi(),gi())}function qa(){q=!q,document.body.dataset.theme=q?"dark":"light",localStorage.setItem("theme",q?"dark":"light"),fi(),gi()}function fi(){const n=document.querySelector("#theme-toggle .icon");n.className=q?"icon icon-sun":"icon icon-moon"}function gi(){const r=q?{Bildung:"yellow",Arbeit:"fuchsia",Migration:"lightskyblue"}:{Bildung:"#d5a700",Arbeit:"#882255",Migration:"#0072b2"},e=q?"#363636":"#ffffff",i=q?"#ffffff":"#000000";I.forEachNode((o,a)=>{const s=a.cluster;let u,d;s==="Bildung"?(u=r.Bildung,d=q?"gold":"#ac8600"):s==="Arbeit"?(u=r.Arbeit,d=q?"purple":"#5e1839"):s==="Migration"?(u=r.Migration,d=q?"deepskyblue":"#005280"):(u=q?"white":"#282828",d=q?"#999999":"#000000"),I.setNodeAttribute(o,"color",u),I.setNodeAttribute(o,"borderColor",d)}),I.forEachEdge((o,a,s)=>{const u=I.getNodeAttribute(s,"color");I.setEdgeAttribute(o,"color",u)}),$.setSetting("backgroundColor",e),$.setSetting("labelColor",{color:i}),$.setSetting("hoverLabelColor",q?{color:"#000000"}:{color:i}),$.setSetting("labelBackgroundColor",q?"#000000":"#ffffff"),$.setSetting("edgeLabelColor",{color:i}),$.refresh(),Xa()}function Ya(){$a($,{layers:["edges","nodes","labels"],format:"png",fileName:"discourse-network",backgroundColor:q?"#363636":"#ffffff"}),console.log(`Graph exported as ${format.toUpperCase()}`)}function Ka(){const n=document.getElementById("cluster-filters");re.clusters.forEach(t=>{const r=re.nodes.filter(o=>o.cluster===t.key).length,e=document.createElement("div");e.className="filter-item",e.innerHTML=`
                    <input type="checkbox" id="cluster-${t.key}" checked>
                    <div class="filter-color" style="background: ${t.color}"></div>
                    <span class="filter-label">${t.label}</span>
                    <span class="filter-count">(${r})</span>
                `,e.querySelector("input").addEventListener("change",()=>{Za(t.key)}),n.appendChild(e)})}function Xa(){const r=q?{Bildung:"yellow",Arbeit:"fuchsia",Migration:"lightskyblue",Mixed:"white"}:{Bildung:"#d5a700",Arbeit:"#882255",Migration:"#0072b2",Mixed:"#282828"};re.clusters.forEach(e=>{const i=document.querySelector(`#cluster-${e.key}`).parentElement.querySelector(".filter-color");i&&(i.style.background=r[e.key])})}function Za(n){le.clusters.has(n)?le.clusters.delete(n):le.clusters.add(n),Fe()}function Fe(){I.forEachNode((n,t)=>{const r=!le.clusters.has(t.cluster);I.setNodeAttribute(n,"hidden",r)}),I.forEachEdge((n,t,r,e)=>{const i=I.getNodeAttribute(r,"hidden"),o=I.getNodeAttribute(e,"hidden");I.setEdgeAttribute(n,"hidden",i||o)}),$.refresh(),pi()}function Qa(){re.clusters.forEach(n=>{le.clusters.add(n.key),document.getElementById(`cluster-${n.key}`).checked=!0}),Fe()}function Ja(){le.clusters.clear(),re.clusters.forEach(n=>{document.getElementById(`cluster-${n.key}`).checked=!1}),Fe()}function es(){re.categories.forEach(n=>{le.categories.add(n.key),document.getElementById(`category-${n.key}`).checked=!0}),Fe()}function ts(){le.categories.clear(),re.categories.forEach(n=>{document.getElementById(`category-${n.key}`).checked=!1}),Fe()}function rs(n){const t=I.getNodeAttributes(n);document.getElementById("node-info").classList.add("visible");const e=document.getElementById("node-name");e.textContent=t.label,t.node_type==="frame"?e.classList.add("smallcaps"):e.classList.remove("smallcaps"),document.getElementById("node-type").textContent=t.node_type==="keyword"?"Keyword":"Frame",document.getElementById("node-connections").textContent=I.degree(n);const i=document.getElementById("node-link");t.node_type==="frame"&&t.url?i.innerHTML=`
					<a href="${t.url}" target="_blank" class="frame-link">
						im Framenet-Konstruktikon des Deutschen ${t.citation}
					</a>
				`:i.innerHTML="";const o=document.getElementById("node-data-points");o.innerHTML="",t.data_points&&t.data_points.length>0?t.data_points.forEach((a,s)=>{const u=document.createElement("div");u.className="data-point",u.innerHTML=`
						<div class="data-point-text">${s+1}. ${a.text}</div>
						<div class="data-point-citation">${a.citation}</div>
					`,o.appendChild(u)}):o.innerHTML='<div style="color: #999;">Keine Datenpunkte verfgbar</div>'}function yt(){document.getElementById("node-info").classList.remove("visible")}function pi(){const n=I.order,t=I.size;let r=0,e=0;I.forEachNode((i,o)=>{o.hidden||r++}),I.forEachEdge((i,o)=>{o.hidden||e++}),document.getElementById("node-count").textContent=r<n?`${r}/${n}`:n,document.getElementById("edge-count").textContent=e<t?`${e}/${t}`:t}window.addEventListener("DOMContentLoaded",ja);window.checkAllClusters=Qa;window.uncheckAllClusters=Ja;window.checkAllCategories=es;window.uncheckAllCategories=ts;
